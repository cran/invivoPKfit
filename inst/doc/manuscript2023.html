<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>manuscript2023</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">manuscript2023</h1>



<div id="overview" class="section level1">
<h1>Overview</h1>
<p>This vignette outlines the 2023 manuscript that describes
<em>invivoPKfit</em>’s use in a case study with CvT data from over 200
Chemicals. The main inquiry is to assess whether we can estimate
parameters for one- and two-compartment models such that the majority of
predicted values are “within a factor of two” – a common metric used to
evaluate physiologically-based pharmacokinetic (PBPK) models.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.5</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#&gt; ✔ ggplot2   3.5.1     ✔ tibble    3.2.1</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt; ✔ lubridate 1.9.3     ✔ tidyr     1.3.1</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; ✔ purrr     1.0.2     </span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;cowplot&#39;</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:lubridate&#39;:</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#&gt;     stamp</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>() </span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#&gt; ℹ Loading invivoPKfit</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>today <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%d%B%Y&quot;</span>)</span></code></pre></div>
<p>To speed up analysis in sections 4 and beyond, we can load an
<code>.rds</code> file that includes the fitted models used in much of
the publication.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data-raw/all_cvt_pk.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="table-of-contents" class="section level1">
<h1>Table of Contents</h1>
<ol style="list-style-type: decimal">
<li>Pulling Data from CvTdb<br />
</li>
</ol>
<ul>
<li>Minimal <code>pk</code> object<br />
</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Running all possible fitting options<br />
</li>
</ol>
<ul>
<li>Evaluating fitting options<br />
</li>
<li>Head-to-head comparison of pooled vs joint models<br />
</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Running dose-normalized, log-transformed, joint fits<br />
</li>
<li>Analysis Plots<br />
</li>
</ol>
<ul>
<li>CvTdb replicate variation (Figure 4A &amp; Supp. Figure 2A)<br />
</li>
<li>CvTdb replicate variation over ADME-normalized time (Figure
4B)<br />
</li>
<li>CvTdb concentration and final time-point distributions (Supp. Figure
2B)<br />
</li>
<li>invivoPKfit fit option selection (Supp. Table 1)<br />
</li>
<li>invivoPKfit model performance (Supp. Figure 2)<br />
</li>
<li>Model performance vs Data variability (Figure 5 and
Alternative)<br />
</li>
<li>Goodness of fit plots (Figure 6)<br />
</li>
<li>Fits that may be improved (Supplementary Figure 3)<br />
</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Lombardo Analysis<br />
</li>
</ol>
<ul>
<li>Chemicals included<br />
</li>
<li>Comparison of derived TK stats (Figure 7A)<br />
</li>
<li>Histograms for Steady-state Volume of Dist. and Total Clearance
(Supplemental Figure 4)</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>Benchmarking invivoPKfit</li>
</ol>
<ul>
<li>Parallelization speeds up the process of fitting (Supplementary
Figure 5)</li>
</ul>
<div id="pulling-data-from-cvtdb" class="section level2">
<h2>Pulling data from CvTdb</h2>
<p>See <code>pulling_iv_oral_cvtdb.Rmd</code>.</p>
<div id="minimal-pk-object" class="section level3">
<h3>Minimal PK object</h3>
<p>The following chunk shows the column/field mapping from the
<code>cvt</code> object and the <code>pk</code> object needed for
invivoPKfit analysis. The <code>cvt</code> object is data from the CvTdb
database that includes chemicals with oral or intravenous routes of
administration and takes measurements from blood or plasma. The data has
been processed and cleaned to facilitate its use with
<em>invivoPKfit</em>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="do">### Minimal PK Object </span><span class="al">###</span><span class="do">----</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># Minimum pk object, add options later</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Note that these mappings are now a default mappings, just being verbose here.</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># If there are any standard deviations that are zero or NA, but N_Subjects &gt; 1,</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># Set the n_subjects to 6 or the current value if lower than 6.</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># (In Showa the mode is 6, but this condition is present in CVT_Legacy as well)</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>minimal_pk <span class="ot">&lt;-</span> <span class="fu">pk</span>(<span class="at">data =</span> cvt <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>                   <span class="fu">mutate</span>(<span class="at">n_subjects_normalized =</span> <span class="fu">if_else</span>(</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>                     n_subjects_normalized <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(invivPK_conc_sd),</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>                     <span class="fu">min</span>(n_subjects_normalized, <span class="dv">6</span>), n_subjects_normalized)),</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>                 <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>                   <span class="at">Chemical =</span> analyte_dtxsid,</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>                   <span class="at">Chemical_Name =</span> analyte_name_original,</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>                   <span class="at">DTXSID =</span> analyte_dtxsid,</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>                   <span class="at">CASRN =</span> analyte_casrn,</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>                   <span class="at">Species =</span> species,</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>                   <span class="at">Reference =</span> fk_extraction_document_id,</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>                   <span class="at">Media =</span> conc_medium_normalized,</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>                   <span class="at">Route =</span> administration_route_normalized,</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>                   <span class="at">Dose =</span> invivPK_dose_level,</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>                   <span class="at">Dose.Units =</span> <span class="st">&quot;mg/kg&quot;</span>,</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>                   <span class="at">Subject_ID =</span> fk_subject_id,</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>                   <span class="at">Series_ID =</span> fk_series_id,</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>                   <span class="at">Study_ID =</span> fk_study_id,</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>                   <span class="at">ConcTime_ID =</span> conc_time_id,</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>                   <span class="at">N_Subjects =</span> n_subjects_normalized,</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>                   <span class="at">Weight =</span> weight_kg,</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>                   <span class="at">Weight.Units =</span> <span class="st">&quot;kg&quot;</span>,</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>                   <span class="at">Time =</span> time_hr,</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>                   <span class="at">Time.Units =</span> <span class="st">&quot;hours&quot;</span>,</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>                   <span class="at">Value =</span> invivPK_conc,</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>                   <span class="at">Value.Units =</span> <span class="st">&quot;mg/L&quot;</span>,</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>                   <span class="at">Value_SD =</span> invivPK_conc_sd,</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>                   <span class="at">LOQ =</span> invivPK_loq</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>                 ))</span></code></pre></div>
</div>
</div>
<div id="running-all-possible-fitting-options" class="section level2">
<h2>Running all possible fitting options</h2>
<p>Here we setup the PK object with the various options for fitting and
data transformations. As shown in this vignette, it is possible to setup
multiple distinct options for fitting and data transformation at once
prior to processing and fitting the data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Types of Choices:</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">## Dose Normalized</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">## Log10 transform</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="do">## Scale time</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># List of options</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>fitopts <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">error_model =</span> <span class="fu">c</span>(<span class="st">&quot;pooled&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>                                       <span class="st">&quot;hierarchical&quot;</span>),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>                       <span class="at">dose_norm =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>                       <span class="at">log10_trans =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>                       <span class="at">time_scale =</span> <span class="fu">c</span>(</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>                         <span class="cn">TRUE</span>,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>                         <span class="cn">FALSE</span>),</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>                       <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Make function similar to that in test_vignette authored by Caroline Ring</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>fit_data <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>                     this_dose_norm,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>                     this_log10_trans,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>                     this_time_scale,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>                     <span class="at">n_cores =</span> <span class="dv">12</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>                     <span class="at">file_dir =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>)){</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  retval <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">9</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(today,</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>                     time_indic,</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>  </span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Fitting: &quot;</span>, file_str, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  </span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>    <span class="at">expr =</span> {</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>      this_pk <span class="ot">&lt;-</span>   minimal_pk <span class="sc">+</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>        <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>        <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>                            <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>        <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> this_dose_norm, <span class="at">log10_trans =</span> this_log10_trans) <span class="sc">+</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>        <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>          <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>          <span class="st">&quot;bobyqa&quot;</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>          ))</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>      </span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>      <span class="cf">if</span>(this_error_model <span class="sc">%in%</span> <span class="st">&quot;pooled&quot;</span>){</span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a>        this_pk <span class="ot">&lt;-</span> this_pk <span class="sc">+</span></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>          <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(this_error_model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;hierarchical&quot;</span>, <span class="st">&quot;joint&quot;</span>)){</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>        this_pk <span class="ot">&lt;-</span> this_pk <span class="sc">+</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>          <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;this_error_model must be either &#39;pooled&#39; or &#39;hierarchical&#39;/&#39;joint&#39;&quot;</span>)</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>      }</span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>      </span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>      <span class="cf">if</span>(this_time_scale <span class="sc">%in%</span> <span class="cn">TRUE</span>){</span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a>        this_pk <span class="ot">&lt;-</span> this_pk <span class="sc">+</span></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a>          <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>)</span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a>      }</span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>      </span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a>      <span class="co">#do the fit</span></span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a>      this_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>(this_fit <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(this_pk, <span class="at">n_cores =</span> n_cores))</span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a>      </span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a>      </span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a>      </span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a>      <span class="co">#save the result</span></span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a>      <span class="fu">saveRDS</span>(this_fit,</span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a>              <span class="at">file =</span> <span class="fu">paste0</span>(file_dir,</span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a>                     file_str))</span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a>      </span>
<span id="cb5-61"><a href="#cb5-61" tabindex="-1"></a>      cli<span class="sc">::</span><span class="fu">cli_alert_success</span>(<span class="at">text =</span> <span class="st">&quot;Fitting success!&quot;</span>)</span>
<span id="cb5-62"><a href="#cb5-62" tabindex="-1"></a>      <span class="fu">print</span>(this_time)</span>
<span id="cb5-63"><a href="#cb5-63" tabindex="-1"></a>      <span class="fu">rm</span>(this_fit)</span>
<span id="cb5-64"><a href="#cb5-64" tabindex="-1"></a>      </span>
<span id="cb5-65"><a href="#cb5-65" tabindex="-1"></a>      retval <span class="ot">&lt;-</span> this_time[[<span class="dv">3</span>]]</span>
<span id="cb5-66"><a href="#cb5-66" tabindex="-1"></a>    },</span>
<span id="cb5-67"><a href="#cb5-67" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e){</span>
<span id="cb5-68"><a href="#cb5-68" tabindex="-1"></a>      cli<span class="sc">::</span><span class="fu">cli_alert_danger</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;Analysis&quot;</span>,</span>
<span id="cb5-69"><a href="#cb5-69" tabindex="-1"></a>                                         file_str,</span>
<span id="cb5-70"><a href="#cb5-70" tabindex="-1"></a>                                         <span class="st">&quot;failed with error&quot;</span>,</span>
<span id="cb5-71"><a href="#cb5-71" tabindex="-1"></a>                                         e))</span>
<span id="cb5-72"><a href="#cb5-72" tabindex="-1"></a>      retval <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb5-73"><a href="#cb5-73" tabindex="-1"></a>    }</span>
<span id="cb5-74"><a href="#cb5-74" tabindex="-1"></a>  )</span>
<span id="cb5-75"><a href="#cb5-75" tabindex="-1"></a>  </span>
<span id="cb5-76"><a href="#cb5-76" tabindex="-1"></a>  <span class="fu">return</span>(retval)</span>
<span id="cb5-77"><a href="#cb5-77" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">system.time</span>(tmp_out <span class="ot">&lt;-</span> <span class="fu">mapply</span>(fit_data,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                              <span class="at">this_error_model =</span> fitopts<span class="sc">$</span>error_model,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                              <span class="at">this_dose_norm =</span> fitopts<span class="sc">$</span>dose_norm,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>                              <span class="at">this_log10_trans =</span> fitopts<span class="sc">$</span>log10_trans,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                              <span class="at">this_time_scale =</span> fitopts<span class="sc">$</span>time_scale,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>                              <span class="at">n_cores =</span> <span class="dv">13</span>))</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">mean</span>(tmp_out)<span class="sc">/</span><span class="dv">60</span> <span class="co"># Average runtime (in minutes) per fitting option</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="fu">median</span>(tmp_out)<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="fu">sum</span>(tmp_out) <span class="co"># Looks like there&#39;s 10 extra seconds of overhead for non-fitting methods</span></span></code></pre></div>
</div>
</div>
<div id="evaluating-fitting-options" class="section level1">
<h1>Evaluating fitting options</h1>
<p>Here I evaluate the various fitting options by:</p>
<ul>
<li>Counting the number of 1-, 2-compartment and flat model fits that
had lowest AIC (winning model).<br />
</li>
<li>Summarizing the root mean squared log10 error between model fit and
NCA approximation of:
<ul>
<li>Cmax</li>
<li>AUC_infinity</li>
<li>(Counts and filters extreme values of log10(model/NCA) &gt;
log10(20) for AUC_infinity)<br />
</li>
<li>(Counts and filters non-finite and zero values of AUC_infinity)</li>
</ul></li>
<li>A summary goodness-of-fit table for each data group’s winning model
and fitting options that includes:
<ul>
<li>R-squared<br />
</li>
<li>RMSLE<br />
</li>
<li>AIC<br />
</li>
</ul></li>
<li>All predictions for each data group and fitting option (winning
models only)<br />
</li>
<li>Model errors within a factor of two for each fitting option</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Evaluation</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># Winning Model Tally</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>winmodel_comparison <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  </span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>                     today,</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>                     time_indic,</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>  </span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>  </span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>  pf <span class="ot">&lt;-</span> current_rds<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>    <span class="fu">distinct</span>(Chemical, Species, model, method, convcode) <span class="sc">%&gt;%</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>    <span class="fu">group_by</span>(method, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>    <span class="fu">count</span>(convcode) <span class="sc">%&gt;%</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> convcode,</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>                <span class="at">names_prefix =</span> <span class="st">&quot;convcode.&quot;</span>,</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>                <span class="at">values_from =</span> n)</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>    </span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>  </span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>  </span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>  <span class="co"># Wide winning model</span></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>    winning_model <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(<span class="at">obj =</span> current_rds)</span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>    wide_winning_model <span class="ot">&lt;-</span> winning_model <span class="sc">%&gt;%</span></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>      <span class="fu">group_by</span>(method, model) <span class="sc">%&gt;%</span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a>      <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> model, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a>      <span class="fu">left_join</span>(pf)</span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a>  })</span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>  <span class="fu">return</span>(wide_winning_model)</span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>}</span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co"># RMSLE for Cmax and AUC (with some tallys for extreme values)</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>rmsles_Cmax_AUC <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a>    this_error_model,</span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a>    this_dose_norm,</span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a>    this_log10_trans,</span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a>    this_time_scale) {</span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a>  </span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a>                     today,</span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a>                     time_indic,</span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a>  </span>
<span id="cb7-67"><a href="#cb7-67" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;Evaluation for: &quot;</span>, pk_name))</span>
<span id="cb7-68"><a href="#cb7-68" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb7-69"><a href="#cb7-69" tabindex="-1"></a>  <span class="co"># Cmax and AUC_inf RMSEs, eval_tkstats already filters winning models</span></span>
<span id="cb7-70"><a href="#cb7-70" tabindex="-1"></a>  RMSLE_eval <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(<span class="fu">eval_tkstats</span>(<span class="at">obj =</span> current_rds, </span>
<span id="cb7-71"><a href="#cb7-71" tabindex="-1"></a>                                             <span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-72"><a href="#cb7-72" tabindex="-1"></a>                                             <span class="at">finite_only =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-73"><a href="#cb7-73" tabindex="-1"></a>                                  <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name) <span class="sc">%&gt;%</span></span>
<span id="cb7-74"><a href="#cb7-74" tabindex="-1"></a>                                  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb7-75"><a href="#cb7-75" tabindex="-1"></a>                                    Options,</span>
<span id="cb7-76"><a href="#cb7-76" tabindex="-1"></a>                                    Chemical,</span>
<span id="cb7-77"><a href="#cb7-77" tabindex="-1"></a>                                    Species,</span>
<span id="cb7-78"><a href="#cb7-78" tabindex="-1"></a>                                    Route,</span>
<span id="cb7-79"><a href="#cb7-79" tabindex="-1"></a>                                    Media,</span>
<span id="cb7-80"><a href="#cb7-80" tabindex="-1"></a>                                    Reference,</span>
<span id="cb7-81"><a href="#cb7-81" tabindex="-1"></a>                                    method,</span>
<span id="cb7-82"><a href="#cb7-82" tabindex="-1"></a>                                    model,</span>
<span id="cb7-83"><a href="#cb7-83" tabindex="-1"></a>                                    <span class="fu">starts_with</span>(<span class="st">&quot;Cmax&quot;</span>),</span>
<span id="cb7-84"><a href="#cb7-84" tabindex="-1"></a>                                    <span class="fu">starts_with</span>(<span class="st">&quot;AUC_&quot;</span>)</span>
<span id="cb7-85"><a href="#cb7-85" tabindex="-1"></a>                                  ))</span>
<span id="cb7-86"><a href="#cb7-86" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;How many finite, non-zero comparisons had &quot;</span>,</span>
<span id="cb7-87"><a href="#cb7-87" tabindex="-1"></a>                 <span class="st">&quot;AUC_infinity.tkstats over/under 20X of AUC_infinity.nca?&quot;</span>))</span>
<span id="cb7-88"><a href="#cb7-88" tabindex="-1"></a>  <span class="fu">print</span>(</span>
<span id="cb7-89"><a href="#cb7-89" tabindex="-1"></a>    RMSLE_eval <span class="sc">%&gt;%</span></span>
<span id="cb7-90"><a href="#cb7-90" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb7-91"><a href="#cb7-91" tabindex="-1"></a>        AUC_infinity.nca <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb7-92"><a href="#cb7-92" tabindex="-1"></a>        AUC_infinity.tkstats <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-93"><a href="#cb7-93" tabindex="-1"></a>      <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb7-94"><a href="#cb7-94" tabindex="-1"></a>      <span class="fu">summarize</span>(</span>
<span id="cb7-95"><a href="#cb7-95" tabindex="-1"></a>        <span class="st">`</span><span class="at">AUC_folderror&gt;20X</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(</span>
<span id="cb7-96"><a href="#cb7-96" tabindex="-1"></a>          <span class="fu">log10</span>(AUC_infinity.tkstats<span class="sc">/</span>AUC_infinity.nca) <span class="sc">&gt;</span> <span class="fu">log10</span>(<span class="dv">20</span>)</span>
<span id="cb7-97"><a href="#cb7-97" tabindex="-1"></a>        )</span>
<span id="cb7-98"><a href="#cb7-98" tabindex="-1"></a>      )</span>
<span id="cb7-99"><a href="#cb7-99" tabindex="-1"></a>  )</span>
<span id="cb7-100"><a href="#cb7-100" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;How many comparisons had AUC_infinity equal to zero?&quot;</span>)</span>
<span id="cb7-101"><a href="#cb7-101" tabindex="-1"></a>  <span class="fu">print</span>(</span>
<span id="cb7-102"><a href="#cb7-102" tabindex="-1"></a>    RMSLE_eval <span class="sc">%&gt;%</span></span>
<span id="cb7-103"><a href="#cb7-103" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb7-104"><a href="#cb7-104" tabindex="-1"></a>        AUC_infinity.nca <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb7-105"><a href="#cb7-105" tabindex="-1"></a>        AUC_infinity.tkstats <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-106"><a href="#cb7-106" tabindex="-1"></a>      <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb7-107"><a href="#cb7-107" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">NCA_zeroAUC =</span> <span class="fu">sum</span>(AUC_infinity.nca <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb7-108"><a href="#cb7-108" tabindex="-1"></a>                <span class="at">tkstats_zeroAUC =</span><span class="fu">sum</span>(AUC_infinity.tkstats <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb7-109"><a href="#cb7-109" tabindex="-1"></a>  )</span>
<span id="cb7-110"><a href="#cb7-110" tabindex="-1"></a>  </span>
<span id="cb7-111"><a href="#cb7-111" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Removing those observations...&quot;</span>)</span>
<span id="cb7-112"><a href="#cb7-112" tabindex="-1"></a>  RMSLE_eval <span class="ot">&lt;-</span> RMSLE_eval <span class="sc">%&gt;%</span></span>
<span id="cb7-113"><a href="#cb7-113" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb7-114"><a href="#cb7-114" tabindex="-1"></a>      AUC_infinity.nca <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb7-115"><a href="#cb7-115" tabindex="-1"></a>      AUC_infinity.tkstats <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb7-116"><a href="#cb7-116" tabindex="-1"></a>      <span class="fu">log10</span>(AUC_infinity.tkstats<span class="sc">/</span>AUC_infinity.nca) <span class="sc">&lt;=</span> <span class="fu">log10</span>(<span class="dv">20</span>)</span>
<span id="cb7-117"><a href="#cb7-117" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-118"><a href="#cb7-118" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-119"><a href="#cb7-119" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb7-120"><a href="#cb7-120" tabindex="-1"></a>      <span class="at">SLE_Cmax =</span> (<span class="fu">log10</span>(Cmax.tkstats) <span class="sc">-</span> <span class="fu">log10</span>(Cmax.nca)) <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb7-121"><a href="#cb7-121" tabindex="-1"></a>      <span class="at">SLE_AUC_inf =</span> (<span class="fu">log10</span>(AUC_infinity.tkstats) <span class="sc">-</span> <span class="fu">log10</span>(AUC_infinity.nca)) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb7-122"><a href="#cb7-122" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-123"><a href="#cb7-123" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SLE_Cmax), <span class="sc">!</span><span class="fu">is.na</span>(SLE_AUC_inf)) <span class="sc">%&gt;%</span></span>
<span id="cb7-124"><a href="#cb7-124" tabindex="-1"></a>    <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb7-125"><a href="#cb7-125" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb7-126"><a href="#cb7-126" tabindex="-1"></a>      <span class="at">RMSLE_Cmax =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(SLE_Cmax, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>),</span>
<span id="cb7-127"><a href="#cb7-127" tabindex="-1"></a>      <span class="at">RMSLE_AUC =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(SLE_AUC_inf, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb7-128"><a href="#cb7-128" tabindex="-1"></a>    )</span>
<span id="cb7-129"><a href="#cb7-129" tabindex="-1"></a>  </span>
<span id="cb7-130"><a href="#cb7-130" tabindex="-1"></a>  <span class="fu">print</span>(RMSLE_eval)</span>
<span id="cb7-131"><a href="#cb7-131" tabindex="-1"></a>  </span>
<span id="cb7-132"><a href="#cb7-132" tabindex="-1"></a>  <span class="fu">return</span>(RMSLE_eval)</span>
<span id="cb7-133"><a href="#cb7-133" tabindex="-1"></a>}</span>
<span id="cb7-134"><a href="#cb7-134" tabindex="-1"></a></span>
<span id="cb7-135"><a href="#cb7-135" tabindex="-1"></a><span class="co"># Goodness-of-fit table with R-squared, RMSLE and AIC</span></span>
<span id="cb7-136"><a href="#cb7-136" tabindex="-1"></a>get_gof <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb7-137"><a href="#cb7-137" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb7-138"><a href="#cb7-138" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb7-139"><a href="#cb7-139" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb7-140"><a href="#cb7-140" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb7-141"><a href="#cb7-141" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb7-142"><a href="#cb7-142" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb7-143"><a href="#cb7-143" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-144"><a href="#cb7-144" tabindex="-1"></a>  </span>
<span id="cb7-145"><a href="#cb7-145" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb7-146"><a href="#cb7-146" tabindex="-1"></a>                     today,</span>
<span id="cb7-147"><a href="#cb7-147" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb7-148"><a href="#cb7-148" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb7-149"><a href="#cb7-149" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb7-150"><a href="#cb7-150" tabindex="-1"></a>                     time_indic,</span>
<span id="cb7-151"><a href="#cb7-151" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb7-152"><a href="#cb7-152" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb7-153"><a href="#cb7-153" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb7-154"><a href="#cb7-154" tabindex="-1"></a>  </span>
<span id="cb7-155"><a href="#cb7-155" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb7-156"><a href="#cb7-156" tabindex="-1"></a>  winning_model <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(<span class="fu">get_winning_model</span>(<span class="at">obj =</span> current_rds))</span>
<span id="cb7-157"><a href="#cb7-157" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb7-158"><a href="#cb7-158" tabindex="-1"></a>    this_rsq <span class="ot">&lt;-</span> <span class="fu">rsq</span>(current_rds,</span>
<span id="cb7-159"><a href="#cb7-159" tabindex="-1"></a>                    <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-160"><a href="#cb7-160" tabindex="-1"></a>                    <span class="at">rsq_group =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(Chemical, Species)) <span class="sc">%&gt;%</span></span>
<span id="cb7-161"><a href="#cb7-161" tabindex="-1"></a>      <span class="fu">semi_join</span>(winning_model)</span>
<span id="cb7-162"><a href="#cb7-162" tabindex="-1"></a>    this_AIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(current_rds) <span class="sc">%&gt;%</span></span>
<span id="cb7-163"><a href="#cb7-163" tabindex="-1"></a>      <span class="fu">semi_join</span>(winning_model)</span>
<span id="cb7-164"><a href="#cb7-164" tabindex="-1"></a>    </span>
<span id="cb7-165"><a href="#cb7-165" tabindex="-1"></a>    this_rmsle <span class="ot">&lt;-</span> <span class="fu">rmse.pk</span>(current_rds,</span>
<span id="cb7-166"><a href="#cb7-166" tabindex="-1"></a>                      <span class="at">rmse_group =</span> <span class="fu">vars</span>(Chemical, Species),</span>
<span id="cb7-167"><a href="#cb7-167" tabindex="-1"></a>                      <span class="at">use_scale_conc =</span> <span class="fu">list</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-168"><a href="#cb7-168" tabindex="-1"></a>                                            <span class="at">log10_trans =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-169"><a href="#cb7-169" tabindex="-1"></a>      <span class="fu">semi_join</span>(winning_model)</span>
<span id="cb7-170"><a href="#cb7-170" tabindex="-1"></a>  })</span>
<span id="cb7-171"><a href="#cb7-171" tabindex="-1"></a>  </span>
<span id="cb7-172"><a href="#cb7-172" tabindex="-1"></a>  <span class="co"># Since they are all joined by winmodel</span></span>
<span id="cb7-173"><a href="#cb7-173" tabindex="-1"></a>  <span class="co"># all three must have same NROW</span></span>
<span id="cb7-174"><a href="#cb7-174" tabindex="-1"></a>  <span class="fu">message</span>(</span>
<span id="cb7-175"><a href="#cb7-175" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;For &quot;</span>, pk_name, <span class="st">&quot;... outputs below must have same number of rows&quot;</span>)</span>
<span id="cb7-176"><a href="#cb7-176" tabindex="-1"></a>  )</span>
<span id="cb7-177"><a href="#cb7-177" tabindex="-1"></a>  </span>
<span id="cb7-178"><a href="#cb7-178" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;rsq: &quot;</span>, <span class="fu">NROW</span>(this_rsq)))</span>
<span id="cb7-179"><a href="#cb7-179" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;aic: &quot;</span>, <span class="fu">NROW</span>(this_AIC)))</span>
<span id="cb7-180"><a href="#cb7-180" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;rmsle: &quot;</span>, <span class="fu">NROW</span>(this_rmsle)))</span>
<span id="cb7-181"><a href="#cb7-181" tabindex="-1"></a>  </span>
<span id="cb7-182"><a href="#cb7-182" tabindex="-1"></a>  gof_df <span class="ot">&lt;-</span> this_rsq <span class="sc">%&gt;%</span></span>
<span id="cb7-183"><a href="#cb7-183" tabindex="-1"></a>    <span class="fu">inner_join</span>(this_AIC, <span class="at">by =</span> <span class="fu">join_by</span>(Chemical, Species, method, model)) <span class="sc">%&gt;%</span></span>
<span id="cb7-184"><a href="#cb7-184" tabindex="-1"></a>    <span class="fu">inner_join</span>(this_rmsle, <span class="at">by =</span> <span class="fu">join_by</span>(Chemical, Species, method, model)) <span class="sc">%&gt;%</span></span>
<span id="cb7-185"><a href="#cb7-185" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name, <span class="at">.before =</span> Chemical)</span>
<span id="cb7-186"><a href="#cb7-186" tabindex="-1"></a>  </span>
<span id="cb7-187"><a href="#cb7-187" tabindex="-1"></a>  </span>
<span id="cb7-188"><a href="#cb7-188" tabindex="-1"></a>  </span>
<span id="cb7-189"><a href="#cb7-189" tabindex="-1"></a>  <span class="fu">return</span>(gof_df)</span>
<span id="cb7-190"><a href="#cb7-190" tabindex="-1"></a>}</span>
<span id="cb7-191"><a href="#cb7-191" tabindex="-1"></a></span>
<span id="cb7-192"><a href="#cb7-192" tabindex="-1"></a></span>
<span id="cb7-193"><a href="#cb7-193" tabindex="-1"></a><span class="co"># All predictions </span></span>
<span id="cb7-194"><a href="#cb7-194" tabindex="-1"></a>get_all_preds <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb7-195"><a href="#cb7-195" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb7-196"><a href="#cb7-196" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb7-197"><a href="#cb7-197" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb7-198"><a href="#cb7-198" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb7-199"><a href="#cb7-199" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb7-200"><a href="#cb7-200" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb7-201"><a href="#cb7-201" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-202"><a href="#cb7-202" tabindex="-1"></a>  </span>
<span id="cb7-203"><a href="#cb7-203" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb7-204"><a href="#cb7-204" tabindex="-1"></a>                     today,</span>
<span id="cb7-205"><a href="#cb7-205" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb7-206"><a href="#cb7-206" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb7-207"><a href="#cb7-207" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb7-208"><a href="#cb7-208" tabindex="-1"></a>                     time_indic,</span>
<span id="cb7-209"><a href="#cb7-209" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb7-210"><a href="#cb7-210" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb7-211"><a href="#cb7-211" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb7-212"><a href="#cb7-212" tabindex="-1"></a>  </span>
<span id="cb7-213"><a href="#cb7-213" tabindex="-1"></a>  </span>
<span id="cb7-214"><a href="#cb7-214" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb7-215"><a href="#cb7-215" tabindex="-1"></a>  </span>
<span id="cb7-216"><a href="#cb7-216" tabindex="-1"></a>  <span class="co"># Wide winning model</span></span>
<span id="cb7-217"><a href="#cb7-217" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb7-218"><a href="#cb7-218" tabindex="-1"></a>    winning_model <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(<span class="at">obj =</span> current_rds) <span class="sc">%&gt;%</span></span>
<span id="cb7-219"><a href="#cb7-219" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(near_flat, preds_below_loq))</span>
<span id="cb7-220"><a href="#cb7-220" tabindex="-1"></a>    this_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(current_rds,</span>
<span id="cb7-221"><a href="#cb7-221" tabindex="-1"></a>                          <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-222"><a href="#cb7-222" tabindex="-1"></a>      <span class="fu">semi_join</span>(winning_model) <span class="sc">%&gt;%</span></span>
<span id="cb7-223"><a href="#cb7-223" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name, <span class="at">.before =</span> Chemical)</span>
<span id="cb7-224"><a href="#cb7-224" tabindex="-1"></a>  })</span>
<span id="cb7-225"><a href="#cb7-225" tabindex="-1"></a>  <span class="fu">return</span>(this_preds)</span>
<span id="cb7-226"><a href="#cb7-226" tabindex="-1"></a>}</span>
<span id="cb7-227"><a href="#cb7-227" tabindex="-1"></a></span>
<span id="cb7-228"><a href="#cb7-228" tabindex="-1"></a><span class="co"># Factor of two model error</span></span>
<span id="cb7-229"><a href="#cb7-229" tabindex="-1"></a>tf_tests <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb7-230"><a href="#cb7-230" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb7-231"><a href="#cb7-231" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb7-232"><a href="#cb7-232" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb7-233"><a href="#cb7-233" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb7-234"><a href="#cb7-234" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb7-235"><a href="#cb7-235" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb7-236"><a href="#cb7-236" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-237"><a href="#cb7-237" tabindex="-1"></a>  </span>
<span id="cb7-238"><a href="#cb7-238" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb7-239"><a href="#cb7-239" tabindex="-1"></a>                     today,</span>
<span id="cb7-240"><a href="#cb7-240" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb7-241"><a href="#cb7-241" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb7-242"><a href="#cb7-242" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb7-243"><a href="#cb7-243" tabindex="-1"></a>                     time_indic,</span>
<span id="cb7-244"><a href="#cb7-244" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb7-245"><a href="#cb7-245" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb7-246"><a href="#cb7-246" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb7-247"><a href="#cb7-247" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb7-248"><a href="#cb7-248" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Now analyzing: &quot;</span>, pk_name))</span>
<span id="cb7-249"><a href="#cb7-249" tabindex="-1"></a>  </span>
<span id="cb7-250"><a href="#cb7-250" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">twofold_test</span>(current_rds, <span class="at">suppress_messages =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-251"><a href="#cb7-251" tabindex="-1"></a>  </span>
<span id="cb7-252"><a href="#cb7-252" tabindex="-1"></a>  out <span class="ot">&lt;-</span> out<span class="sc">$</span>model_error_summary <span class="sc">%&gt;%</span></span>
<span id="cb7-253"><a href="#cb7-253" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name)</span>
<span id="cb7-254"><a href="#cb7-254" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">system.time</span>(wm_comp <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">winmodel_comp =</span> <span class="fu">list</span>(</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                <span class="fu">winmodel_comparison</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(winmodel_comp))</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="fu">system.time</span>(cmax_auc_rmsle_tbl <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">nca_comp =</span> <span class="fu">list</span>(</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>                <span class="fu">rmsles_Cmax_AUC</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(nca_comp))</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="fu">system.time</span>(gof_tbl <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">gof_win =</span> <span class="fu">list</span>(</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>                <span class="fu">get_gof</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(gof_win))</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="fu">system.time</span>(all_tf_tests <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">TF =</span> <span class="fu">list</span>(</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>                <span class="fu">tf_tests</span>(error_model,</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>                         <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>                         <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>                         <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(TF))</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a><span class="fu">system.time</span>(all_preds <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">these_preds =</span> <span class="fu">list</span>(</span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>                <span class="fu">get_all_preds</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(these_preds))</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a>            </span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<div id="general-observations" class="section level3">
<h3>General Observations</h3>
<ul>
<li>The time_scaling generally makes things worse.<br />
</li>
<li>L-BFGS-B had a difficult time fitting with new restriction,
generally worse estimates.</li>
<li>log10_trans generally improves RMSLE, at a small expense of
R-squared.
<ul>
<li>All log10_trans options have at least 10 more data_groups with RMSLE
&lt; 10 than the non-log10 transformed.</li>
</ul></li>
<li>There are some cases where fits are bad due to a combination of
factors, most interestingly error model, dose_norm, and optimizer.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Writing to file</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="at">x =</span> <span class="fu">list</span>(</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">Fit_Counts =</span> wm_comp,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="at">AUC_and_Cmax_RMSE_summary =</span> cmax_auc_rmsle_tbl,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="at">Prediction_Evaluations =</span> gof_tbl,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="at">Twofold_Tests =</span> all_tf_tests),</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>                today,</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>                <span class="st">&quot;_Supp_Table1&quot;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>                <span class="st">&quot;.xlsx&quot;</span>))</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>gof_tbl <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>                                                   <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>                                                   today,</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>                                                   <span class="st">&quot;_Supp_Table1.xlsx&quot;</span>),</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>                                     <span class="at">sheet =</span> <span class="st">&quot;Prediction_Evaluations&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RMSLE =</span> <span class="fu">as.numeric</span>(RMSLE))</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>wm_comp <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>                                                   <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>                                                   today,</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>                                                   <span class="st">&quot;_Supp_Table1.xlsx&quot;</span>),</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>                                     <span class="at">sheet =</span> <span class="st">&quot;Fit_Counts&quot;</span>)</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>cmax_auc_rmsle_tbl <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>                                                   <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>                                                   today,</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>                                                   <span class="st">&quot;_Supp_Table1.xlsx&quot;</span>),</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>                                     <span class="at">sheet =</span> <span class="st">&quot;AUC_and_Cmax_RMSE_summary&quot;</span>)</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>  <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>  <span class="fu">count</span>(RMSLE <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">RMSLE &lt; 1</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">8</span>)</span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co"># bobyqa-optimized options 010h, 110h, 110p</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>wm_comp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">%in%</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>                   <span class="sc">!</span>time_scale, log10_trans)</span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="co"># Off these, there is one more data group that is model_flat</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="co"># I will remove this so it doesn&#39;t affect downstream analyses</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Options <span class="sc">==</span> <span class="st">&quot;110p&quot;</span>, model <span class="sc">==</span> <span class="st">&quot;model_flat&quot;</span>,</span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a>                   method <span class="sc">==</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(Chemical, Species)</span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Options <span class="sc">==</span> <span class="st">&quot;110h&quot;</span>, model <span class="sc">==</span> <span class="st">&quot;model_flat&quot;</span>,</span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a>                   method <span class="sc">==</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(Chemical, Species)</span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Options <span class="sc">==</span> <span class="st">&quot;010h&quot;</span>, model <span class="sc">==</span> <span class="st">&quot;model_flat&quot;</span>,</span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a>                   method <span class="sc">==</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(Chemical, Species)</span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Options <span class="sc">==</span> <span class="st">&quot;010p&quot;</span>, model <span class="sc">==</span> <span class="st">&quot;model_flat&quot;</span>,</span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a>                   method <span class="sc">==</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(Chemical, Species)</span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Options <span class="sc">==</span> <span class="st">&quot;010h&quot;</span>,</span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a>                   method <span class="sc">==</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a>                   Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID1021116&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species)</span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="co"># Filter out DTXSID1021116</span></span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb9-59"><a href="#cb9-59" tabindex="-1"></a>  <span class="fu">anti_join</span>(<span class="fu">data.frame</span>(<span class="at">Chemical =</span> <span class="st">&quot;DTXSID1021116&quot;</span>, <span class="at">Species =</span> <span class="st">&quot;rat&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-60"><a href="#cb9-60" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(model <span class="sc">%in%</span> <span class="st">&quot;model_flat&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-61"><a href="#cb9-61" tabindex="-1"></a>  <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb9-62"><a href="#cb9-62" tabindex="-1"></a>  <span class="fu">count</span>(RMSLE <span class="sc">&lt;</span> <span class="fl">0.7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-63"><a href="#cb9-63" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">RMSLE &lt; 0.7</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-64"><a href="#cb9-64" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb9-65"><a href="#cb9-65" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">8</span>)</span>
<span id="cb9-66"><a href="#cb9-66" tabindex="-1"></a><span class="co"># 110p seems to win out here.</span></span>
<span id="cb9-67"><a href="#cb9-67" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb9-69"><a href="#cb9-69" tabindex="-1"></a>  <span class="fu">filter</span>(method <span class="sc">%in%</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb9-70"><a href="#cb9-70" tabindex="-1"></a>         Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;110p&quot;</span>, <span class="st">&quot;010h&quot;</span>, <span class="st">&quot;110h&quot;</span>)</span>
<span id="cb9-71"><a href="#cb9-71" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span></span>
<span id="cb9-72"><a href="#cb9-72" tabindex="-1"></a>  <span class="fu">anti_join</span>(<span class="fu">data.frame</span>(<span class="at">Chemical =</span> <span class="st">&quot;DTXSID1021116&quot;</span>, <span class="at">Species =</span> <span class="st">&quot;rat&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-73"><a href="#cb9-73" tabindex="-1"></a>  <span class="fu">group_by</span>(Options) <span class="sc">%&gt;%</span></span>
<span id="cb9-74"><a href="#cb9-74" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medianR2 =</span> <span class="fu">median</span>(Rsq, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-75"><a href="#cb9-75" tabindex="-1"></a></span>
<span id="cb9-76"><a href="#cb9-76" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb9-77"><a href="#cb9-77" tabindex="-1"></a>  <span class="fu">filter</span>(method <span class="sc">%in%</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb9-78"><a href="#cb9-78" tabindex="-1"></a>         Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;110p&quot;</span>, <span class="st">&quot;010h&quot;</span>, <span class="st">&quot;110h&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-79"><a href="#cb9-79" tabindex="-1"></a>  <span class="fu">anti_join</span>(<span class="fu">data.frame</span>(<span class="at">Chemical =</span> <span class="st">&quot;DTXSID1021116&quot;</span>, <span class="at">Species =</span> <span class="st">&quot;rat&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-80"><a href="#cb9-80" tabindex="-1"></a>  <span class="fu">group_by</span>(Options) <span class="sc">%&gt;%</span></span>
<span id="cb9-81"><a href="#cb9-81" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">medianR2 =</span> <span class="fu">mean</span>(Rsq, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-82"><a href="#cb9-82" tabindex="-1"></a><span class="co"># Here we see that the highest median Rsq is for 110p</span></span>
<span id="cb9-83"><a href="#cb9-83" tabindex="-1"></a><span class="co"># I use median because the distribution is skewed towards 1.</span></span>
<span id="cb9-84"><a href="#cb9-84" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb9-85"><a href="#cb9-85" tabindex="-1"></a>  <span class="fu">filter</span>(method <span class="sc">%in%</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb9-86"><a href="#cb9-86" tabindex="-1"></a>         Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;110p&quot;</span>, <span class="st">&quot;010h&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-87"><a href="#cb9-87" tabindex="-1"></a>  <span class="fu">anti_join</span>(<span class="fu">data.frame</span>(<span class="at">Chemical =</span> <span class="st">&quot;DTXSID1021116&quot;</span>, <span class="at">Species =</span> <span class="st">&quot;rat&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-88"><a href="#cb9-88" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species, Options, Rsq) <span class="sc">%&gt;%</span></span>
<span id="cb9-89"><a href="#cb9-89" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Options, <span class="at">values_from =</span> Rsq) <span class="sc">%&gt;%</span> </span>
<span id="cb9-90"><a href="#cb9-90" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">110p</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">010h</span><span class="st">`</span>)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb9-91"><a href="#cb9-91" tabindex="-1"></a><span class="co">#110h is most even between models</span></span>
<span id="cb9-92"><a href="#cb9-92" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" tabindex="-1"></a></span>
<span id="cb9-94"><a href="#cb9-94" tabindex="-1"></a>cmax_auc_rmsle_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb9-95"><a href="#cb9-95" tabindex="-1"></a>  <span class="fu">filter</span>(Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;010h&quot;</span>, <span class="st">&quot;110p&quot;</span>, <span class="st">&quot;110h&quot;</span>),</span>
<span id="cb9-96"><a href="#cb9-96" tabindex="-1"></a>         method <span class="sc">%in%</span> <span class="st">&quot;bobyqa&quot;</span>)</span>
<span id="cb9-97"><a href="#cb9-97" tabindex="-1"></a><span class="co"># Here it is clear that 110p results in the </span></span>
<span id="cb9-98"><a href="#cb9-98" tabindex="-1"></a></span>
<span id="cb9-99"><a href="#cb9-99" tabindex="-1"></a>all_tf_tests <span class="sc">%&gt;%</span></span>
<span id="cb9-100"><a href="#cb9-100" tabindex="-1"></a>  <span class="fu">filter</span>(Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;110p&quot;</span>, <span class="st">&quot;110h&quot;</span>, <span class="st">&quot;010h&quot;</span>),</span>
<span id="cb9-101"><a href="#cb9-101" tabindex="-1"></a>         model <span class="sc">%in%</span> <span class="st">&quot;All non-flat&quot;</span>,</span>
<span id="cb9-102"><a href="#cb9-102" tabindex="-1"></a>         method <span class="sc">%in%</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-103"><a href="#cb9-103" tabindex="-1"></a>  <span class="fu">select</span>(Options, model, <span class="fu">starts_with</span>(<span class="st">&quot;percent_&quot;</span>))</span>
<span id="cb9-104"><a href="#cb9-104" tabindex="-1"></a><span class="co"># Relatively similar here</span></span>
<span id="cb9-105"><a href="#cb9-105" tabindex="-1"></a></span>
<span id="cb9-106"><a href="#cb9-106" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" tabindex="-1"></a>cmaxAUCpl <span class="ot">&lt;-</span> cmax_auc_rmsle_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb9-108"><a href="#cb9-108" tabindex="-1"></a>  <span class="fu">filter</span>(RMSLE_AUC <span class="sc">&lt;</span> <span class="fl">0.8</span>, RMSLE_Cmax <span class="sc">&lt;</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-109"><a href="#cb9-109" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> RMSLE_AUC, <span class="at">y =</span> RMSLE_Cmax,</span>
<span id="cb9-110"><a href="#cb9-110" tabindex="-1"></a>             <span class="at">shape =</span> method, <span class="at">fill =</span> Options)) <span class="sc">+</span></span>
<span id="cb9-111"><a href="#cb9-111" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>,<span class="dv">22</span>))<span class="sc">+</span></span>
<span id="cb9-112"><a href="#cb9-112" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>)<span class="sc">+</span></span>
<span id="cb9-113"><a href="#cb9-113" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">stroke =</span> <span class="fl">0.5</span>)  <span class="sc">+</span></span>
<span id="cb9-114"><a href="#cb9-114" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">21</span>))) <span class="sc">+</span></span>
<span id="cb9-115"><a href="#cb9-115" tabindex="-1"></a>  <span class="co"># coord_equal(xlim = c(0.3, 0.45), ylim = c(0.3, 0.4), expand = TRUE) +</span></span>
<span id="cb9-116"><a href="#cb9-116" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;AUC RMSLE&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Cmax RMSLE&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-117"><a href="#cb9-117" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-118"><a href="#cb9-118" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb9-119"><a href="#cb9-119" tabindex="-1"></a>                                    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb9-120"><a href="#cb9-120" tabindex="-1"></a>                                    <span class="at">linewidth =</span> <span class="dv">2</span>))</span>
<span id="cb9-121"><a href="#cb9-121" tabindex="-1"></a>cmaxAUCpl</span>
<span id="cb9-122"><a href="#cb9-122" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-123"><a href="#cb9-123" tabindex="-1"></a>              today,</span>
<span id="cb9-124"><a href="#cb9-124" tabindex="-1"></a>              <span class="st">&quot;CmaxAUC_RMSLE_plotFinalists.png&quot;</span>),</span>
<span id="cb9-125"><a href="#cb9-125" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb9-126"><a href="#cb9-126" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.25</span>,</span>
<span id="cb9-127"><a href="#cb9-127" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">3.5</span>,</span>
<span id="cb9-128"><a href="#cb9-128" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb9-129"><a href="#cb9-129" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb9-130"><a href="#cb9-130" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb9-131"><a href="#cb9-131" tabindex="-1"></a></span>
<span id="cb9-132"><a href="#cb9-132" tabindex="-1"></a></span>
<span id="cb9-133"><a href="#cb9-133" tabindex="-1"></a><span class="co"># Plot Rsq</span></span>
<span id="cb9-134"><a href="#cb9-134" tabindex="-1"></a>violin_rmsle <span class="ot">&lt;-</span> gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb9-135"><a href="#cb9-135" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(model <span class="sc">%in%</span> <span class="st">&quot;model_flat&quot;</span>),</span>
<span id="cb9-136"><a href="#cb9-136" tabindex="-1"></a>         Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;010h&quot;</span>, <span class="st">&quot;010p&quot;</span>, </span>
<span id="cb9-137"><a href="#cb9-137" tabindex="-1"></a>                        <span class="st">&quot;111h&quot;</span>, <span class="st">&quot;111p&quot;</span>,</span>
<span id="cb9-138"><a href="#cb9-138" tabindex="-1"></a>                        <span class="st">&quot;110h&quot;</span>, <span class="st">&quot;110p&quot;</span>),</span>
<span id="cb9-139"><a href="#cb9-139" tabindex="-1"></a>         RMSLE <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-140"><a href="#cb9-140" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-141"><a href="#cb9-141" tabindex="-1"></a>  <span class="fu">geom_violin</span>(</span>
<span id="cb9-142"><a href="#cb9-142" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-143"><a href="#cb9-143" tabindex="-1"></a>        <span class="at">y =</span> RMSLE,</span>
<span id="cb9-144"><a href="#cb9-144" tabindex="-1"></a>        <span class="at">color =</span> <span class="fu">interaction</span>(error_model, method)),</span>
<span id="cb9-145"><a href="#cb9-145" tabindex="-1"></a>    <span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb9-146"><a href="#cb9-146" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Options)) <span class="sc">+</span></span>
<span id="cb9-147"><a href="#cb9-147" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-148"><a href="#cb9-148" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;RMSLE&quot;</span>,</span>
<span id="cb9-149"><a href="#cb9-149" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Error Model.Optimizer&quot;</span>,</span>
<span id="cb9-150"><a href="#cb9-150" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;(values 10 or under)&quot;</span>,</span>
<span id="cb9-151"><a href="#cb9-151" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-152"><a href="#cb9-152" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb9-153"><a href="#cb9-153" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-154"><a href="#cb9-154" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb9-155"><a href="#cb9-155" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb9-156"><a href="#cb9-156" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb9-157"><a href="#cb9-157" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-158"><a href="#cb9-158" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-159"><a href="#cb9-159" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb9-160"><a href="#cb9-160" tabindex="-1"></a>        )</span>
<span id="cb9-161"><a href="#cb9-161" tabindex="-1"></a></span>
<span id="cb9-162"><a href="#cb9-162" tabindex="-1"></a>violin_rsq <span class="ot">&lt;-</span> gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb9-163"><a href="#cb9-163" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(model <span class="sc">%in%</span> <span class="st">&quot;model_flat&quot;</span>),</span>
<span id="cb9-164"><a href="#cb9-164" tabindex="-1"></a>         Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;010h&quot;</span>, <span class="st">&quot;010p&quot;</span>,</span>
<span id="cb9-165"><a href="#cb9-165" tabindex="-1"></a>                        <span class="st">&quot;111h&quot;</span>, <span class="st">&quot;111p&quot;</span>,</span>
<span id="cb9-166"><a href="#cb9-166" tabindex="-1"></a>                        <span class="st">&quot;110h&quot;</span>, <span class="st">&quot;110p&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-167"><a href="#cb9-167" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-168"><a href="#cb9-168" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-169"><a href="#cb9-169" tabindex="-1"></a>                  <span class="at">y =</span> Rsq,</span>
<span id="cb9-170"><a href="#cb9-170" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">interaction</span>(error_model, method)),</span>
<span id="cb9-171"><a href="#cb9-171" tabindex="-1"></a>              <span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb9-172"><a href="#cb9-172" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Options)) <span class="sc">+</span></span>
<span id="cb9-173"><a href="#cb9-173" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-174"><a href="#cb9-174" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;R-squared&quot;</span>,</span>
<span id="cb9-175"><a href="#cb9-175" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Error Model.Optimizer&quot;</span>,</span>
<span id="cb9-176"><a href="#cb9-176" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-177"><a href="#cb9-177" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb9-178"><a href="#cb9-178" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-179"><a href="#cb9-179" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb9-180"><a href="#cb9-180" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb9-181"><a href="#cb9-181" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb9-182"><a href="#cb9-182" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-183"><a href="#cb9-183" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-184"><a href="#cb9-184" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb9-185"><a href="#cb9-185" tabindex="-1"></a>        )</span>
<span id="cb9-186"><a href="#cb9-186" tabindex="-1"></a></span>
<span id="cb9-187"><a href="#cb9-187" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(violin_rmsle, violin_rsq),</span>
<span id="cb9-188"><a href="#cb9-188" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">&quot;v&quot;</span>)</span>
<span id="cb9-189"><a href="#cb9-189" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb9-190"><a href="#cb9-190" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(</span>
<span id="cb9-191"><a href="#cb9-191" tabindex="-1"></a>    <span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-192"><a href="#cb9-192" tabindex="-1"></a>    today,</span>
<span id="cb9-193"><a href="#cb9-193" tabindex="-1"></a>    <span class="st">&quot;_RMSLE_Rsquared_ViolinPlots_selectOptions.png&quot;</span></span>
<span id="cb9-194"><a href="#cb9-194" tabindex="-1"></a>    ),</span>
<span id="cb9-195"><a href="#cb9-195" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb9-196"><a href="#cb9-196" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb9-197"><a href="#cb9-197" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">&quot;in&quot;</span></span>
<span id="cb9-198"><a href="#cb9-198" tabindex="-1"></a>  )</span>
<span id="cb9-199"><a href="#cb9-199" tabindex="-1"></a></span>
<span id="cb9-200"><a href="#cb9-200" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb9-201"><a href="#cb9-201" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(model <span class="sc">%in%</span> <span class="st">&quot;model_flat&quot;</span>),</span>
<span id="cb9-202"><a href="#cb9-202" tabindex="-1"></a>         Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;010h&quot;</span>, <span class="st">&quot;010p&quot;</span>,</span>
<span id="cb9-203"><a href="#cb9-203" tabindex="-1"></a>                        <span class="st">&quot;111h&quot;</span>, <span class="st">&quot;111p&quot;</span>,</span>
<span id="cb9-204"><a href="#cb9-204" tabindex="-1"></a>                        <span class="st">&quot;110h&quot;</span>, <span class="st">&quot;110p&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-205"><a href="#cb9-205" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-206"><a href="#cb9-206" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Rsq, <span class="at">y =</span> RMSLE,</span>
<span id="cb9-207"><a href="#cb9-207" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">interaction</span>(method, model)),</span>
<span id="cb9-208"><a href="#cb9-208" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-209"><a href="#cb9-209" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Options) <span class="sc">+</span></span>
<span id="cb9-210"><a href="#cb9-210" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-211"><a href="#cb9-211" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-212"><a href="#cb9-212" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb9-213"><a href="#cb9-213" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb9-214"><a href="#cb9-214" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">TRUE</span></span>
<span id="cb9-215"><a href="#cb9-215" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb9-216"><a href="#cb9-216" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb9-217"><a href="#cb9-217" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb9-218"><a href="#cb9-218" tabindex="-1"></a></span>
<span id="cb9-219"><a href="#cb9-219" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb9-220"><a href="#cb9-220" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(</span>
<span id="cb9-221"><a href="#cb9-221" tabindex="-1"></a>    <span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-222"><a href="#cb9-222" tabindex="-1"></a>    today,</span>
<span id="cb9-223"><a href="#cb9-223" tabindex="-1"></a>    <span class="st">&quot;_RMSLE_Rsquared_ScatterPlot.png&quot;</span></span>
<span id="cb9-224"><a href="#cb9-224" tabindex="-1"></a>    ),</span>
<span id="cb9-225"><a href="#cb9-225" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">7</span>,</span>
<span id="cb9-226"><a href="#cb9-226" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb9-227"><a href="#cb9-227" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">&quot;in&quot;</span></span>
<span id="cb9-228"><a href="#cb9-228" tabindex="-1"></a>  )</span>
<span id="cb9-229"><a href="#cb9-229" tabindex="-1"></a></span>
<span id="cb9-230"><a href="#cb9-230" tabindex="-1"></a>rmsle_hist <span class="ot">&lt;-</span> gof_tbl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">!=</span> <span class="st">&quot;model_flat&quot;</span>,</span>
<span id="cb9-231"><a href="#cb9-231" tabindex="-1"></a>                   Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;100p&quot;</span>, <span class="st">&quot;010h&quot;</span>, <span class="st">&quot;110p&quot;</span>, <span class="st">&quot;110h&quot;</span>),</span>
<span id="cb9-232"><a href="#cb9-232" tabindex="-1"></a>                   method <span class="sc">==</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-233"><a href="#cb9-233" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> RMSLE)) <span class="sc">+</span></span>
<span id="cb9-234"><a href="#cb9-234" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb9-235"><a href="#cb9-235" tabindex="-1"></a>                 <span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb9-236"><a href="#cb9-236" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_math</span>()) <span class="sc">+</span></span>
<span id="cb9-237"><a href="#cb9-237" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-238"><a href="#cb9-238" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Options),</span>
<span id="cb9-239"><a href="#cb9-239" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(method)) <span class="sc">+</span></span>
<span id="cb9-240"><a href="#cb9-240" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb9-241"><a href="#cb9-241" tabindex="-1"></a>  </span>
<span id="cb9-242"><a href="#cb9-242" tabindex="-1"></a>rmsle_hist</span>
<span id="cb9-243"><a href="#cb9-243" tabindex="-1"></a></span>
<span id="cb9-244"><a href="#cb9-244" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb9-245"><a href="#cb9-245" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(</span>
<span id="cb9-246"><a href="#cb9-246" tabindex="-1"></a>    <span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-247"><a href="#cb9-247" tabindex="-1"></a>    today,</span>
<span id="cb9-248"><a href="#cb9-248" tabindex="-1"></a>    <span class="st">&quot;_RMSLE_histogram_topChoices.png&quot;</span></span>
<span id="cb9-249"><a href="#cb9-249" tabindex="-1"></a>    ),</span>
<span id="cb9-250"><a href="#cb9-250" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb9-251"><a href="#cb9-251" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb9-252"><a href="#cb9-252" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">&quot;in&quot;</span></span>
<span id="cb9-253"><a href="#cb9-253" tabindex="-1"></a>  )</span>
<span id="cb9-254"><a href="#cb9-254" tabindex="-1"></a></span>
<span id="cb9-255"><a href="#cb9-255" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb9-256"><a href="#cb9-256" tabindex="-1"></a>  <span class="at">plotlist =</span> <span class="fu">list</span>(rmsle_hist,</span>
<span id="cb9-257"><a href="#cb9-257" tabindex="-1"></a>                  cmaxAUCpl <span class="sc">+</span></span>
<span id="cb9-258"><a href="#cb9-258" tabindex="-1"></a>                    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb9-259"><a href="#cb9-259" tabindex="-1"></a>                                               <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">21</span>)),</span>
<span id="cb9-260"><a href="#cb9-260" tabindex="-1"></a>                           <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb9-261"><a href="#cb9-261" tabindex="-1"></a>                    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb9-262"><a href="#cb9-262" tabindex="-1"></a>                          <span class="at">legend.title.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb9-263"><a href="#cb9-263" tabindex="-1"></a>  ),</span>
<span id="cb9-264"><a href="#cb9-264" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.75</span>),</span>
<span id="cb9-265"><a href="#cb9-265" tabindex="-1"></a>  <span class="at">labels =</span> <span class="st">&quot;AUTO&quot;</span>)</span>
<span id="cb9-266"><a href="#cb9-266" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb9-267"><a href="#cb9-267" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(</span>
<span id="cb9-268"><a href="#cb9-268" tabindex="-1"></a>    <span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-269"><a href="#cb9-269" tabindex="-1"></a>    today,</span>
<span id="cb9-270"><a href="#cb9-270" tabindex="-1"></a>    <span class="st">&quot;_RMSLE_histogram_CmaxAUC.png&quot;</span></span>
<span id="cb9-271"><a href="#cb9-271" tabindex="-1"></a>    ),</span>
<span id="cb9-272"><a href="#cb9-272" tabindex="-1"></a>  <span class="at">height =</span> <span class="fl">4.5</span>,</span>
<span id="cb9-273"><a href="#cb9-273" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb9-274"><a href="#cb9-274" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">&quot;in&quot;</span></span>
<span id="cb9-275"><a href="#cb9-275" tabindex="-1"></a>  )</span>
<span id="cb9-276"><a href="#cb9-276" tabindex="-1"></a></span>
<span id="cb9-277"><a href="#cb9-277" tabindex="-1"></a></span>
<span id="cb9-278"><a href="#cb9-278" tabindex="-1"></a>all_preds_prep <span class="ot">&lt;-</span> all_preds <span class="sc">%&gt;%</span></span>
<span id="cb9-279"><a href="#cb9-279" tabindex="-1"></a>  <span class="fu">filter</span>(Conc_est <span class="sc">&gt;=</span> LOQ,</span>
<span id="cb9-280"><a href="#cb9-280" tabindex="-1"></a>         Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;110p&quot;</span>, <span class="st">&quot;110h&quot;</span>, <span class="st">&quot;010h&quot;</span>),</span>
<span id="cb9-281"><a href="#cb9-281" tabindex="-1"></a>         method <span class="sc">==</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-282"><a href="#cb9-282" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.factor</span>(<span class="fu">paste</span>(Chemical, Species,</span>
<span id="cb9-283"><a href="#cb9-283" tabindex="-1"></a>                              method)),</span>
<span id="cb9-284"><a href="#cb9-284" tabindex="-1"></a>         <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-285"><a href="#cb9-285" tabindex="-1"></a>  <span class="fu">select</span>(ID, Options, dose_norm, log10_trans, time_scale,</span>
<span id="cb9-286"><a href="#cb9-286" tabindex="-1"></a>         Route, Media, Dose, Conc, Conc_est, Time, Reference)</span>
<span id="cb9-287"><a href="#cb9-287" tabindex="-1"></a></span>
<span id="cb9-288"><a href="#cb9-288" tabindex="-1"></a>split_preds <span class="ot">&lt;-</span> <span class="fu">split</span>(all_preds_prep, all_preds_prep<span class="sc">$</span>ID)</span>
<span id="cb9-289"><a href="#cb9-289" tabindex="-1"></a></span>
<span id="cb9-290"><a href="#cb9-290" tabindex="-1"></a>sp_plots <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(split_preds), <span class="cf">function</span>(i) {</span>
<span id="cb9-291"><a href="#cb9-291" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> split_preds[[i]],</span>
<span id="cb9-292"><a href="#cb9-292" tabindex="-1"></a>         <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Conc, <span class="at">y =</span> Conc_est,</span>
<span id="cb9-293"><a href="#cb9-293" tabindex="-1"></a>                       <span class="at">color =</span> Options, <span class="at">shape =</span> Reference)) <span class="sc">+</span></span>
<span id="cb9-294"><a href="#cb9-294" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-295"><a href="#cb9-295" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-296"><a href="#cb9-296" tabindex="-1"></a>    <span class="fu">facet_grid</span>(dose_norm<span class="sc">~</span>Route<span class="sc">+</span>Media<span class="sc">+</span>Dose, </span>
<span id="cb9-297"><a href="#cb9-297" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb9-298"><a href="#cb9-298" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">dose_norm =</span> label_both)) <span class="sc">+</span></span>
<span id="cb9-299"><a href="#cb9-299" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span> <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb9-300"><a href="#cb9-300" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Accent&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-301"><a href="#cb9-301" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-302"><a href="#cb9-302" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> i) <span class="sc">+</span></span>
<span id="cb9-303"><a href="#cb9-303" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb9-304"><a href="#cb9-304" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb9-305"><a href="#cb9-305" tabindex="-1"></a>}</span>
<span id="cb9-306"><a href="#cb9-306" tabindex="-1"></a>)</span>
<span id="cb9-307"><a href="#cb9-307" tabindex="-1"></a></span>
<span id="cb9-308"><a href="#cb9-308" tabindex="-1"></a><span class="co"># Very BIG FILE</span></span>
<span id="cb9-309"><a href="#cb9-309" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(</span>
<span id="cb9-310"><a href="#cb9-310" tabindex="-1"></a>  <span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb9-311"><a href="#cb9-311" tabindex="-1"></a>  today,</span>
<span id="cb9-312"><a href="#cb9-312" tabindex="-1"></a>  <span class="st">&quot;log10_GOFplots_select.pdf&quot;</span>),</span>
<span id="cb9-313"><a href="#cb9-313" tabindex="-1"></a>  <span class="at">onefile =</span> <span class="cn">TRUE</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb9-314"><a href="#cb9-314" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="fu">seq_along</span>(sp_plots)) {</span>
<span id="cb9-315"><a href="#cb9-315" tabindex="-1"></a>  <span class="fu">print</span>(sp_plots[[x]])</span>
<span id="cb9-316"><a href="#cb9-316" tabindex="-1"></a>}</span>
<span id="cb9-317"><a href="#cb9-317" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="head-to-head-comparison-of-pooled-vs-joint-models" class="section level2">
<h2>Head-to-head comparison of pooled vs joint models</h2>
<p>Now I need to go back and re-analyze the data only for 100, 101, and
000 Pooled and Joint, L-BFGS-B only. I need to filter the cvt to only
include Chem + Species combinations with multiple references. Then I
will join them with the excel sheet of already collected data.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Reference Multiples</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>multiRef_ChemSpec <span class="ot">&lt;-</span> all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species, Reference) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>n)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>multiRef_ChemSpec <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="co"># Surprisingly only 15 Chem + Species have multiple references</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>multiRef_ChemSpec</span></code></pre></div>
<div id="evaluating-error-for-the-nca-estimations" class="section level3">
<h3>Evaluating error for the NCA estimations</h3>
<p>Some chemicals have one observation for a timepoint but not for
others, which then each timepoint gets a random error value so that
<code>PK::nca()</code> can run. Here I evaluate 100 random seeds and the
differences in values of NCA estimated parameters.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co"># Which Chemical Species Route Media Dose groups have the randomness?</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>my_pk<span class="sc">$</span>data <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, Reference, Route, Media, Dose, Time) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, Reference, Route, Media, Dose) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(Count <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;&amp;</span> <span class="fu">any</span>(Count <span class="sc">&gt;</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species, Reference, Route, Media, Dose) <span class="ot">-&gt;</span> problem_set</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co"># Evaluate 100 times</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>n_evals <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>evalNCA_df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>my_pk_new <span class="ot">&lt;-</span> my_pk <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">suppress.message =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>  seed_num <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">+</span> i</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed_num)</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">&quot;Current seed:&quot;</span>, seed_num))</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>  my_pk_new <span class="ot">&lt;-</span> <span class="fu">do_preprocess</span>(my_pk_new)</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>  my_pk_new <span class="ot">&lt;-</span> <span class="fu">do_data_info</span>(my_pk_new)</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>  </span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>  this_nca <span class="ot">&lt;-</span> my_pk_new<span class="sc">$</span>data_info<span class="sc">$</span>nca <span class="sc">%&gt;%</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>param_sd_z) <span class="sc">%&gt;%</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">seed =</span> <span class="fu">as.factor</span>(seed_num))</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>  evalNCA_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(evalNCA_df, this_nca)</span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>}</span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="fu">names</span>(evalNCA_df)</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>evalNCA_df <span class="sc">%&gt;%</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, Route, Media, Dose, param_name) <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Average =</span> <span class="fu">mean</span>(param_value[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.infinite</span>(param_value))], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>            <span class="at">Median =</span> <span class="fu">median</span>(param_value[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.infinite</span>(param_value))], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>            <span class="at">StDev =</span> <span class="fu">sd</span>(param_value[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.infinite</span>(param_value))], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>            <span class="at">Min =</span> <span class="fu">min</span>(param_value[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.infinite</span>(param_value))], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a>            <span class="at">Max =</span> <span class="fu">max</span>(param_value[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.infinite</span>(param_value))], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a>            <span class="at">Unique_Values =</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">signif</span>(param_value, <span class="dv">4</span>))),</span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a>            <span class="at">Inf_Count =</span> <span class="fu">sum</span>(<span class="fu">is.infinite</span>(param_value))) <span class="sc">%&gt;%</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a>    <span class="co"># Route %in% &quot;iv&quot;,</span></span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a>    param_name <span class="sc">%in%</span> <span class="st">&quot;Cmax&quot;</span></span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>  <span class="fu">View</span>()</span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a>  </span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a>  </span>
<span id="cb11-47"><a href="#cb11-47" tabindex="-1"></a>evalNCA_df <span class="sc">%&gt;%</span></span>
<span id="cb11-48"><a href="#cb11-48" tabindex="-1"></a>  <span class="fu">filter</span>(param_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;tmax&quot;</span>),</span>
<span id="cb11-49"><a href="#cb11-49" tabindex="-1"></a>         Route <span class="sc">%in%</span> <span class="st">&quot;iv&quot;</span>,</span>
<span id="cb11-50"><a href="#cb11-50" tabindex="-1"></a>         <span class="fu">is.finite</span>(param_value),</span>
<span id="cb11-51"><a href="#cb11-51" tabindex="-1"></a>         Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;rat&quot;</span>, <span class="st">&quot;human&quot;</span>, <span class="st">&quot;hamster&quot;</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb11-52"><a href="#cb11-52" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> param_value, <span class="at">y =</span> Chemical)) <span class="sc">+</span></span>
<span id="cb11-53"><a href="#cb11-53" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-54"><a href="#cb11-54" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Route)) <span class="sc">+</span></span>
<span id="cb11-55"><a href="#cb11-55" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb11-56"><a href="#cb11-56" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb11-57"><a href="#cb11-57" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-58"><a href="#cb11-58" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey70&quot;</span>,</span>
<span id="cb11-59"><a href="#cb11-59" tabindex="-1"></a>                                          <span class="at">linewidth =</span> <span class="fl">0.4</span>,</span>
<span id="cb11-60"><a href="#cb11-60" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>),</span>
<span id="cb11-61"><a href="#cb11-61" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-62"><a href="#cb11-62" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb11-63"><a href="#cb11-63" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" tabindex="-1"></a></span>
<span id="cb11-65"><a href="#cb11-65" tabindex="-1"></a></span>
<span id="cb11-66"><a href="#cb11-66" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span></code></pre></div>
</div>
</div>
<div id="running-log-transformed-pooled-fits" class="section level2">
<h2>Running log-transformed, pooled fits</h2>
<p>log10 transformation and a hierarchical model were the options that
produced the least amount of error in predictions and derived TK stats.
<em>L-BFGS-B</em> ran significantly faster, but <em>bobyqa</em> produced
predictions with more lower RMSLE.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">do_preprocess</span>(my_pk)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>cvt_DTXSIDs <span class="ot">&lt;-</span> <span class="fu">unique</span>(my_pk<span class="sc">$</span>data<span class="sc">$</span>Chemical)</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="fu">length</span>(cvt_DTXSIDs)</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">do_prefit</span>(my_pk)</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="fu">system.time</span>(my_pk <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk, </span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>                            <span class="at">n_cores =</span> <span class="dv">14</span>))</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co"># saveRDS(my_pk, &quot;data-raw/all_cvt_pk.rds&quot;)</span></span></code></pre></div>
</div>
<div id="analysis-plots" class="section level2">
<h2>Analysis Plots</h2>
<p>Next I will generate the figures for the paper. I will begin by
collating the data that I need. This data are generally accessible using
functions/methods for evaluating fitted <code>pk</code> objects.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Need the following data for any of the subsequent plots</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># after fitting pk object for all cvt objects or reading the fitted pk object in `setup`</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>winmodel <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(my_pk)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>my_preds <span class="ot">&lt;-</span> <span class="fu">semi_join</span>(<span class="fu">predict</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>), winmodel)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>my_residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>my_tkstats <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(my_pk) <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(winmodel) </span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>my_nca <span class="ot">&lt;-</span> <span class="fu">get_nca</span>(my_pk)</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>all_my_data <span class="ot">&lt;-</span> <span class="fu">get_data</span>(my_pk)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>formatted_coefs <span class="ot">&lt;-</span> my_pk<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(param_name, <span class="st">&quot;sigma_&quot;</span>, <span class="at">negate =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  <span class="fu">select</span>(Chemical, Species, model, model, param_name, estimate,</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>         param_name, estimate, convcode) <span class="sc">%&gt;%</span> </span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param_name =</span> <span class="fu">paste</span>(param_name, <span class="st">&quot;tkstats&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> param_name,</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>                                     <span class="at">values_from =</span> estimate)</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>my_tf <span class="ot">&lt;-</span> <span class="fu">twofold_test</span>(my_pk)</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="fu">NROW</span>(all_my_data) <span class="sc">&gt;</span> <span class="fu">NROW</span>(my_preds) <span class="co"># THis must be true... or else try distinct(my_preds)</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="co"># Writing file to xlsx</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="at">predictions =</span> my_preds,</span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>                             <span class="at">tkstats =</span> my_tkstats),</span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>                    <span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>                                  <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>                                  today,</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>                                  <span class="st">&quot;_Supp_Table2&quot;</span>,</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>                                  <span class="st">&quot;.xlsx&quot;</span>))</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>fe_df <span class="ot">&lt;-</span> <span class="fu">fold_error</span>(my_pk) <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="co"># May need to change the use_scale_conc defaults</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a>r2_df <span class="ot">&lt;-</span> <span class="fu">rsq</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a>myAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a>myRMSLE <span class="ot">&lt;-</span> <span class="fu">rmse</span>(my_pk,</span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a>               <span class="at">use_scale_conc =</span> <span class="fu">list</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a>myRMSE <span class="ot">&lt;-</span> <span class="fu">rmse</span>(my_pk,</span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a>               <span class="at">rmse_group =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(Chemical, Species, Route, Media, Dose)) <span class="sc">%&gt;%</span></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a>chem_name_translate <span class="ot">&lt;-</span> all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Chemical_Name) <span class="sc">%&gt;%</span></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(Chemical_Name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;2,4-d&quot;</span>,</span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a>                                     <span class="st">&quot;methylene chloride&quot;</span>,</span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a>                                     <span class="st">&quot;benzo[a]pyrene&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span></code></pre></div>
<div id="figure-3a-replicated-timepoint-variation-in-cvtdb" class="section level3">
<h3>Figure 3A: Replicated timepoint variation in CvTdb</h3>
<p>The purpose of Figure 3 is to illustrate the variability among
replicate time points per Chemical/Species/Reference/Route/Media/Dose
group. This characterization is important as it can serve as a
pre-fitting data check and if the data are too variable it is likely
<code>invivoPKfit</code> will struggle to find an appropriate fit. One
thing to consider is that there may be various factors that contribute
to data variability including but not limited to:<br />
- Experimental design<br />
- Technical precision<br />
- Biological variation between subjects in different studies</p>
<p>Additionally, this also contributes to supplemental figure 2.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>my_tf<span class="sc">$</span>indiv_data_test <span class="sc">%&gt;%</span> <span class="fu">select</span>(Route, <span class="fu">starts_with</span>(<span class="st">&quot;percent_&quot;</span>))</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>pl3A <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>individual_data <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="co"># Plotting</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> foldConc)) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4000</span>)) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">3000</span>),</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Mean-normalized</span><span class="sc">\n</span><span class="st">concentration&quot;</span>,</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>                <span class="at">y =</span> <span class="st">&quot;Observations</span><span class="sc">\n</span><span class="st">(thousands)&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>pl3A</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>              today,</span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>              <span class="st">&quot;NormalizedConcentrations&quot;</span>,<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a>       <span class="at">plot =</span> pl3A,</span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">2.2</span>,</span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">2.5</span>,</span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a><span class="co"># Not included in manuscript</span></span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a>my_tf<span class="sc">$</span>data_descriptors <span class="sc">%&gt;%</span></span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a>  <span class="fu">select</span>(Chemical, Species, Reference, Route, Media, Time, data_descr) <span class="sc">%&gt;%</span></span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> data_descr, <span class="at">x =</span> <span class="st">&quot;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>,</span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Occurence by Chemical + Species group&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
</div>
<div id="figure-3a-2-alternate-version-of-figure-3a" class="section level3">
<h3>Figure 3A-2: Alternate version of Figure 3A</h3>
<p>This alternate version of Figure 3A aims to simplify the assessment
of replication of datasets in invivoPKfit. In contrast to the original
4A, this will also result in the inclusion of datasets with recorded
standard deviation values (i.e. non-indivudual animal data/summarized
data).</p>
<p>The way this will work is by calculating the average and standard
deviations of individual animal data (eliminating individual animal data
that does not have replicates) then testing the following:</p>
<p><span class="math display">\[
\frac{\mu + 2\sigma}{\mu} \leq 2
\]</span></p>
<p>Which essentially tests whether, at least 95% of data is within a
factor of 2. The result is a bar chart that shows how many timepoints
with replicate values passed this test. It minimizes the double (or
more) counting of timepoints with multiple replicates from individual
animal data.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># With the mapped column names</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>my_tf<span class="sc">$</span>summarized_data_test</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>pl3A_alt <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>summarized_data_test <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="fu">filter</span>(Route <span class="sc">==</span> <span class="st">&quot;All&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="fu">select</span>(Route, within, outside) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(within, outside),</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;status&quot;</span>,</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> status, <span class="at">fill =</span> status, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_stack</span>(),</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2000</span>)) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>),</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">2000</span>),</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>)) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;95% of observations</span><span class="sc">\n</span><span class="st">within factor of 2&quot;</span>,</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>                <span class="at">y =</span> <span class="st">&quot;Observations</span><span class="sc">\n</span><span class="st">(thousands)&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>pl3A_alt <span class="co"># Not included in final manuscript</span></span></code></pre></div>
</div>
<div id="figure-3b-variation-over-time-in-cvtdb-data." class="section level3">
<h3>Figure 3B: Variation over time in CvTdb data.</h3>
<p>Here the goal is to evaluate whether particular timepoints throughout
CvT data are particularly susceptible to high variability. To do this,
we create a relative time scale anchored by <span class="math inline">\(t_{max}\)</span> and <span class="math inline">\(t_{last}\)</span>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>pl3B <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>individual_data <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">inner_join</span>(my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Species,</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>                            Route, Media,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>                            <span class="at">tmax =</span> tmax.nca) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tmax))) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>           Species,</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>           Reference,</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>           Route,</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>           Media,</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>           Dose) <span class="sc">%&gt;%</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>         <span class="at">normTime =</span> <span class="fu">ifelse</span>(</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>           Route <span class="sc">==</span> <span class="st">&quot;iv&quot;</span>,</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>           <span class="dv">1</span> <span class="sc">+</span> Time<span class="sc">/</span><span class="fu">max</span>(Time),</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>           <span class="fu">ifelse</span>(</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>             Time <span class="sc">&gt;</span> tmax,</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>             ((Time <span class="sc">-</span> tmax)<span class="sc">/</span><span class="fu">max</span>(Time)) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>             <span class="fl">0.5</span> <span class="sc">+</span> Time<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>tmax)</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>           )</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>    <span class="at">x =</span> normTime,</span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>    <span class="at">y =</span> foldConc</span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green4&quot;</span>,</span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>,</span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Route),</span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;ADME-Normalized Time&quot;</span>,</span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Mean-Normalized</span><span class="sc">\n</span><span class="st">Concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-38"><a href="#cb16-38" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb16-39"><a href="#cb16-39" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb16-40"><a href="#cb16-40" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-41"><a href="#cb16-41" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-42"><a href="#cb16-42" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb16-43"><a href="#cb16-43" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb16-44"><a href="#cb16-44" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-45"><a href="#cb16-45" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-46"><a href="#cb16-46" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-47"><a href="#cb16-47" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb16-48"><a href="#cb16-48" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.125</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>),</span>
<span id="cb16-49"><a href="#cb16-49" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-50"><a href="#cb16-50" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb16-51"><a href="#cb16-51" tabindex="-1"></a></span>
<span id="cb16-52"><a href="#cb16-52" tabindex="-1"></a>pl3B</span>
<span id="cb16-53"><a href="#cb16-53" tabindex="-1"></a></span>
<span id="cb16-54"><a href="#cb16-54" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb16-55"><a href="#cb16-55" tabindex="-1"></a>              today,</span>
<span id="cb16-56"><a href="#cb16-56" tabindex="-1"></a>              <span class="st">&quot;ADME_NormTime-NormConcs_onlyDetects.png&quot;</span>),</span>
<span id="cb16-57"><a href="#cb16-57" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>,</span>
<span id="cb16-58"><a href="#cb16-58" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb16-59"><a href="#cb16-59" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb16-60"><a href="#cb16-60" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb16-61"><a href="#cb16-61" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb16-62"><a href="#cb16-62" tabindex="-1"></a></span>
<span id="cb16-63"><a href="#cb16-63" tabindex="-1"></a></span>
<span id="cb16-64"><a href="#cb16-64" tabindex="-1"></a><span class="co"># Make the Combination Plot----</span></span>
<span id="cb16-65"><a href="#cb16-65" tabindex="-1"></a></span>
<span id="cb16-66"><a href="#cb16-66" tabindex="-1"></a><span class="fu">plot_grid</span>(pl3A, pl3B, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb16-67"><a href="#cb16-67" tabindex="-1"></a>                     <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.7</span>))</span>
<span id="cb16-68"><a href="#cb16-68" tabindex="-1"></a></span>
<span id="cb16-69"><a href="#cb16-69" tabindex="-1"></a></span>
<span id="cb16-70"><a href="#cb16-70" tabindex="-1"></a>figure3 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(pl3A, pl3B, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb16-71"><a href="#cb16-71" tabindex="-1"></a>                     <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.7</span>))</span>
<span id="cb16-72"><a href="#cb16-72" tabindex="-1"></a></span>
<span id="cb16-73"><a href="#cb16-73" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb16-74"><a href="#cb16-74" tabindex="-1"></a>              today,</span>
<span id="cb16-75"><a href="#cb16-75" tabindex="-1"></a>              <span class="st">&quot;Figure3_onlyDetects.png&quot;</span>),</span>
<span id="cb16-76"><a href="#cb16-76" tabindex="-1"></a>       <span class="at">plot =</span> figure3,</span>
<span id="cb16-77"><a href="#cb16-77" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb16-78"><a href="#cb16-78" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>,</span>
<span id="cb16-79"><a href="#cb16-79" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb16-80"><a href="#cb16-80" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb16-81"><a href="#cb16-81" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="supp.-figure-2-concentration-and-final-time-points-have-wide-range" class="section level3">
<h3>Supp. Figure 2: Concentration and final time-points have wide
range</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>data_range <span class="ot">&lt;-</span> all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="fu">filter</span>(Detect, <span class="sc">!</span>exclude) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, Reference, Media, Route, Dose, Dose.Units) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">maxT =</span> <span class="fu">max</span>(Time)<span class="sc">/</span><span class="dv">24</span>,</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>         <span class="at">concRange =</span> <span class="fu">log10</span>(<span class="fu">max</span>(Conc)<span class="sc">/</span><span class="fu">min</span>(Conc))) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>   </span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  </span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>sf_2A <span class="ot">&lt;-</span> data_range <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> maxT)) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">40</span>,</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>number,</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">30</span>, <span class="dv">365</span>)) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>  <span class="co"># scale_y_continuous(expand = c(0, 0),</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>  <span class="co">#                    limits = c(0, 60),</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  <span class="co">#                    breaks = c(0, 10, 20, 30, 40, 50)) +</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Day of final Timepoint&quot;</span>,</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a>sf_2A</span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a>              today,</span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a>              <span class="st">&quot;SFig2A_TimePoints.png&quot;</span>),</span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a>       <span class="at">plot =</span> sf_2C,</span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a></span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a>sf_2B <span class="ot">&lt;-</span> data_range <span class="sc">%&gt;%</span></span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> concRange)) <span class="sc">+</span></span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">40</span>,</span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>),</span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log10(Concentration Range)&quot;</span>,</span>
<span id="cb17-50"><a href="#cb17-50" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-51"><a href="#cb17-51" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb17-52"><a href="#cb17-52" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb17-53"><a href="#cb17-53" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-54"><a href="#cb17-54" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb17-55"><a href="#cb17-55" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb17-56"><a href="#cb17-56" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb17-57"><a href="#cb17-57" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-58"><a href="#cb17-58" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-59"><a href="#cb17-59" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb17-60"><a href="#cb17-60" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span>
<span id="cb17-61"><a href="#cb17-61" tabindex="-1"></a></span>
<span id="cb17-62"><a href="#cb17-62" tabindex="-1"></a>sf_2B</span>
<span id="cb17-63"><a href="#cb17-63" tabindex="-1"></a></span>
<span id="cb17-64"><a href="#cb17-64" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb17-65"><a href="#cb17-65" tabindex="-1"></a>              today,</span>
<span id="cb17-66"><a href="#cb17-66" tabindex="-1"></a>              <span class="st">&quot;SFig2B_ConcRange.png&quot;</span>),</span>
<span id="cb17-67"><a href="#cb17-67" tabindex="-1"></a>       <span class="at">plot =</span> sf_2B,</span>
<span id="cb17-68"><a href="#cb17-68" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb17-69"><a href="#cb17-69" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb17-70"><a href="#cb17-70" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb17-71"><a href="#cb17-71" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb17-72"><a href="#cb17-72" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" tabindex="-1"></a>sf_2AB <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(sf_2A, sf_2B,</span>
<span id="cb17-74"><a href="#cb17-74" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), </span>
<span id="cb17-75"><a href="#cb17-75" tabindex="-1"></a>                    <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb17-76"><a href="#cb17-76" tabindex="-1"></a></span>
<span id="cb17-77"><a href="#cb17-77" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" tabindex="-1"></a>sf_2AB</span>
<span id="cb17-79"><a href="#cb17-79" tabindex="-1"></a></span>
<span id="cb17-80"><a href="#cb17-80" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb17-81"><a href="#cb17-81" tabindex="-1"></a>              today,</span>
<span id="cb17-82"><a href="#cb17-82" tabindex="-1"></a>              <span class="st">&quot;SFig2_ConcTimeRanges.png&quot;</span>),</span>
<span id="cb17-83"><a href="#cb17-83" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.2</span>,</span>
<span id="cb17-84"><a href="#cb17-84" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb17-85"><a href="#cb17-85" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb17-86"><a href="#cb17-86" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb17-87"><a href="#cb17-87" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="supp-figure-4-invivopkfit-model-performance" class="section level3">
<h3>Supp Figure 4: invivoPKfit model performance</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>my_tf<span class="sc">$</span>model_error_summary <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">select</span>(model, method, <span class="fu">starts_with</span>(<span class="st">&quot;percent_&quot;</span>))</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>my_tf<span class="sc">$</span>model_error_all <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;model_1comp&quot;</span>, <span class="st">&quot;model_2comp&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Fold_Error)) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">1E-3</span>, <span class="fl">1E3</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10)) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(model),</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>             <span class="at">rows =</span> <span class="fu">vars</span>(Route)) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Predicted/Observed&quot;</span>,</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Observations&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey95&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>))</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>              today,</span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>              <span class="st">&quot;PredictedObserved_compartmentModels.png&quot;</span>),</span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>, <span class="at">width =</span> <span class="dv">5</span>)</span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div id="figures-4-and-supplemental-figures-4-5-model-performance-vs-data-variability" class="section level3">
<h3>Figures 4 and Supplemental Figures 4 &amp; 5: Model performance vs
Data Variability</h3>
<p>Here we examine the performance of “best fit” models with relation to
data variability. Please note that in supplemental Figure 3, the data
with summarized observations (mean and sd) were included. Here, because
we are trying to specifically compare data variability with model
performance, we look at data with replicated timepoint observations,
which are largely data with individual animal data.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>my_tf<span class="sc">$</span>indiv_data_test_fold_errors <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="fu">select</span>(model, <span class="fu">starts_with</span>(<span class="st">&quot;percent_&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>pl_4A <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>indiv_data_fold_errors <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="co"># For Plotting</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>    <span class="at">y =</span> Fold_Error,</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>    <span class="at">x =</span> foldConc</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(model)) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10),</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>                <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.0001</span>, <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10),</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>                <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.0001</span>, <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;cividis&quot;</span>,</span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>),</span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>                       <span class="at">oob =</span> scales<span class="sc">::</span>oob_squish) <span class="sc">+</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Model Error&quot;</span>,</span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Data Variability&quot;</span>,</span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a>pl_4A</span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a>              today,</span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a>              <span class="st">&quot;ModelPerformance_vDataVariability.png&quot;</span>),</span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">2</span>,</span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">4.2</span>,</span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)  </span>
<span id="cb19-43"><a href="#cb19-43" tabindex="-1"></a>  </span>
<span id="cb19-44"><a href="#cb19-44" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>indiv_data_test_fold_errors <span class="sc">%&gt;%</span></span>
<span id="cb19-45"><a href="#cb19-45" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-46"><a href="#cb19-46" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;percent_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-47"><a href="#cb19-47" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-48"><a href="#cb19-48" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-49"><a href="#cb19-49" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;percentages&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-50"><a href="#cb19-50" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentages =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-51"><a href="#cb19-51" tabindex="-1"></a>    percentages <span class="sc">==</span> <span class="st">&quot;percent_both_within&quot;</span> <span class="sc">~</span> <span class="st">&quot;Both within a factor of 2&quot;</span>,</span>
<span id="cb19-52"><a href="#cb19-52" tabindex="-1"></a>    percentages <span class="sc">==</span> <span class="st">&quot;percent_both_outside&quot;</span> <span class="sc">~</span> <span class="st">&quot;Both outside a factor of 2&quot;</span>,</span>
<span id="cb19-53"><a href="#cb19-53" tabindex="-1"></a>    percentages <span class="sc">==</span> <span class="st">&quot;percent_model_outside&quot;</span> <span class="sc">~</span> <span class="st">&quot;Model too variable&quot;</span>,</span>
<span id="cb19-54"><a href="#cb19-54" tabindex="-1"></a>    percentages <span class="sc">==</span> <span class="st">&quot;percent_data_outside&quot;</span> <span class="sc">~</span> <span class="st">&quot;Data too variable&quot;</span></span>
<span id="cb19-55"><a href="#cb19-55" tabindex="-1"></a>  ))</span>
<span id="cb19-56"><a href="#cb19-56" tabindex="-1"></a>  </span>
<span id="cb19-57"><a href="#cb19-57" tabindex="-1"></a></span>
<span id="cb19-58"><a href="#cb19-58" tabindex="-1"></a></span>
<span id="cb19-59"><a href="#cb19-59" tabindex="-1"></a><span class="fu">names</span>(my_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot; &quot;</span>,<span class="st">&quot;1-compartment (%)&quot;</span>, <span class="st">&quot;2-compartment (%)&quot;</span>, <span class="st">&quot;Overall (%)&quot;</span>)</span>
<span id="cb19-60"><a href="#cb19-60" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb19-62"><a href="#cb19-62" tabindex="-1"></a><span class="fu">library</span>(officer)</span>
<span id="cb19-63"><a href="#cb19-63" tabindex="-1"></a></span>
<span id="cb19-64"><a href="#cb19-64" tabindex="-1"></a><span class="fu">flextable</span>(my_table)<span class="sc">%&gt;%</span></span>
<span id="cb19-65"><a href="#cb19-65" tabindex="-1"></a>  <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-66"><a href="#cb19-66" tabindex="-1"></a>  <span class="fu">fontsize</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-67"><a href="#cb19-67" tabindex="-1"></a>  <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">j =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">autofit</span>()</span>
<span id="cb19-68"><a href="#cb19-68" tabindex="-1"></a></span>
<span id="cb19-69"><a href="#cb19-69" tabindex="-1"></a>table_plot <span class="ot">&lt;-</span> <span class="fu">gen_grob</span>(<span class="fu">flextable</span>(my_table) <span class="sc">%&gt;%</span></span>
<span id="cb19-70"><a href="#cb19-70" tabindex="-1"></a>                         <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-71"><a href="#cb19-71" tabindex="-1"></a>                         <span class="fu">fontsize</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-72"><a href="#cb19-72" tabindex="-1"></a>                         <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">j =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-73"><a href="#cb19-73" tabindex="-1"></a>                         <span class="fu">autofit</span>())</span>
<span id="cb19-74"><a href="#cb19-74" tabindex="-1"></a></span>
<span id="cb19-75"><a href="#cb19-75" tabindex="-1"></a></span>
<span id="cb19-76"><a href="#cb19-76" tabindex="-1"></a>dual_plot <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(pl_4A, table_plot, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">&quot;v&quot;</span>,</span>
<span id="cb19-77"><a href="#cb19-77" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb19-78"><a href="#cb19-78" tabindex="-1"></a></span>
<span id="cb19-79"><a href="#cb19-79" tabindex="-1"></a>dual_plot</span>
<span id="cb19-80"><a href="#cb19-80" tabindex="-1"></a></span>
<span id="cb19-81"><a href="#cb19-81" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb19-82"><a href="#cb19-82" tabindex="-1"></a>              today,</span>
<span id="cb19-83"><a href="#cb19-83" tabindex="-1"></a>              <span class="st">&quot;ModelPerformance_vDataVariability_wTable.png&quot;</span>),</span>
<span id="cb19-84"><a href="#cb19-84" tabindex="-1"></a>       <span class="at">plot =</span> dual_plot,</span>
<span id="cb19-85"><a href="#cb19-85" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">4.5</span>,</span>
<span id="cb19-86"><a href="#cb19-86" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb19-87"><a href="#cb19-87" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb19-88"><a href="#cb19-88" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb19-89"><a href="#cb19-89" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb19-90"><a href="#cb19-90" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)  </span></code></pre></div>
</div>
<div id="figure-5alt" class="section level3">
<h3>Figure 5Alt</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># Ultimately this will be removed from manuscript</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>my_tf<span class="sc">$</span>summarized_data_model_error <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="fu">select</span>(model, <span class="fu">starts_with</span>(<span class="st">&quot;percent_&quot;</span>))</span></code></pre></div>
</div>
<div id="figure-5-multiple-goodness-of-fit-metrics-validate-model-performance" class="section level3">
<h3>Figure 5: Multiple goodness-of-fit metrics validate model
performance</h3>
<p>Here we analyze and validate model performance per data group using
R-squared, RMSE, and fraction of predictions that are within 2-fold for
each Chemical, Species, Route, Media, and Dose groupings.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>combined_gof_df <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>model_error_all <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, model, method) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">within_2fold =</span> <span class="fu">sum</span>(<span class="fu">between</span>(Fold_Error, <span class="fl">0.5</span>, <span class="dv">2</span>))<span class="sc">/</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  <span class="fu">left_join</span>(r2_df) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="fu">left_join</span>(myAIC) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="fu">left_join</span>(myRMSLE) <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  </span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>mypl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> combined_gof_df,</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>               <span class="fu">aes</span>(</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>                 <span class="at">x =</span> within_2fold,</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>                 <span class="at">y =</span> Rsq,</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>                 <span class="at">color =</span> model</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>               )) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red4&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;longdash&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fraction of predictions within 2-fold&quot;</span>,</span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;R-squared value&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>())</span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a>  </span>
<span id="cb21-32"><a href="#cb21-32" tabindex="-1"></a>panelA_plot <span class="ot">&lt;-</span> ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(mypl, <span class="at">groupFill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-33"><a href="#cb21-33" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,</span>
<span id="cb21-34"><a href="#cb21-34" tabindex="-1"></a>                    <span class="at">xparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>),</span>
<span id="cb21-35"><a href="#cb21-35" tabindex="-1"></a>                    <span class="at">yparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>))</span>
<span id="cb21-36"><a href="#cb21-36" tabindex="-1"></a>panelA_plot</span>
<span id="cb21-37"><a href="#cb21-37" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb21-38"><a href="#cb21-38" tabindex="-1"></a>                         today,</span>
<span id="cb21-39"><a href="#cb21-39" tabindex="-1"></a>                         <span class="st">&quot;R2_within2fold_comparison.png&quot;</span>),</span>
<span id="cb21-40"><a href="#cb21-40" tabindex="-1"></a>       <span class="at">plot =</span> ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(mypl, <span class="at">groupFill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-41"><a href="#cb21-41" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,</span>
<span id="cb21-42"><a href="#cb21-42" tabindex="-1"></a>                    <span class="at">xparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>),</span>
<span id="cb21-43"><a href="#cb21-43" tabindex="-1"></a>                    <span class="at">yparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>)),</span>
<span id="cb21-44"><a href="#cb21-44" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb21-45"><a href="#cb21-45" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb21-46"><a href="#cb21-46" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb21-47"><a href="#cb21-47" tabindex="-1"></a></span>
<span id="cb21-48"><a href="#cb21-48" tabindex="-1"></a>panelB_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> myRMSE,</span>
<span id="cb21-49"><a href="#cb21-49" tabindex="-1"></a>               <span class="fu">aes</span>(</span>
<span id="cb21-50"><a href="#cb21-50" tabindex="-1"></a>                 <span class="at">x =</span> <span class="fu">log10</span>(RMSE),</span>
<span id="cb21-51"><a href="#cb21-51" tabindex="-1"></a>                 <span class="at">color =</span> model,</span>
<span id="cb21-52"><a href="#cb21-52" tabindex="-1"></a>                 <span class="at">fill =</span> model</span>
<span id="cb21-53"><a href="#cb21-53" tabindex="-1"></a>               )) <span class="sc">+</span> </span>
<span id="cb21-54"><a href="#cb21-54" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb21-55"><a href="#cb21-55" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-56"><a href="#cb21-56" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;grey10&quot;</span>)) <span class="sc">+</span></span>
<span id="cb21-57"><a href="#cb21-57" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;grey10&quot;</span>)) <span class="sc">+</span></span>
<span id="cb21-58"><a href="#cb21-58" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(model),</span>
<span id="cb21-59"><a href="#cb21-59" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(Route)) <span class="sc">+</span></span>
<span id="cb21-60"><a href="#cb21-60" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb21-61"><a href="#cb21-61" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.6</span>,</span>
<span id="cb21-62"><a href="#cb21-62" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb21-63"><a href="#cb21-63" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-64"><a href="#cb21-64" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-65"><a href="#cb21-65" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-66"><a href="#cb21-66" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-67"><a href="#cb21-67" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-68"><a href="#cb21-68" tabindex="-1"></a>    <span class="at">panel.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.125</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>),</span>
<span id="cb21-69"><a href="#cb21-69" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb21-70"><a href="#cb21-70" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb21-71"><a href="#cb21-71" tabindex="-1"></a>panelB_plot</span>
<span id="cb21-72"><a href="#cb21-72" tabindex="-1"></a></span>
<span id="cb21-73"><a href="#cb21-73" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb21-74"><a href="#cb21-74" tabindex="-1"></a>                         today,</span>
<span id="cb21-75"><a href="#cb21-75" tabindex="-1"></a>                         <span class="st">&quot;RMSEs_winningmodel_RouteFacet.png&quot;</span>),</span>
<span id="cb21-76"><a href="#cb21-76" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb21-77"><a href="#cb21-77" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb21-78"><a href="#cb21-78" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb21-79"><a href="#cb21-79" tabindex="-1"></a></span>
<span id="cb21-80"><a href="#cb21-80" tabindex="-1"></a>legend <span class="ot">&lt;-</span> <span class="fu">get_legend</span>(panelB_plot)</span>
<span id="cb21-81"><a href="#cb21-81" tabindex="-1"></a></span>
<span id="cb21-82"><a href="#cb21-82" tabindex="-1"></a><span class="fu">plot_grid</span>(<span class="fu">plot_grid</span>(panelA_plot,</span>
<span id="cb21-83"><a href="#cb21-83" tabindex="-1"></a>                   panelB_plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb21-84"><a href="#cb21-84" tabindex="-1"></a>                   <span class="at">axis =</span> <span class="st">&quot;tb&quot;</span>, <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)), legend,</span>
<span id="cb21-85"><a href="#cb21-85" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb21-86"><a href="#cb21-86" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>))</span>
<span id="cb21-87"><a href="#cb21-87" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb21-88"><a href="#cb21-88" tabindex="-1"></a>                         today,</span>
<span id="cb21-89"><a href="#cb21-89" tabindex="-1"></a>                         <span class="st">&quot;CombinedPlot_Rsquared_RMSE.png&quot;</span>),</span>
<span id="cb21-90"><a href="#cb21-90" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb21-91"><a href="#cb21-91" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb21-92"><a href="#cb21-92" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb21-93"><a href="#cb21-93" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-6-examples-fits-for-chemicals-with-r-squared-and-within-2-fold" class="section level3">
<h3>Supp. Fig. 6 Examples fits for chemicals with R-squared and within
2-fold</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk, <span class="at">best_fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>           <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>           <span class="at">drop_nonDetect =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>cvt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(curation_set_tag <span class="sc">==</span> <span class="st">&quot;CVT_Showa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>  <span class="fu">pull</span>(analyte_dtxsid) <span class="ot">-&gt;</span> Showa_chems</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>combined_gof_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(Chemical <span class="sc">%in%</span> Showa_chems)) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>ex_fits <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>  <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID2020139&quot;</span>,</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>                         <span class="st">&quot;DTXSID4023917&quot;</span>,</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>                         <span class="st">&quot;DTXSID3061635&quot;</span>,</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>                         <span class="st">&quot;DTXSID1034187&quot;</span>),</span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>         Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>  <span class="fu">pull</span>(final_plot)</span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(ex_fits[[<span class="dv">2</span>]] <span class="sc">+</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a>                                     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#a6bddb&quot;</span>,</span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a>                                                                   <span class="st">&quot;#74a9cf&quot;</span>,</span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a>                                                                   <span class="st">&quot;#41bbc4&quot;</span>,</span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a>                                                                   <span class="st">&quot;#2b8cbe&quot;</span>,</span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a>                                                                   <span class="st">&quot;#045a8d&quot;</span>)) <span class="sc">+</span></span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a>                                     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a>                                     <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">30</span>),</span>
<span id="cb22-27"><a href="#cb22-27" tabindex="-1"></a>                                   ex_fits[[<span class="dv">3</span>]] <span class="sc">+</span></span>
<span id="cb22-28"><a href="#cb22-28" tabindex="-1"></a>                                     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,</span>
<span id="cb22-29"><a href="#cb22-29" tabindex="-1"></a>                                                                   <span class="st">&quot;grey40&quot;</span>)) <span class="sc">+</span></span>
<span id="cb22-30"><a href="#cb22-30" tabindex="-1"></a>                                     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>),</span>
<span id="cb22-31"><a href="#cb22-31" tabindex="-1"></a>                                   ex_fits[[<span class="dv">1</span>]] <span class="sc">+</span></span>
<span id="cb22-32"><a href="#cb22-32" tabindex="-1"></a>                                     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;magenta3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb22-33"><a href="#cb22-33" tabindex="-1"></a>                                     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>),</span>
<span id="cb22-34"><a href="#cb22-34" tabindex="-1"></a>                                   ex_fits[[<span class="dv">4</span>]] <span class="sc">+</span></span>
<span id="cb22-35"><a href="#cb22-35" tabindex="-1"></a>                                     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#006837&quot;</span>)) <span class="sc">+</span></span>
<span id="cb22-36"><a href="#cb22-36" tabindex="-1"></a>                                     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)),</span>
<span id="cb22-37"><a href="#cb22-37" tabindex="-1"></a>                   <span class="at">scale =</span> <span class="fl">0.85</span>)</span>
<span id="cb22-38"><a href="#cb22-38" tabindex="-1"></a></span>
<span id="cb22-39"><a href="#cb22-39" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb22-40"><a href="#cb22-40" tabindex="-1"></a>                         today,</span>
<span id="cb22-41"><a href="#cb22-41" tabindex="-1"></a>                         <span class="st">&quot;exampleFits_Rsq_within2fold.png&quot;</span>),</span>
<span id="cb22-42"><a href="#cb22-42" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">12</span>,</span>
<span id="cb22-43"><a href="#cb22-43" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-7-distribution-of-sigmas-in-cvtdb-data" class="section level3">
<h3>Supp. Fig. 7: Distribution of Sigmas in CvTdb data</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>my_pk<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="fu">select</span>(Chemical, Species, model, method, param_name, estimate) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(param_name, <span class="st">&quot;sigma_&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  <span class="fu">left_join</span>(my_pk<span class="sc">$</span>prefit<span class="sc">$</span>stat_error_model<span class="sc">$</span>sigma_DF) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  <span class="fu">inner_join</span>(<span class="fu">get_data_summary</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>               <span class="fu">distinct</span>(Chemical, Species, n_obs)) <span class="ot">-&gt;</span> my_coefs</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>my_coefs <span class="sc">%&gt;%</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> </span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>           <span class="fu">case_when</span>(</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>             model <span class="sc">==</span> <span class="st">&quot;model_1comp&quot;</span> <span class="sc">~</span> <span class="st">&quot;1-compartment&quot;</span>,</span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>             model <span class="sc">==</span> <span class="st">&quot;model_2comp&quot;</span> <span class="sc">~</span> <span class="st">&quot;2-compartment&quot;</span>,</span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>             model <span class="sc">==</span> <span class="st">&quot;model_flat&quot;</span>  <span class="sc">~</span> <span class="st">&quot;Null&quot;</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a>           )) <span class="sc">%&gt;%</span></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate<span class="sc">/</span>n_obs),</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">15</span>,</span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>                 <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a>  <span class="co"># geom_histogram(aes(x = start/n_obs), fill = NA, color = &quot;grey20&quot;, bins = 15) +</span></span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10)) <span class="sc">+</span></span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(model)) <span class="sc">+</span></span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Size-normalized Sigma Value&quot;</span>,</span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Observations&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-34"><a href="#cb23-34" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb23-35"><a href="#cb23-35" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb23-37"><a href="#cb23-37" tabindex="-1"></a>              today,</span>
<span id="cb23-38"><a href="#cb23-38" tabindex="-1"></a>              <span class="st">&quot;NormalizedSigma_Distributions.png&quot;</span>),</span>
<span id="cb23-39"><a href="#cb23-39" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb23-40"><a href="#cb23-40" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="figure-6-comparing-derived-tk-stats-with-human-tk-stats-from-lombardo-et-al." class="section level3">
<h3>Figure 6: Comparing derived TK stats with human TK stats from
Lombardo et al.</h3>
<p>This meta-analysis compares the TK stats from model fits with other
published studies.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>cvt_DTXSIDs <span class="ot">&lt;-</span> <span class="fu">unique</span>(my_pk<span class="sc">$</span>data<span class="sc">$</span>Chemical)</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="co"># First things first, let&#39;s load the data from Lombardo et al.</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>lombardo <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>         <span class="st">&quot;Lombardo2018-Supplemental_82966_revised_corrected.xlsx&quot;</span>),</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">8</span>)</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>l_batch_search <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>         <span class="st">&quot;LombardoBatchSearch_Name.xlsx&quot;</span>),</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">&quot;Main Data&quot;</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>)</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>  </span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>l_batch_search <span class="ot">&lt;-</span> l_batch_search[<span class="fu">c</span>(<span class="st">&quot;INPUT&quot;</span>, <span class="st">&quot;CASRN&quot;</span>,<span class="st">&quot;DTXSID&quot;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>  <span class="fu">right_join</span>(lombardo[<span class="fu">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;CAS #&quot;</span>)], <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;CASRN&quot;</span> <span class="ot">=</span> <span class="st">&quot;CAS #&quot;</span>, <span class="st">&quot;INPUT&quot;</span> <span class="ot">=</span> <span class="st">&quot;Name&quot;</span>))</span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>l_noNamesCASRN <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(</span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a>         <span class="st">&quot;LombardoBatchSearch_CASRNnoName.xlsx&quot;</span>),</span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">&quot;Main Data&quot;</span></span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">CASRN =</span> INPUT, DTXSID)</span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>l_curatedDTX <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb24-30"><a href="#cb24-30" tabindex="-1"></a>                         <span class="st">&quot;CuratedIDs_lombardo.txt&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-31"><a href="#cb24-31" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">INPUT =</span> Name)</span>
<span id="cb24-32"><a href="#cb24-32" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" tabindex="-1"></a>l_batch_search <span class="ot">&lt;-</span> l_batch_search <span class="sc">%&gt;%</span></span>
<span id="cb24-35"><a href="#cb24-35" tabindex="-1"></a>  <span class="fu">left_join</span>(l_noNamesCASRN, <span class="at">by =</span> <span class="st">&quot;CASRN&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-36"><a href="#cb24-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DTXSID =</span> <span class="fu">coalesce</span>(DTXSID.x, DTXSID.y)) <span class="sc">%&gt;%</span></span>
<span id="cb24-37"><a href="#cb24-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>DTXSID.x, <span class="sc">-</span>DTXSID.y)</span>
<span id="cb24-38"><a href="#cb24-38" tabindex="-1"></a><span class="co"># Now all but two of the IDs are unidentified</span></span>
<span id="cb24-39"><a href="#cb24-39" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" tabindex="-1"></a>lombardo <span class="ot">&lt;-</span> lombardo <span class="sc">%&gt;%</span></span>
<span id="cb24-41"><a href="#cb24-41" tabindex="-1"></a>  <span class="fu">right_join</span>(l_batch_search, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span> <span class="ot">=</span> <span class="st">&quot;INPUT&quot;</span>))</span>
<span id="cb24-42"><a href="#cb24-42" tabindex="-1"></a></span>
<span id="cb24-43"><a href="#cb24-43" tabindex="-1"></a></span>
<span id="cb24-44"><a href="#cb24-44" tabindex="-1"></a><span class="do">####</span></span>
<span id="cb24-45"><a href="#cb24-45" tabindex="-1"></a>lombard_abbr <span class="ot">&lt;-</span> lombardo <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(DTXSID,</span>
<span id="cb24-46"><a href="#cb24-46" tabindex="-1"></a>                                           <span class="at">hVss =</span> <span class="st">`</span><span class="at">human VDss (L/kg)</span><span class="st">`</span>,</span>
<span id="cb24-47"><a href="#cb24-47" tabindex="-1"></a>                                           <span class="at">hCltot =</span> <span class="st">`</span><span class="at">human CL (mL/min/kg)</span><span class="st">`</span>,</span>
<span id="cb24-48"><a href="#cb24-48" tabindex="-1"></a>                                           <span class="at">halflife =</span> <span class="st">`</span><span class="at">terminal  t1/2 (h)</span><span class="st">`</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb24-49"><a href="#cb24-49" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> cvt_DTXSIDs) <span class="sc">%&gt;%</span></span>
<span id="cb24-50"><a href="#cb24-50" tabindex="-1"></a>  <span class="fu">left_join</span>(chem_name_translate, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID&quot;</span> <span class="ot">=</span> <span class="st">&quot;Chemical&quot;</span>))</span>
<span id="cb24-51"><a href="#cb24-51" tabindex="-1"></a></span>
<span id="cb24-52"><a href="#cb24-52" tabindex="-1"></a><span class="co"># 15 chemicals in common with values for both</span></span>
<span id="cb24-53"><a href="#cb24-53" tabindex="-1"></a>lombardo_comparison <span class="ot">&lt;-</span> my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb24-54"><a href="#cb24-54" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">DTXSID =</span> Chemical, Species,</span>
<span id="cb24-55"><a href="#cb24-55" tabindex="-1"></a>                model, Vss.tkstats, CLtot.tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb24-56"><a href="#cb24-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(model <span class="sc">!=</span> <span class="st">&quot;model_flat&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-57"><a href="#cb24-57" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-58"><a href="#cb24-58" tabindex="-1"></a>  <span class="fu">inner_join</span>(lombard_abbr, <span class="at">by =</span> <span class="st">&quot;DTXSID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-59"><a href="#cb24-59" tabindex="-1"></a>  <span class="co"># filter(!is.na(Vss.tkstats)) %&gt;%</span></span>
<span id="cb24-60"><a href="#cb24-60" tabindex="-1"></a>  <span class="fu">arrange</span>(halflife)</span>
<span id="cb24-61"><a href="#cb24-61" tabindex="-1"></a></span>
<span id="cb24-62"><a href="#cb24-62" tabindex="-1"></a>comparable_ids <span class="ot">&lt;-</span> lombardo_comparison <span class="sc">%&gt;%</span> <span class="fu">pull</span>(DTXSID)</span>
<span id="cb24-63"><a href="#cb24-63" tabindex="-1"></a></span>
<span id="cb24-64"><a href="#cb24-64" tabindex="-1"></a>lombard_abbr <span class="ot">&lt;-</span> lombard_abbr <span class="sc">%&gt;%</span></span>
<span id="cb24-65"><a href="#cb24-65" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="st">&quot;human&quot;</span>, <span class="at">model =</span> <span class="st">&quot;Lombardo et al.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-66"><a href="#cb24-66" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Vss =</span> hVss, <span class="at">CLtot =</span> hCltot) <span class="sc">%&gt;%</span></span>
<span id="cb24-67"><a href="#cb24-67" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CLtot =</span> CLtot<span class="sc">*</span><span class="dv">60</span><span class="sc">/</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> <span class="co"># Lombardo reports this as mL/min/kg, need L/h/kg</span></span>
<span id="cb24-68"><a href="#cb24-68" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> comparable_ids) <span class="sc">%&gt;%</span></span>
<span id="cb24-69"><a href="#cb24-69" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chemical_Name =</span> <span class="fu">reorder</span>(Chemical_Name, halflife))</span>
<span id="cb24-70"><a href="#cb24-70" tabindex="-1"></a></span>
<span id="cb24-71"><a href="#cb24-71" tabindex="-1"></a>lombardo_comparison <span class="ot">&lt;-</span> my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb24-72"><a href="#cb24-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">DTXSID =</span> Chemical, Species,</span>
<span id="cb24-73"><a href="#cb24-73" tabindex="-1"></a>                model, Vss.tkstats, CLtot.tkstats, halflife.tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb24-74"><a href="#cb24-74" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> comparable_ids) <span class="sc">%&gt;%</span></span>
<span id="cb24-75"><a href="#cb24-75" tabindex="-1"></a>  <span class="fu">left_join</span>(chem_name_translate, <span class="at">by =</span> <span class="fu">join_by</span>(DTXSID <span class="sc">==</span> Chemical)) <span class="sc">%&gt;%</span></span>
<span id="cb24-76"><a href="#cb24-76" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-77"><a href="#cb24-77" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Vss =</span> Vss.tkstats, <span class="at">CLtot =</span> CLtot.tkstats, <span class="at">halflife =</span> halflife.tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb24-78"><a href="#cb24-78" tabindex="-1"></a>  <span class="fu">bind_rows</span>(lombard_abbr) <span class="sc">%&gt;%</span></span>
<span id="cb24-79"><a href="#cb24-79" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(model, <span class="st">&quot;^model&quot;</span>), <span class="st">&quot;invivoPKfit&quot;</span>, model),</span>
<span id="cb24-80"><a href="#cb24-80" tabindex="-1"></a>         <span class="at">Chemical_Name =</span> <span class="fu">factor</span>(Chemical_Name,</span>
<span id="cb24-81"><a href="#cb24-81" tabindex="-1"></a>                                <span class="at">levels =</span> <span class="fu">levels</span>(lombard_abbr<span class="sc">$</span>Chemical_Name)))</span>
<span id="cb24-82"><a href="#cb24-82" tabindex="-1"></a></span>
<span id="cb24-83"><a href="#cb24-83" tabindex="-1"></a>lombardo_comparison <span class="sc">%&gt;%</span></span>
<span id="cb24-84"><a href="#cb24-84" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;Vss&quot;</span>, <span class="st">&quot;CLtot&quot;</span>, <span class="st">&quot;halflife&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-85"><a href="#cb24-85" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;halflife&quot;</span>, <span class="st">&quot;Vss&quot;</span>, <span class="st">&quot;CLtot&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb24-86"><a href="#cb24-86" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb24-87"><a href="#cb24-87" tabindex="-1"></a>    <span class="at">x =</span> value,</span>
<span id="cb24-88"><a href="#cb24-88" tabindex="-1"></a>    <span class="at">y =</span> Chemical_Name</span>
<span id="cb24-89"><a href="#cb24-89" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb24-90"><a href="#cb24-90" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> model,</span>
<span id="cb24-91"><a href="#cb24-91" tabindex="-1"></a>                 <span class="at">shape =</span> Species),</span>
<span id="cb24-92"><a href="#cb24-92" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.7</span>),</span>
<span id="cb24-93"><a href="#cb24-93" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">5</span><span class="sc">/</span>.pt, <span class="at">stroke =</span> <span class="fl">2.5</span><span class="sc">/</span>.pt) <span class="sc">+</span></span>
<span id="cb24-94"><a href="#cb24-94" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(name),</span>
<span id="cb24-95"><a href="#cb24-95" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-96"><a href="#cb24-96" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10)) <span class="sc">+</span></span>
<span id="cb24-97"><a href="#cb24-97" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>),</span>
<span id="cb24-98"><a href="#cb24-98" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;human&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;rat&quot;</span>)) <span class="sc">+</span></span>
<span id="cb24-99"><a href="#cb24-99" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;#1064c9&quot;</span>)) <span class="sc">+</span></span>
<span id="cb24-100"><a href="#cb24-100" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">21</span>),</span>
<span id="cb24-101"><a href="#cb24-101" tabindex="-1"></a>                              <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb24-102"><a href="#cb24-102" tabindex="-1"></a>                              <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb24-103"><a href="#cb24-103" tabindex="-1"></a>                              <span class="at">title.hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb24-104"><a href="#cb24-104" tabindex="-1"></a>         <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb24-105"><a href="#cb24-105" tabindex="-1"></a>                              <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb24-106"><a href="#cb24-106" tabindex="-1"></a>                              <span class="at">title.hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb24-107"><a href="#cb24-107" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb24-108"><a href="#cb24-108" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-109"><a href="#cb24-109" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb24-110"><a href="#cb24-110" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb24-111"><a href="#cb24-111" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb24-112"><a href="#cb24-112" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb24-113"><a href="#cb24-113" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-114"><a href="#cb24-114" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-115"><a href="#cb24-115" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb24-116"><a href="#cb24-116" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-117"><a href="#cb24-117" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-118"><a href="#cb24-118" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb24-119"><a href="#cb24-119" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-120"><a href="#cb24-120" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb24-121"><a href="#cb24-121" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>())</span>
<span id="cb24-122"><a href="#cb24-122" tabindex="-1"></a></span>
<span id="cb24-123"><a href="#cb24-123" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb24-124"><a href="#cb24-124" tabindex="-1"></a>                         today,</span>
<span id="cb24-125"><a href="#cb24-125" tabindex="-1"></a>                         <span class="st">&quot;lombardoComparison_named.png&quot;</span>),</span>
<span id="cb24-126"><a href="#cb24-126" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">7</span>,</span>
<span id="cb24-127"><a href="#cb24-127" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb24-128"><a href="#cb24-128" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-7-histogram-of-lombardo-vss-and-invivopkfit-another-meta-analysis" class="section level3">
<h3>Supp. Fig. 7 Histogram of Lombardo Vss and InvivoPKfit &amp; another
meta-analysis</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co"># Histograms</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>lombardo_hist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Chemical =</span> <span class="fu">c</span>(lombardo<span class="sc">$</span>DTXSID,</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>                              my_tkstats<span class="sc">$</span>Chemical),</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>                            <span class="at">Vss =</span> <span class="fu">c</span>(lombardo<span class="sc">$</span><span class="st">`</span><span class="at">human VDss (L/kg)</span><span class="st">`</span>,</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>                              my_tkstats<span class="sc">$</span>Vss.tkstats),</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>                            <span class="at">halflife =</span> <span class="fu">c</span>(lombardo<span class="sc">$</span><span class="st">`</span><span class="at">terminal  t1/2 (h)</span><span class="st">`</span>,</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>                              my_tkstats<span class="sc">$</span>halflife.tkstats),</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>                            <span class="at">Source =</span> <span class="fu">c</span>(<span class="fu">rep_len</span>(<span class="st">&quot;lombardo&quot;</span>,</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>                                    <span class="at">length.out =</span> <span class="fu">nrow</span>(lombardo)),</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>                              <span class="fu">rep_len</span>(<span class="st">&quot;invivoPKfit&quot;</span>,</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>                                      <span class="at">length.out =</span> <span class="fu">nrow</span>(my_tkstats))))</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>sfig7A <span class="ot">&lt;-</span> lombardo_hist <span class="sc">%&gt;%</span> </span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log2</span>(Vss), <span class="at">color =</span> Source,</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>             <span class="at">group =</span> Source)) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(ndensity)),</span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>                <span class="at">linewidth =</span> <span class="dv">2</span><span class="sc">/</span>.pt,</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>                <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Scaled Frequency&quot;</span>,</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Vss&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">expr =</span> <span class="dv">2</span><span class="sc">^</span>.x)) <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;#1064c9&quot;</span>)) <span class="sc">+</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>())</span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a>sfig7A</span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a>other_meta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb25-42"><a href="#cb25-42" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>), <span class="st">&quot;SupTableInVivoDatandPreds.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-43"><a href="#cb25-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(DTXSID, fbioh, fbior) <span class="sc">%&gt;%</span></span>
<span id="cb25-44"><a href="#cb25-44" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> my_tkstats<span class="sc">$</span>Chemical)</span>
<span id="cb25-45"><a href="#cb25-45" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" tabindex="-1"></a>fgutabs <span class="ot">&lt;-</span> my_pk<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(param_name <span class="sc">%in%</span> <span class="st">&quot;Fgutabs&quot;</span>, convcode <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-47"><a href="#cb25-47" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species, model, method, estimate) <span class="sc">%&gt;%</span></span>
<span id="cb25-48"><a href="#cb25-48" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel) <span class="sc">%&gt;%</span></span>
<span id="cb25-49"><a href="#cb25-49" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">!=</span> <span class="st">&quot;model_flat&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-50"><a href="#cb25-50" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Fgutabs.tkstats =</span> <span class="st">&quot;estimate&quot;</span>)</span>
<span id="cb25-51"><a href="#cb25-51" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" tabindex="-1"></a>sfig7B <span class="ot">&lt;-</span> other_meta <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(fgutabs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID&quot;</span> <span class="ot">=</span> <span class="st">&quot;Chemical&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-54"><a href="#cb25-54" tabindex="-1"></a>  <span class="fu">filter</span>(Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;rat&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-55"><a href="#cb25-55" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Fgutabs.tkstats),</span>
<span id="cb25-56"><a href="#cb25-56" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(fbior)) <span class="sc">%&gt;%</span></span>
<span id="cb25-57"><a href="#cb25-57" tabindex="-1"></a>  <span class="fu">distinct</span>(DTXSID, Species,</span>
<span id="cb25-58"><a href="#cb25-58" tabindex="-1"></a>           Fgutabs.tkstats, fbior) <span class="sc">%&gt;%</span></span>
<span id="cb25-59"><a href="#cb25-59" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Fgutabs.tkstats, fbior),</span>
<span id="cb25-60"><a href="#cb25-60" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Source&quot;</span>,</span>
<span id="cb25-61"><a href="#cb25-61" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Fgutabs&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-62"><a href="#cb25-62" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Source =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(Source, <span class="st">&quot;tkstats&quot;</span>), <span class="st">&quot;invivoPKfit&quot;</span>,</span>
<span id="cb25-63"><a href="#cb25-63" tabindex="-1"></a>                           <span class="st">&quot;Honda et al.&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-64"><a href="#cb25-64" tabindex="-1"></a>  <span class="fu">left_join</span>(chem_name_translate, <span class="at">by =</span> <span class="fu">join_by</span>(DTXSID <span class="sc">==</span> Chemical)) <span class="sc">%&gt;%</span></span>
<span id="cb25-65"><a href="#cb25-65" tabindex="-1"></a>  <span class="fu">mutate</span>(Chemical_Name) <span class="sc">%&gt;%</span></span>
<span id="cb25-66"><a href="#cb25-66" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb25-67"><a href="#cb25-67" tabindex="-1"></a>    <span class="at">x =</span> Fgutabs,</span>
<span id="cb25-68"><a href="#cb25-68" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">reorder</span>(Chemical_Name, Fgutabs)</span>
<span id="cb25-69"><a href="#cb25-69" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb25-70"><a href="#cb25-70" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Source),</span>
<span id="cb25-71"><a href="#cb25-71" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">24</span>,</span>
<span id="cb25-72"><a href="#cb25-72" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.7</span>),</span>
<span id="cb25-73"><a href="#cb25-73" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span><span class="sc">/</span>.pt, <span class="at">stroke =</span> <span class="fl">1.5</span><span class="sc">/</span>.pt) <span class="sc">+</span></span>
<span id="cb25-74"><a href="#cb25-74" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;green4&quot;</span>),</span>
<span id="cb25-75"><a href="#cb25-75" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;invivoPKfit&quot;</span>, <span class="st">&quot;Honda et al.&quot;</span>)) <span class="sc">+</span></span>
<span id="cb25-76"><a href="#cb25-76" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Oral Bioavailability&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-77"><a href="#cb25-77" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb25-78"><a href="#cb25-78" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb25-79"><a href="#cb25-79" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-80"><a href="#cb25-80" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-81"><a href="#cb25-81" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb25-82"><a href="#cb25-82" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb25-83"><a href="#cb25-83" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb25-84"><a href="#cb25-84" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-85"><a href="#cb25-85" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-86"><a href="#cb25-86" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb25-87"><a href="#cb25-87" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-88"><a href="#cb25-88" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb25-89"><a href="#cb25-89" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-90"><a href="#cb25-90" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb25-91"><a href="#cb25-91" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>())</span>
<span id="cb25-92"><a href="#cb25-92" tabindex="-1"></a></span>
<span id="cb25-93"><a href="#cb25-93" tabindex="-1"></a></span>
<span id="cb25-94"><a href="#cb25-94" tabindex="-1"></a><span class="fu">plot_grid</span>(sfig7A, sfig7B,</span>
<span id="cb25-95"><a href="#cb25-95" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">&quot;v&quot;</span>,</span>
<span id="cb25-96"><a href="#cb25-96" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-97"><a href="#cb25-97" tabindex="-1"></a>          <span class="at">axis =</span> <span class="st">&quot;lr&quot;</span>,</span>
<span id="cb25-98"><a href="#cb25-98" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">1.25</span>),</span>
<span id="cb25-99"><a href="#cb25-99" tabindex="-1"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span>
<span id="cb25-100"><a href="#cb25-100" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb25-101"><a href="#cb25-101" tabindex="-1"></a>                         today,</span>
<span id="cb25-102"><a href="#cb25-102" tabindex="-1"></a>                         <span class="st">&quot;metaAnalysis_Comparisons_SuppFigure7_named.png&quot;</span>),</span>
<span id="cb25-103"><a href="#cb25-103" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">5.5</span>,</span>
<span id="cb25-104"><a href="#cb25-104" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb25-105"><a href="#cb25-105" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-9-parallelization-decreases-runtime-of-invivopkfit" class="section level3">
<h3>Supp. Fig. 9: Parallelization decreases runtime of invivoPKfit</h3>
<p>Here I do a bit of benchmarking for the parallel-ized version of
do_fit</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># Randomize the order of chemical species</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>chem_spec <span class="ot">&lt;-</span> cvt <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(analyte_dtxsid, species) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="dv">1</span>)</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>test_group_size <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="dv">105</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>fit_options <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">error_model =</span> <span class="fu">c</span>(<span class="st">&quot;pooled&quot;</span>,</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>                                           <span class="st">&quot;hierarchical&quot;</span>),</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>                           <span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>                           <span class="at">log10_trans =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>                           <span class="at">time_scale =</span> <span class="fu">c</span>(</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>                             <span class="cn">TRUE</span>,</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>                             <span class="cn">FALSE</span>),</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>                           <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>fit_options <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(fit_options, test_group_size)</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>fit_options <span class="ot">&lt;-</span> fit_options <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">this_data =</span> <span class="fu">list</span>({</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> chem_spec <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> test_group_size) <span class="sc">%&gt;%</span></span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>      <span class="fu">left_join</span>(cvt, <span class="at">by =</span> <span class="fu">join_by</span>(analyte_dtxsid, species)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a>      <span class="fu">pk</span>() <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>        <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="fu">ifelse</span>(<span class="sc">!</span>time_scale, </span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>                                      <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>                                      <span class="st">&quot;auto&quot;</span>)) <span class="sc">+</span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>        <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> dose_norm, <span class="at">log10_trans =</span> log10_trans) <span class="sc">+</span></span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>        <span class="fu">settings_preprocess</span>(<span class="at">suppress.messages =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a>    <span class="fu">do_prefit</span>(tmp)</span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a>  }</span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a>  ),</span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a>  <span class="at">data_size =</span> chem_spec <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> test_group_size) <span class="sc">%&gt;%</span></span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a>    <span class="fu">left_join</span>(cvt, <span class="at">by =</span> <span class="fu">join_by</span>(analyte_dtxsid, species)) <span class="sc">%&gt;%</span></span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a>    <span class="fu">NROW</span>())</span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a><span class="co"># Organization of the benchmarking</span></span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a><span class="co"># For each fit_option, return the four values of system.time() that we want</span></span>
<span id="cb26-37"><a href="#cb26-37" tabindex="-1"></a>df_out <span class="ot">&lt;-</span> fit_options <span class="sc">%&gt;%</span></span>
<span id="cb26-38"><a href="#cb26-38" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-39"><a href="#cb26-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tim_1core =</span> <span class="fu">system.time</span>(<span class="fu">do_fit</span>(this_data))[[<span class="st">&quot;elapsed&quot;</span>]],</span>
<span id="cb26-40"><a href="#cb26-40" tabindex="-1"></a>         <span class="at">tim_4core =</span> <span class="fu">system.time</span>(<span class="fu">do_fit</span>(this_data, <span class="at">n_cores =</span> <span class="dv">4</span>))[[<span class="st">&quot;elapsed&quot;</span>]],</span>
<span id="cb26-41"><a href="#cb26-41" tabindex="-1"></a>         <span class="at">tim_7core =</span> <span class="fu">system.time</span>(<span class="fu">do_fit</span>(this_data, <span class="at">n_cores =</span> <span class="dv">7</span>))[[<span class="st">&quot;elapsed&quot;</span>]],</span>
<span id="cb26-42"><a href="#cb26-42" tabindex="-1"></a>         <span class="at">tim_12core =</span> <span class="fu">system.time</span>(<span class="fu">do_fit</span>(this_data, <span class="at">n_cores =</span> <span class="dv">12</span>))[[<span class="st">&quot;elapsed&quot;</span>]]</span>
<span id="cb26-43"><a href="#cb26-43" tabindex="-1"></a>         )</span>
<span id="cb26-44"><a href="#cb26-44" tabindex="-1"></a></span>
<span id="cb26-45"><a href="#cb26-45" tabindex="-1"></a>df_out <span class="ot">&lt;-</span> df_out <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>this_data)</span>
<span id="cb26-46"><a href="#cb26-46" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb26-47"><a href="#cb26-47" tabindex="-1"></a></span>
<span id="cb26-48"><a href="#cb26-48" tabindex="-1"></a>full_long <span class="ot">&lt;-</span> df_out <span class="sc">%&gt;%</span></span>
<span id="cb26-49"><a href="#cb26-49" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(tim_1core<span class="sc">:</span>tim_12core),</span>
<span id="cb26-50"><a href="#cb26-50" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">&quot;N_cores&quot;</span>,</span>
<span id="cb26-51"><a href="#cb26-51" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">&quot;Time_s&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-52"><a href="#cb26-52" tabindex="-1"></a>  <span class="fu">group_by</span>(N_cores, test_group_size, data_size) <span class="sc">%&gt;%</span></span>
<span id="cb26-53"><a href="#cb26-53" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_time =</span> <span class="fu">mean</span>(Time_s, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">60</span>,</span>
<span id="cb26-54"><a href="#cb26-54" tabindex="-1"></a>            <span class="at">max_time =</span> <span class="fu">max</span>(Time_s, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">60</span>,</span>
<span id="cb26-55"><a href="#cb26-55" tabindex="-1"></a>            <span class="at">min_time =</span> <span class="fu">min</span>(Time_s, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb26-56"><a href="#cb26-56" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb26-57"><a href="#cb26-57" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">N_cores =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(N_cores, <span class="st">&quot;[:digit:]+&quot;</span>)))</span>
<span id="cb26-58"><a href="#cb26-58" tabindex="-1"></a></span>
<span id="cb26-59"><a href="#cb26-59" tabindex="-1"></a>df_out <span class="sc">%&gt;%</span> clipr<span class="sc">::</span><span class="fu">write_clip</span>()</span>
<span id="cb26-60"><a href="#cb26-60" tabindex="-1"></a><span class="fu">ggplot</span>(full_long,</span>
<span id="cb26-61"><a href="#cb26-61" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> test_group_size,</span>
<span id="cb26-62"><a href="#cb26-62" tabindex="-1"></a>           <span class="at">y =</span> mean_time,</span>
<span id="cb26-63"><a href="#cb26-63" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">as.factor</span>(N_cores))) <span class="sc">+</span></span>
<span id="cb26-64"><a href="#cb26-64" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb26-65"><a href="#cb26-65" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> min_time,</span>
<span id="cb26-66"><a href="#cb26-66" tabindex="-1"></a>                <span class="at">ymax =</span> max_time)) <span class="sc">+</span></span>
<span id="cb26-67"><a href="#cb26-67" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> N_cores)) <span class="sc">+</span></span>
<span id="cb26-68"><a href="#cb26-68" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of Data Groups&quot;</span>,</span>
<span id="cb26-69"><a href="#cb26-69" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Runtime (minutes)&quot;</span>,</span>
<span id="cb26-70"><a href="#cb26-70" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of Processing Cores&quot;</span>,</span>
<span id="cb26-71"><a href="#cb26-71" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;(with min/max runtime range)&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-72"><a href="#cb26-72" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(N_cores)) <span class="sc">+</span></span>
<span id="cb26-73"><a href="#cb26-73" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;#40c679&quot;</span>, <span class="st">&quot;#31a354&quot;</span>, <span class="st">&quot;#006837&quot;</span>)) <span class="sc">+</span></span>
<span id="cb26-74"><a href="#cb26-74" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb26-75"><a href="#cb26-75" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb26-76"><a href="#cb26-76" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-77"><a href="#cb26-77" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb26-78"><a href="#cb26-78" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb26-79"><a href="#cb26-79" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb26-80"><a href="#cb26-80" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb26-81"><a href="#cb26-81" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-82"><a href="#cb26-82" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-83"><a href="#cb26-83" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb26-84"><a href="#cb26-84" tabindex="-1"></a></span>
<span id="cb26-85"><a href="#cb26-85" tabindex="-1"></a></span>
<span id="cb26-86"><a href="#cb26-86" tabindex="-1"></a></span>
<span id="cb26-87"><a href="#cb26-87" tabindex="-1"></a></span>
<span id="cb26-88"><a href="#cb26-88" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb26-89"><a href="#cb26-89" tabindex="-1"></a>              today,</span>
<span id="cb26-90"><a href="#cb26-90" tabindex="-1"></a>              <span class="st">&quot;Parallelization_Benchmarking.png&quot;</span>),</span>
<span id="cb26-91"><a href="#cb26-91" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb26-92"><a href="#cb26-92" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">2.5</span>,</span>
<span id="cb26-93"><a href="#cb26-93" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-5-example-plots-for-data-fits" class="section level3">
<h3>Supp. Fig. 5: Example plots for data fits</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>, <span class="at">n_interp =</span> <span class="dv">10</span>)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="fu">names</span>(pl) <span class="co"># Chemical Species observations observation_plot predicted predicted_plot final_plot</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>s6_plA <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID3031860&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>  <span class="fu">pull</span>(observation_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>s6_plB_mouse <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID4020533&quot;</span>,</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>                              Species <span class="sc">%in%</span> <span class="st">&quot;mouse&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>s6_plB_rat <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID4020533&quot;</span>,</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>                              Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>s6_plC <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID00216205&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>  <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>s6_plD <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID8025337&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>  <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="co"># Set colors palettes for each</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="co"># panel A : Oranges</span></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>panelA_cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Oranges&quot;</span>)[<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a><span class="co"># panel B : Greens</span></span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>panelB_cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Greens&quot;</span>)[<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a><span class="co"># panel C : Blue (only 2 values) </span></span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a><span class="co"># panel D : Purple (6 values)</span></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>panelD_cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Purples&quot;</span>)[<span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a>s6_plA <span class="ot">&lt;-</span> s6_plA <span class="sc">+</span> </span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;perfluorodecanoic acid&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> panelA_cols, <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a>s6_plB_mouse <span class="ot">&lt;-</span> s6_plB_mouse <span class="sc">+</span> </span>
<span id="cb27-32"><a href="#cb27-32" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;1,4-dioxane</span><span class="sc">\n</span><span class="st">Mouse&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-33"><a href="#cb27-33" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> panelB_cols[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">8</span>)],</span>
<span id="cb27-34"><a href="#cb27-34" tabindex="-1"></a>                     <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb27-35"><a href="#cb27-35" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb27-36"><a href="#cb27-36" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb27-37"><a href="#cb27-37" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb27-38"><a href="#cb27-38" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" tabindex="-1"></a>s6_plB_rat <span class="ot">&lt;-</span> s6_plB_rat <span class="sc">+</span> </span>
<span id="cb27-40"><a href="#cb27-40" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;1,4-dioxane</span><span class="sc">\n</span><span class="st">Rat&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-41"><a href="#cb27-41" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> panelB_cols[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">7</span>, <span class="dv">8</span>)],</span>
<span id="cb27-42"><a href="#cb27-42" tabindex="-1"></a>                     <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb27-43"><a href="#cb27-43" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb27-44"><a href="#cb27-44" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb27-45"><a href="#cb27-45" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb27-46"><a href="#cb27-46" tabindex="-1"></a></span>
<span id="cb27-47"><a href="#cb27-47" tabindex="-1"></a>s6_plC <span class="ot">&lt;-</span> s6_plC <span class="sc">+</span></span>
<span id="cb27-48"><a href="#cb27-48" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;psoralen&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-49"><a href="#cb27-49" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#6BAED6&quot;</span>, <span class="st">&quot;#08519C&quot;</span>, <span class="st">&quot;darkblue&quot;</span>),</span>
<span id="cb27-50"><a href="#cb27-50" tabindex="-1"></a>                     <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb27-51"><a href="#cb27-51" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb27-52"><a href="#cb27-52" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb27-53"><a href="#cb27-53" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb27-54"><a href="#cb27-54" tabindex="-1"></a></span>
<span id="cb27-55"><a href="#cb27-55" tabindex="-1"></a>s6_plD <span class="ot">&lt;-</span> s6_plD <span class="sc">+</span></span>
<span id="cb27-56"><a href="#cb27-56" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;formamide&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-57"><a href="#cb27-57" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> panelD_cols,</span>
<span id="cb27-58"><a href="#cb27-58" tabindex="-1"></a>                     <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb27-59"><a href="#cb27-59" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb27-60"><a href="#cb27-60" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb27-61"><a href="#cb27-61" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb27-62"><a href="#cb27-62" tabindex="-1"></a></span>
<span id="cb27-63"><a href="#cb27-63" tabindex="-1"></a><span class="co"># Put it all together</span></span>
<span id="cb27-64"><a href="#cb27-64" tabindex="-1"></a>s6_plB <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(s6_plB_mouse, s6_plB_rat,</span>
<span id="cb27-65"><a href="#cb27-65" tabindex="-1"></a>            <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>,</span>
<span id="cb27-66"><a href="#cb27-66" tabindex="-1"></a>           <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">1.2</span>,<span class="dv">2</span>))</span>
<span id="cb27-67"><a href="#cb27-67" tabindex="-1"></a></span>
<span id="cb27-68"><a href="#cb27-68" tabindex="-1"></a></span>
<span id="cb27-69"><a href="#cb27-69" tabindex="-1"></a>s6_plCD <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(s6_plC, s6_plD, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>), <span class="at">label_size =</span> <span class="dv">24</span>)</span>
<span id="cb27-70"><a href="#cb27-70" tabindex="-1"></a></span>
<span id="cb27-71"><a href="#cb27-71" tabindex="-1"></a></span>
<span id="cb27-72"><a href="#cb27-72" tabindex="-1"></a><span class="fu">plot_grid</span>(</span>
<span id="cb27-73"><a href="#cb27-73" tabindex="-1"></a>  s6_plA,</span>
<span id="cb27-74"><a href="#cb27-74" tabindex="-1"></a>  s6_plB,</span>
<span id="cb27-75"><a href="#cb27-75" tabindex="-1"></a>  s6_plCD,</span>
<span id="cb27-76"><a href="#cb27-76" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">&quot;v&quot;</span>,</span>
<span id="cb27-77"><a href="#cb27-77" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb27-78"><a href="#cb27-78" tabindex="-1"></a>  <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">1.25</span>, <span class="fl">1.2</span>, <span class="fl">1.25</span>),</span>
<span id="cb27-79"><a href="#cb27-79" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb27-80"><a href="#cb27-80" tabindex="-1"></a>  <span class="at">label_size =</span> <span class="dv">24</span></span>
<span id="cb27-81"><a href="#cb27-81" tabindex="-1"></a>)</span>
<span id="cb27-82"><a href="#cb27-82" tabindex="-1"></a></span>
<span id="cb27-83"><a href="#cb27-83" tabindex="-1"></a><span class="co"># Am making this 2X the size I need it to be </span></span>
<span id="cb27-84"><a href="#cb27-84" tabindex="-1"></a><span class="co"># so the points are a reasonable size when I scale it down</span></span>
<span id="cb27-85"><a href="#cb27-85" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb27-86"><a href="#cb27-86" tabindex="-1"></a>              <span class="st">&quot;ExampleFitsPlots_06.12.2024.png&quot;</span>),</span>
<span id="cb27-87"><a href="#cb27-87" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">13</span>,</span>
<span id="cb27-88"><a href="#cb27-88" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">14</span>,</span>
<span id="cb27-89"><a href="#cb27-89" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="other-plots" class="section level2">
<h2>Other Plots</h2>
<div id="plotting-all-fits" class="section level3">
<h3>Plotting ALL fits</h3>
<p>Here is the code used to generate the CvT data and
<em>invivoPKfit</em> fits for each chemical, species data group.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="do">### Plotting for all (2.5MB file)</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk, <span class="at">n_interp =</span> <span class="dv">12</span>, <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>              <span class="st">&quot;Transformed_Joint_AllFits_Final_2024_05_16.pdf&quot;</span>),</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">10</span>)</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pl)) {</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="fu">print</span>(pl<span class="sc">$</span>final_plot[[i]])</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>}</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="co"># From my new SQL pull</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk, <span class="at">n_interp =</span> <span class="dv">12</span>, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>, <span class="at">best_fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>              <span class="st">&quot;Joint_bobyqa_AllFits_Final_20240514.pdf&quot;</span>),</span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">10</span>, <span class="at">width =</span> <span class="dv">10</span>)</span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pl)) {</span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>  <span class="fu">print</span>(pl<span class="sc">$</span>final_plot[[i]])</span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>}</span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p>It is also possible to plot only one plot.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk, <span class="at">n_interp =</span> <span class="dv">10</span>, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>pl <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID5020029&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span></code></pre></div>
</div>
</div>
<div id="preparing-results-for-cvtdb" class="section level2">
<h2>Preparing results for CvTdb</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>my_cvt <span class="ot">&lt;-</span> cvt</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>my_wm <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(my_pk)</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>my_tkstats <span class="ot">&lt;-</span> <span class="fu">get_tkstats</span>(my_pk) <span class="sc">%&gt;%</span>  </span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>  <span class="fu">rename2_cvt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(invivpk_dose_level, dose_units, conc_units, time_units,</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>            data_sigma_group, fk_extraction_document_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> cltot<span class="sc">:</span>vss_fgutabs,</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;param_name&quot;</span>,</span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;estimate&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param_units =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>    param_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;cltot&quot;</span>, <span class="st">&quot;cltot_fgutabs&quot;</span>) <span class="sc">~</span> <span class="st">&quot;L/hours&quot;</span>,</span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>    param_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;css&quot;</span>, <span class="st">&quot;cmax&quot;</span>) <span class="sc">~</span> <span class="st">&quot;mg/L&quot;</span>,</span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>    param_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;halflife&quot;</span>, <span class="st">&quot;tmax&quot;</span>) <span class="sc">~</span> <span class="st">&quot;hours&quot;</span>,</span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>    param_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;vss&quot;</span>, <span class="st">&quot;vss_fgutabs&quot;</span>) <span class="sc">~</span> <span class="st">&quot;L&quot;</span>,</span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a>    param_name <span class="sc">%in%</span> <span class="st">&quot;auc_infinity&quot;</span> <span class="sc">~</span> <span class="st">&quot;mg/L * hours&quot;</span>,</span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a>    <span class="at">.default =</span> <span class="cn">NA_character_</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dose_normalization =</span> <span class="fu">conc_scale_use</span>(<span class="cn">TRUE</span>, my_pk)<span class="sc">$</span>dose_norm,</span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a>         <span class="at">log10_transformation =</span> <span class="fu">conc_scale_use</span>(<span class="cn">TRUE</span>,my_pk)<span class="sc">$</span>log10_trans,</span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a>         <span class="at">time_scaling =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a>         <span class="at">invivoPKfit_version =</span> <span class="st">&quot;2.0.0&quot;</span>,</span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a>         <span class="at">update_date =</span> today) <span class="sc">%&gt;%</span> </span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;model_1comp&quot;</span>, <span class="st">&quot;model_2comp&quot;</span>))</span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a>my_params <span class="ot">&lt;-</span> my_pk<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a>  <span class="fu">rename2_cvt</span>() <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(</span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a>    analyte_dtxsid, species, model, method, param_name, estimate, param_units</span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-33"><a href="#cb30-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dose_normalization =</span> <span class="fu">conc_scale_use</span>(<span class="cn">TRUE</span>, my_pk)<span class="sc">$</span>dose_norm,</span>
<span id="cb30-34"><a href="#cb30-34" tabindex="-1"></a>         <span class="at">log10_transformation =</span> <span class="fu">conc_scale_use</span>(<span class="cn">TRUE</span>,my_pk)<span class="sc">$</span>log10_trans,</span>
<span id="cb30-35"><a href="#cb30-35" tabindex="-1"></a>         <span class="at">time_scaling =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb30-36"><a href="#cb30-36" tabindex="-1"></a>         <span class="at">invivoPKfit_version =</span> <span class="st">&quot;2.0.0&quot;</span>,</span>
<span id="cb30-37"><a href="#cb30-37" tabindex="-1"></a>         <span class="at">update_date =</span> today) <span class="sc">%&gt;%</span> </span>
<span id="cb30-38"><a href="#cb30-38" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;model_1comp&quot;</span>, <span class="st">&quot;model_2comp&quot;</span>))</span>
<span id="cb30-39"><a href="#cb30-39" tabindex="-1"></a></span>
<span id="cb30-40"><a href="#cb30-40" tabindex="-1"></a>my_cvt_unique <span class="ot">&lt;-</span> my_cvt <span class="sc">%&gt;%</span></span>
<span id="cb30-41"><a href="#cb30-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-42"><a href="#cb30-42" tabindex="-1"></a>    <span class="at">conc_processing_flags =</span> </span>
<span id="cb30-43"><a href="#cb30-43" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb30-44"><a href="#cb30-44" tabindex="-1"></a>        invivPK_conc <span class="sc">==</span> conc <span class="sc">~</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Used &#39;conc&#39; value.&quot;</span>),</span>
<span id="cb30-45"><a href="#cb30-45" tabindex="-1"></a>        invivPK_conc <span class="sc">==</span> conc_original <span class="sc">~</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Used &#39;conc_original&#39; value.&quot;</span>),</span>
<span id="cb30-46"><a href="#cb30-46" tabindex="-1"></a>        invivPK_conc <span class="sc">==</span> conc_original <span class="sc">*</span> conc_unit_norm_factor <span class="sc">~</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb30-47"><a href="#cb30-47" tabindex="-1"></a>          <span class="st">&quot;Mulitplied &#39;conc_original&#39; by {conc_unit_norm_factor}.&quot;</span></span>
<span id="cb30-48"><a href="#cb30-48" tabindex="-1"></a>        ),</span>
<span id="cb30-49"><a href="#cb30-49" tabindex="-1"></a>        invivPK_conc <span class="sc">!=</span> conc_original <span class="sc">*</span> conc_unit_norm_factor <span class="sc">~</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb30-50"><a href="#cb30-50" tabindex="-1"></a>          <span class="st">&quot;Multiplied &#39;conc_original&#39; by {signif(invivPK_conc/conc_original, 2)}.&quot;</span></span>
<span id="cb30-51"><a href="#cb30-51" tabindex="-1"></a>        ),</span>
<span id="cb30-52"><a href="#cb30-52" tabindex="-1"></a>        <span class="fu">is.na</span>(conc) <span class="sc">~</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb30-53"><a href="#cb30-53" tabindex="-1"></a>          <span class="st">&quot;Multiplied &#39;conc_original&#39; by {signif(invivPK_conc/conc_original, 2)}&quot;</span></span>
<span id="cb30-54"><a href="#cb30-54" tabindex="-1"></a>          ),</span>
<span id="cb30-55"><a href="#cb30-55" tabindex="-1"></a>        <span class="at">.default =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb30-56"><a href="#cb30-56" tabindex="-1"></a>      )</span>
<span id="cb30-57"><a href="#cb30-57" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-58"><a href="#cb30-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-59"><a href="#cb30-59" tabindex="-1"></a>    <span class="at">loq_processing_flags =</span> </span>
<span id="cb30-60"><a href="#cb30-60" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb30-61"><a href="#cb30-61" tabindex="-1"></a>        invivPK_loq <span class="sc">==</span> loq,</span>
<span id="cb30-62"><a href="#cb30-62" tabindex="-1"></a>        glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Used &#39;loq&#39; value.&quot;</span>),</span>
<span id="cb30-63"><a href="#cb30-63" tabindex="-1"></a>        glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Multiplied &#39;loq&#39; value by {signif(invivPK_loq/loq,2)}.&quot;</span>),</span>
<span id="cb30-64"><a href="#cb30-64" tabindex="-1"></a>        <span class="at">missing =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;&#39;loq&#39; was imputed as 90% of lowest concentration.&quot;</span>)</span>
<span id="cb30-65"><a href="#cb30-65" tabindex="-1"></a>      )</span>
<span id="cb30-66"><a href="#cb30-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-67"><a href="#cb30-67" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-68"><a href="#cb30-68" tabindex="-1"></a>    <span class="at">dose_processing_flags =</span></span>
<span id="cb30-69"><a href="#cb30-69" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb30-70"><a href="#cb30-70" tabindex="-1"></a>        invivPK_dose_level <span class="sc">==</span> dose_level_normalized,</span>
<span id="cb30-71"><a href="#cb30-71" tabindex="-1"></a>        glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Used &#39;dose_level_normalized&#39;.&quot;</span>),</span>
<span id="cb30-72"><a href="#cb30-72" tabindex="-1"></a>        glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Multiplied &#39;dose_level_normalized&#39; by&quot;</span>,</span>
<span id="cb30-73"><a href="#cb30-73" tabindex="-1"></a>                   <span class="st">&quot; {signif(invivPK_dose_level/dose_level_normalized, 3)}.&quot;</span>)</span>
<span id="cb30-74"><a href="#cb30-74" tabindex="-1"></a>      )</span>
<span id="cb30-75"><a href="#cb30-75" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-76"><a href="#cb30-76" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(fk_series_id,</span>
<span id="cb30-77"><a href="#cb30-77" tabindex="-1"></a>                analyte_dtxsid,</span>
<span id="cb30-78"><a href="#cb30-78" tabindex="-1"></a>                species,</span>
<span id="cb30-79"><a href="#cb30-79" tabindex="-1"></a>                administration_route_normalized,</span>
<span id="cb30-80"><a href="#cb30-80" tabindex="-1"></a>                conc_medium_normalized,</span>
<span id="cb30-81"><a href="#cb30-81" tabindex="-1"></a>                conc_processing_flags,</span>
<span id="cb30-82"><a href="#cb30-82" tabindex="-1"></a>                dose_processing_flags,</span>
<span id="cb30-83"><a href="#cb30-83" tabindex="-1"></a>                loq_processing_flags,</span>
<span id="cb30-84"><a href="#cb30-84" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span></span>
<span id="cb30-85"><a href="#cb30-85" tabindex="-1"></a>  <span class="fu">group_by</span>(analyte_dtxsid, species,</span>
<span id="cb30-86"><a href="#cb30-86" tabindex="-1"></a>           administration_route_normalized,</span>
<span id="cb30-87"><a href="#cb30-87" tabindex="-1"></a>           conc_medium_normalized) <span class="sc">%&gt;%</span> </span>
<span id="cb30-88"><a href="#cb30-88" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">all_series_ids =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(fk_series_id), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>),</span>
<span id="cb30-89"><a href="#cb30-89" tabindex="-1"></a>            <span class="at">conc_processing_flags =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(conc_processing_flags), <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb30-90"><a href="#cb30-90" tabindex="-1"></a>            <span class="at">dose_processing_flags =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(dose_processing_flags), <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb30-91"><a href="#cb30-91" tabindex="-1"></a>            <span class="at">loq_processing_flags =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(loq_processing_flags), <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-92"><a href="#cb30-92" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb30-93"><a href="#cb30-93" tabindex="-1"></a></span>
<span id="cb30-94"><a href="#cb30-94" tabindex="-1"></a>tkstats_cvtdb <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(my_cvt_unique, my_tkstats,</span>
<span id="cb30-95"><a href="#cb30-95" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">join_by</span>(analyte_dtxsid, species,</span>
<span id="cb30-96"><a href="#cb30-96" tabindex="-1"></a>                                  administration_route_normalized,</span>
<span id="cb30-97"><a href="#cb30-97" tabindex="-1"></a>                                  conc_medium_normalized)) <span class="sc">%&gt;%</span></span>
<span id="cb30-98"><a href="#cb30-98" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb30-99"><a href="#cb30-99" tabindex="-1"></a>params_cvtdb <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(my_cvt_unique, my_params,</span>
<span id="cb30-100"><a href="#cb30-100" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">join_by</span>(analyte_dtxsid, species),</span>
<span id="cb30-101"><a href="#cb30-101" tabindex="-1"></a>                     <span class="at">relationship =</span> <span class="st">&quot;many-to-many&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-102"><a href="#cb30-102" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb30-103"><a href="#cb30-103" tabindex="-1"></a></span>
<span id="cb30-104"><a href="#cb30-104" tabindex="-1"></a><span class="co"># Writing to file</span></span>
<span id="cb30-105"><a href="#cb30-105" tabindex="-1"></a><span class="fu">bind_rows</span>(params_cvtdb,</span>
<span id="cb30-106"><a href="#cb30-106" tabindex="-1"></a>          tkstats_cvtdb) <span class="sc">%&gt;%</span> </span>
<span id="cb30-107"><a href="#cb30-107" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="ot">-&gt;</span> tkparams_cvtdb</span>
<span id="cb30-108"><a href="#cb30-108" tabindex="-1"></a>tkparams_cvtdb_winmodels <span class="ot">&lt;-</span> tkparams_cvtdb <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(my_wm)</span>
<span id="cb30-109"><a href="#cb30-109" tabindex="-1"></a><span class="fu">save</span>(tkparams_cvtdb, tkstats_cvtdb, params_cvtdb, tkparams_cvtdb_winmodels,</span>
<span id="cb30-110"><a href="#cb30-110" tabindex="-1"></a>     <span class="at">file =</span> <span class="st">&quot;data-raw/tkparams_CvTdb.Rdata&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co">#&gt; R version 4.4.1 (2024-06-14 ucrt)</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="co">#&gt; Platform: x86_64-w64-mingw32/x64</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="co">#&gt; Running under: Windows 11 x64 (build 22631)</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="co">#&gt; Matrix products: default</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="co">#&gt; locale:</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="co">#&gt; [1] LC_COLLATE=C                          </span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="co">#&gt; [2] LC_CTYPE=English_United States.utf8   </span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="co">#&gt; [3] LC_MONETARY=English_United States.utf8</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="co">#&gt; [4] LC_NUMERIC=C                          </span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="co">#&gt; [5] LC_TIME=English_United States.utf8    </span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a><span class="co">#&gt; time zone: America/New_York</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="co">#&gt; tzcode source: internal</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a><span class="co">#&gt; attached base packages:</span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a><span class="co">#&gt; other attached packages:</span></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a><span class="co">#&gt;  [1] invivoPKfit_2.0.0  testthat_3.2.1.1   RColorBrewer_1.1-3 cowplot_1.1.3     </span></span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a><span class="co">#&gt;  [5] lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1      dplyr_1.1.4       </span></span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a><span class="co">#&gt;  [9] purrr_1.0.2        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      </span></span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a><span class="co">#&gt; [13] ggplot2_3.5.1      tidyverse_2.0.0   </span></span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a><span class="co">#&gt;  [1] tidyselect_1.2.1    fastmap_1.2.0       pracma_2.4.4       </span></span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a><span class="co">#&gt;  [4] promises_1.3.0      digest_0.6.37       timechange_0.3.0   </span></span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a><span class="co">#&gt;  [7] mime_0.12           lifecycle_1.0.4     ellipsis_0.3.2     </span></span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a><span class="co">#&gt; [10] survival_3.7-0      magrittr_2.0.3      compiler_4.4.1     </span></span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a><span class="co">#&gt; [13] rlang_1.1.4         sass_0.4.9          tools_4.4.1        </span></span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a><span class="co">#&gt; [16] utf8_1.2.4          yaml_2.3.10         data.table_1.16.2  </span></span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a><span class="co">#&gt; [19] knitr_1.48          htmlwidgets_1.6.4   pkgbuild_1.4.4     </span></span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a><span class="co">#&gt; [22] pkgload_1.4.0       miniUI_0.1.1.1      expm_1.0-0         </span></span>
<span id="cb31-37"><a href="#cb31-37" tabindex="-1"></a><span class="co">#&gt; [25] withr_3.0.1         numDeriv_2016.8-1.1 desc_1.4.3         </span></span>
<span id="cb31-38"><a href="#cb31-38" tabindex="-1"></a><span class="co">#&gt; [28] grid_4.4.1          fansi_1.0.6         urlchecker_1.0.1   </span></span>
<span id="cb31-39"><a href="#cb31-39" tabindex="-1"></a><span class="co">#&gt; [31] profvis_0.4.0       xtable_1.8-4        colorspace_2.1-1   </span></span>
<span id="cb31-40"><a href="#cb31-40" tabindex="-1"></a><span class="co">#&gt; [34] scales_1.3.0        httk_2.4.0          MASS_7.3-61        </span></span>
<span id="cb31-41"><a href="#cb31-41" tabindex="-1"></a><span class="co">#&gt; [37] cli_3.6.3           mvtnorm_1.3-1       survey_4.4-2       </span></span>
<span id="cb31-42"><a href="#cb31-42" tabindex="-1"></a><span class="co">#&gt; [40] rmarkdown_2.28      generics_0.1.3      remotes_2.5.0      </span></span>
<span id="cb31-43"><a href="#cb31-43" tabindex="-1"></a><span class="co">#&gt; [43] rstudioapi_0.17.0   tzdb_0.4.0          sessioninfo_1.2.2  </span></span>
<span id="cb31-44"><a href="#cb31-44" tabindex="-1"></a><span class="co">#&gt; [46] DBI_1.2.3           msm_1.8.1           cachem_1.1.0       </span></span>
<span id="cb31-45"><a href="#cb31-45" tabindex="-1"></a><span class="co">#&gt; [49] splines_4.4.1       mitools_2.4         vctrs_0.6.5        </span></span>
<span id="cb31-46"><a href="#cb31-46" tabindex="-1"></a><span class="co">#&gt; [52] devtools_2.4.5      Matrix_1.7-0        jsonlite_1.8.9     </span></span>
<span id="cb31-47"><a href="#cb31-47" tabindex="-1"></a><span class="co">#&gt; [55] hms_1.1.3           optimx_2023-10.21   jquerylib_0.1.4    </span></span>
<span id="cb31-48"><a href="#cb31-48" tabindex="-1"></a><span class="co">#&gt; [58] glue_1.8.0          nloptr_2.1.1        multidplyr_0.1.3   </span></span>
<span id="cb31-49"><a href="#cb31-49" tabindex="-1"></a><span class="co">#&gt; [61] PK_1.3-6            stringi_1.8.4       gtable_0.3.5       </span></span>
<span id="cb31-50"><a href="#cb31-50" tabindex="-1"></a><span class="co">#&gt; [64] later_1.3.2         munsell_0.5.1       pillar_1.9.0       </span></span>
<span id="cb31-51"><a href="#cb31-51" tabindex="-1"></a><span class="co">#&gt; [67] brio_1.1.5          htmltools_0.5.8.1   deSolve_1.40       </span></span>
<span id="cb31-52"><a href="#cb31-52" tabindex="-1"></a><span class="co">#&gt; [70] R6_2.5.1            Rdpack_2.6.1        rprojroot_2.0.4    </span></span>
<span id="cb31-53"><a href="#cb31-53" tabindex="-1"></a><span class="co">#&gt; [73] evaluate_1.0.1      shiny_1.9.1         lattice_0.22-6     </span></span>
<span id="cb31-54"><a href="#cb31-54" tabindex="-1"></a><span class="co">#&gt; [76] rbibutils_2.3       memoise_2.0.1       httpuv_1.6.15      </span></span>
<span id="cb31-55"><a href="#cb31-55" tabindex="-1"></a><span class="co">#&gt; [79] bslib_0.8.0         Rcpp_1.0.13         xfun_0.48          </span></span>
<span id="cb31-56"><a href="#cb31-56" tabindex="-1"></a><span class="co">#&gt; [82] fs_1.6.4            usethis_3.0.0       pkgconfig_2.0.3</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
