<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Manuscript Figures and Tables (2024, submitted)</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Manuscript Figures and Tables (2024,
submitted)</h1>


<div id="TOC">
<ul>
<li><a href="#overview" id="toc-overview"><span class="toc-section-number">1</span> Overview</a></li>
<li><a href="#setup" id="toc-setup"><span class="toc-section-number">2</span> Setup</a></li>
<li><a href="#pulling-data-from-cvtdb" id="toc-pulling-data-from-cvtdb"><span class="toc-section-number">3</span> Pulling data from CvTdb</a></li>
<li><a href="#minimal-pk-object" id="toc-minimal-pk-object"><span class="toc-section-number">4</span> Minimal PK object</a></li>
<li><a href="#running-all-possible-fitting-options" id="toc-running-all-possible-fitting-options"><span class="toc-section-number">5</span> Running all possible fitting
options</a></li>
<li><a href="#characterizing-the-data" id="toc-characterizing-the-data"><span class="toc-section-number">6</span> Characterizing the data</a>
<ul>
<li><a href="#number-of-data-groups-with-both-blood-and-plasma-data-available" id="toc-number-of-data-groups-with-both-blood-and-plasma-data-available"><span class="toc-section-number">6.1</span> Number of data groups with both
blood and plasma data available</a></li>
<li><a href="#number-of-data-groups-where-time-scaling-could-occur" id="toc-number-of-data-groups-where-time-scaling-could-occur"><span class="toc-section-number">6.2</span> Number of data groups where time
scaling could occur</a></li>
<li><a href="#how-many-experiments-chemical-species-reference-route-media-were-flagged-for-potential-dose-dependence" id="toc-how-many-experiments-chemical-species-reference-route-media-were-flagged-for-potential-dose-dependence"><span class="toc-section-number">6.3</span> How many experiments (Chemical,
Species, Reference, Route, Media) were flagged for potential dose
dependence?</a></li>
<li><a href="#evaluating-time-and-concentration-ranges" id="toc-evaluating-time-and-concentration-ranges"><span class="toc-section-number">6.4</span> Evaluating time and concentration
ranges</a></li>
<li><a href="#evaluating-data-variability" id="toc-evaluating-data-variability"><span class="toc-section-number">6.5</span> Evaluating data variability</a>
<ul>
<li><a href="#figure-3" id="toc-figure-3"><span class="toc-section-number">6.5.1</span> Figure 3</a></li>
<li><a href="#supplemental-figure-3-histogram-of-data-variability-by-time" id="toc-supplemental-figure-3-histogram-of-data-variability-by-time"><span class="toc-section-number">6.5.2</span> Supplemental Figure 3: Histogram
of data variability by time</a></li>
</ul></li>
</ul></li>
<li><a href="#evaluating-fitting-options" id="toc-evaluating-fitting-options"><span class="toc-section-number">7</span> Evaluating fitting options</a>
<ul>
<li><a href="#winning-model-tally" id="toc-winning-model-tally"><span class="toc-section-number">7.1</span> Winning model tally</a></li>
<li><a href="#rmsle-for-cmax-and-auc-with-some-tallys-for-extreme-values" id="toc-rmsle-for-cmax-and-auc-with-some-tallys-for-extreme-values"><span class="toc-section-number">7.2</span> RMSLE for Cmax and AUC (with some
tallys for extreme values)</a>
<ul>
<li><a href="#auc_inf-and-cmax-comparison" id="toc-auc_inf-and-cmax-comparison"><span class="toc-section-number">7.2.1</span> AUC_inf and Cmax
comparison</a></li>
</ul></li>
<li><a href="#goodness-of-fit-metrics" id="toc-goodness-of-fit-metrics"><span class="toc-section-number">7.3</span> Goodness of fit metrics</a></li>
<li><a href="#get-all-predictions" id="toc-get-all-predictions"><span class="toc-section-number">7.4</span> Get all predictions</a></li>
<li><a href="#factor-of-two-model-error" id="toc-factor-of-two-model-error"><span class="toc-section-number">7.5</span> Factor of two model error</a></li>
<li><a href="#evaluate-the-various-gof-metrics" id="toc-evaluate-the-various-gof-metrics"><span class="toc-section-number">7.6</span> Evaluate the various GOF
metrics</a></li>
<li><a href="#rank-fitting-options" id="toc-rank-fitting-options"><span class="toc-section-number">7.7</span> Rank fitting options</a></li>
<li><a href="#supplemental-table-2-save-evaluation-results" id="toc-supplemental-table-2-save-evaluation-results"><span class="toc-section-number">7.8</span> Supplemental Table 2: Save
evaluation results</a></li>
<li><a href="#plots-for-evaluation-of-fitting-options" id="toc-plots-for-evaluation-of-fitting-options"><span class="toc-section-number">7.9</span> Plots for evaluation of fitting
options</a>
<ul>
<li><a href="#goodness-of-fit-metrics-rsq-and-rmsle-across-fitting-options" id="toc-goodness-of-fit-metrics-rsq-and-rmsle-across-fitting-options"><span class="toc-section-number">7.9.1</span> Goodness-of-fit metrics Rsq and
RMSLE across fitting options</a></li>
<li><a href="#cmax-rmsle-vs.-auc-rmsle-across-fitting-options" id="toc-cmax-rmsle-vs.-auc-rmsle-across-fitting-options"><span class="toc-section-number">7.9.2</span> Cmax RMSLE vs. AUC RMSLE across
fitting options</a></li>
</ul></li>
</ul></li>
<li><a href="#analysis-plots-and-tables-for-best-set-of-fitting-options" id="toc-analysis-plots-and-tables-for-best-set-of-fitting-options"><span class="toc-section-number">8</span> Analysis Plots and Tables for Best
Set of Fitting Options</a>
<ul>
<li><a href="#supp-figure-7-invivopkfit-model-performance" id="toc-supp-figure-7-invivopkfit-model-performance"><span class="toc-section-number">8.0.1</span> Supp Figure 7: invivoPKfit model
performance</a></li>
<li><a href="#figure-4-and-supplemental-figures-4-5-model-performance-vs-data-variability" id="toc-figure-4-and-supplemental-figures-4-5-model-performance-vs-data-variability"><span class="toc-section-number">8.0.2</span> Figure 4 and Supplemental
Figures 4 &amp; 5: Model performance vs Data Variability</a></li>
<li><a href="#figure-5-multiple-goodness-of-fit-metrics-validate-model-performance" id="toc-figure-5-multiple-goodness-of-fit-metrics-validate-model-performance"><span class="toc-section-number">8.0.3</span> Figure 5: Multiple
goodness-of-fit metrics validate model performance</a></li>
<li><a href="#figure-7-examples-fits-for-chemicals-with-r-squared-and-within-2-fold" id="toc-figure-7-examples-fits-for-chemicals-with-r-squared-and-within-2-fold"><span class="toc-section-number">8.0.4</span> Figure 7: Examples fits for
chemicals with R-squared and within 2-fold</a></li>
<li><a href="#figure-6-comparing-derived-tk-stats-with-human-tk-stats-from-lombardo-et-al." id="toc-figure-6-comparing-derived-tk-stats-with-human-tk-stats-from-lombardo-et-al."><span class="toc-section-number">8.0.5</span> Figure 6: Comparing derived TK
stats with human TK stats from Lombardo et al.</a></li>
<li><a href="#supp.-fig.-9-fgutabs-comparison-with-literature-values-compiled-by-musther-et-al.-2014" id="toc-supp.-fig.-9-fgutabs-comparison-with-literature-values-compiled-by-musther-et-al.-2014"><span class="toc-section-number">8.0.6</span> Supp. Fig. 9: Fgutabs comparison
with literature values compiled by Musther et al. (2014)</a></li>
<li><a href="#supp.-fig.-10-parallelization-decreases-runtime-of-invivopkfit" id="toc-supp.-fig.-10-parallelization-decreases-runtime-of-invivopkfit"><span class="toc-section-number">8.0.7</span> Supp. Fig. 10: Parallelization
decreases runtime of invivoPKfit</a></li>
</ul></li>
<li><a href="#summary-fit-data-for-all-fitting-options-all-models-all-data-groups" id="toc-summary-fit-data-for-all-fitting-options-all-models-all-data-groups"><span class="toc-section-number">9</span> Summary fit data for all fitting
options, all models, all data groups</a></li>
<li><a href="#individual-study-level-analysis" id="toc-individual-study-level-analysis"><span class="toc-section-number">10</span> Individual study level
analysis</a></li>
<li><a href="#all-plots-for-best-set-of-fitting-options" id="toc-all-plots-for-best-set-of-fitting-options"><span class="toc-section-number">11</span> All plots for best set of fitting
options</a></li>
<li><a href="#print-sessioninfo" id="toc-print-sessioninfo"><span class="toc-section-number">12</span> Print sessionInfo()</a></li>
</ul>
</div>

<div id="overview" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Overview</h1>
<p>This R Markdown document includes code to reproduce the analyses,
figures, and tables from the 2024 manuscript that describes
<em>invivoPKfit</em>’s use in a case study with CvT data from over 200
Chemicals.</p>
</div>
<div id="setup" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Setup</h1>
<p>Load needed packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(ctxR)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(officer)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>() <span class="co">#load invivopkfit</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#get today&#39;s date</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>today <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%d%B%Y&quot;</span>)</span></code></pre></div>
<p>This file refers to two environment variables, <code>OD_DIR</code>
and <code>FIG_DIR</code>. <code>OD_DIR</code> should be set to the path
where you have placed the necessary input files. <code>FIG_DIR</code>
should be set to the path where you want to save the figures and tables.
You can set those environment variables locally inside R like this,
replacing “path/to/inputs” and “path/to/outputs” with your actual paths.
You’ll want to make sure the paths end with a slash!</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">OD_DIR =</span> <span class="st">&quot;path/to/inputs/&quot;</span>,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>           <span class="at">FIG_DIR =</span> <span class="st">&quot;path/to/outputs/&quot;</span>)</span></code></pre></div>
<p>Additionally, at one point, this code uses package <code>ctxR</code>
to query the CompTox Chemicals Dashboard. In order to run that portion
of the code, you will need to have an API key (free), which you can
request by emailing <code>ccte_api@epa.gov</code>. You can register your
API key for the duration of your R session so that <code>ctxR</code>
will not need to ask you for it: simply replace “<YOUR-API-KEY>” in the
following line of code with your actual API key. (Remember not to commit
your actual API key to any version-control repository, or otherwise
share it with anyone else!)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>ctxR<span class="sc">::</span><span class="fu">register_ctx_api_key</span>(<span class="at">key =</span> <span class="st">&quot;&lt;YOUR-API-KEY&gt;&quot;</span>)</span></code></pre></div>
<p>Define a date for the pre-fit pk objects to read in:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>read_date_pk <span class="ot">&lt;-</span> <span class="st">&quot;25November2024&quot;</span></span></code></pre></div>
<p>And a date for the results files to read from:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>read_date_results <span class="ot">&lt;-</span> <span class="st">&quot;27November2024&quot;</span></span></code></pre></div>
</div>
<div id="pulling-data-from-cvtdb" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Pulling data from
CvTdb</h1>
<p>See <code>pulling_iv_oral_cvtdb.Rmd</code>.</p>
</div>
<div id="minimal-pk-object" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Minimal PK object</h1>
<p>The following chunk shows the column/field mapping from the
<code>cvt</code> object and the <code>pk</code> object needed for
invivoPKfit analysis. The <code>cvt</code> object is data from the CvTdb
database that includes chemicals with oral or intravenous routes of
administration and takes measurements from blood or plasma. The data has
been processed and cleaned to facilitate its use with
<em>invivoPKfit</em>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">### Minimal PK Object </span><span class="al">###</span><span class="do">----</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co"># Minimum pk object, add options later</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Note that these mappings are now a default mappings, just being verbose here.</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># If there are any standard deviations that are zero or NA, but N_Subjects &gt; 1,</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co"># Set the n_subjects to 6 or the current value if lower than 6.</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># (In Showa the mode is 6, but this condition is present in CVT_Legacy as well)</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>minimal_pk <span class="ot">&lt;-</span> <span class="fu">pk</span>(<span class="at">data =</span> cvt <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>                   <span class="fu">mutate</span>(<span class="at">n_subjects_normalized =</span> <span class="fu">if_else</span>(</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>                     n_subjects_normalized <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(invivPK_conc_sd),</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>                     <span class="fu">min</span>(n_subjects_normalized, <span class="dv">6</span>), n_subjects_normalized)),</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>                 <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>                   <span class="at">Chemical =</span> analyte_dtxsid,</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>                   <span class="at">Chemical_Name =</span> analyte_name_original,</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>                   <span class="at">DTXSID =</span> analyte_dtxsid,</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>                   <span class="at">CASRN =</span> analyte_casrn,</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>                   <span class="at">Species =</span> species,</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>                   <span class="at">Reference =</span> fk_extraction_document_id,</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>                   <span class="at">Media =</span> conc_medium_normalized,</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>                   <span class="at">Route =</span> administration_route_normalized,</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>                   <span class="at">Dose =</span> invivPK_dose_level,</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>                   <span class="at">Dose.Units =</span> <span class="st">&quot;mg/kg&quot;</span>,</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>                   <span class="at">Subject_ID =</span> fk_subject_id,</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>                   <span class="at">Series_ID =</span> fk_series_id,</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>                   <span class="at">Study_ID =</span> fk_study_id,</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>                   <span class="at">ConcTime_ID =</span> conc_time_id,</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>                   <span class="at">N_Subjects =</span> n_subjects_normalized,</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>                   <span class="at">Weight =</span> weight_kg,</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>                   <span class="at">Weight.Units =</span> <span class="st">&quot;kg&quot;</span>,</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>                   <span class="at">Time =</span> time_hr,</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>                   <span class="at">Time.Units =</span> <span class="st">&quot;hours&quot;</span>,</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>                   <span class="at">Value =</span> invivPK_conc,</span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>                   <span class="at">Value.Units =</span> <span class="st">&quot;mg/L&quot;</span>,</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>                   <span class="at">Value_SD =</span> invivPK_conc_sd,</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>                   <span class="at">LOQ =</span> invivPK_loq</span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>                 ))</span></code></pre></div>
</div>
<div id="running-all-possible-fitting-options" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Running all possible
fitting options</h1>
<p>Here we setup the PK object with the various options for fitting and
data transformations. As shown in this vignette, it is possible to setup
multiple distinct options for fitting and data transformation at once
prior to processing and fitting the data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Types of Choices:</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="do">## Dose Normalized</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="do">## Log10 transform</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="do">## Scale time</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co"># List of options</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>fitopts <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">error_model =</span> <span class="fu">c</span>(<span class="st">&quot;pooled&quot;</span>,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>                                       <span class="st">&quot;hierarchical&quot;</span>),</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>                       <span class="at">dose_norm =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>                       <span class="at">log10_trans =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>                       <span class="at">time_scale =</span> <span class="fu">c</span>(</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>                         <span class="cn">TRUE</span>,</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>                         <span class="cn">FALSE</span>),</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>                       <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>fit_data <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                     this_dose_norm,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                     this_log10_trans,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                     this_time_scale,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>                     <span class="at">n_cores =</span> <span class="dv">12</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                     <span class="at">file_dir =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>)){</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  retval <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">9</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>   dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  </span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>                     time_indic,</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  </span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Fitting: &quot;</span>, file_str, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>  </span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    <span class="at">expr =</span> {</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>      this_pk <span class="ot">&lt;-</span>   minimal_pk <span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>        <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>        <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>                            <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>        <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> this_dose_norm, <span class="at">log10_trans =</span> this_log10_trans) <span class="sc">+</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>        <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>          <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>          <span class="st">&quot;bobyqa&quot;</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>          ))</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>      </span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>      <span class="cf">if</span>(this_error_model <span class="sc">%in%</span> <span class="st">&quot;pooled&quot;</span>){</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>        this_pk <span class="ot">&lt;-</span> this_pk <span class="sc">+</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>          <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(this_error_model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;hierarchical&quot;</span>, <span class="st">&quot;joint&quot;</span>)){</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>        this_pk <span class="ot">&lt;-</span> this_pk <span class="sc">+</span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>          <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;this_error_model must be either &#39;pooled&#39; or &#39;hierarchical&#39;/&#39;joint&#39;&quot;</span>)</span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>      }</span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>      </span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>      <span class="cf">if</span>(this_time_scale <span class="sc">%in%</span> <span class="cn">TRUE</span>){</span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>        this_pk <span class="ot">&lt;-</span> this_pk <span class="sc">+</span></span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>          <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>)</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>      }</span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a>      </span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a>      <span class="co">#do the fit</span></span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a>      this_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>(this_fit <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(this_pk, <span class="at">n_cores =</span> n_cores))</span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a>      </span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a>      </span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a>      </span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a>      <span class="co">#save the result</span></span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a>      <span class="fu">saveRDS</span>(this_fit,</span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a>              <span class="at">file =</span> <span class="fu">paste0</span>(file_dir,</span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a>                     file_str))</span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a>      </span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a>      cli<span class="sc">::</span><span class="fu">cli_alert_success</span>(<span class="at">text =</span> <span class="st">&quot;Fitting success!&quot;</span>)</span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a>      <span class="fu">print</span>(this_time)</span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a>      </span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a>      retval <span class="ot">&lt;-</span> this_time[[<span class="dv">3</span>]]</span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a>    },</span>
<span id="cb8-64"><a href="#cb8-64" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e){</span>
<span id="cb8-65"><a href="#cb8-65" tabindex="-1"></a>      cli<span class="sc">::</span><span class="fu">cli_alert_danger</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;Analysis&quot;</span>,</span>
<span id="cb8-66"><a href="#cb8-66" tabindex="-1"></a>                                         file_str,</span>
<span id="cb8-67"><a href="#cb8-67" tabindex="-1"></a>                                         <span class="st">&quot;failed with error&quot;</span>,</span>
<span id="cb8-68"><a href="#cb8-68" tabindex="-1"></a>                                         e))</span>
<span id="cb8-69"><a href="#cb8-69" tabindex="-1"></a>      retval <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb8-70"><a href="#cb8-70" tabindex="-1"></a>    }</span>
<span id="cb8-71"><a href="#cb8-71" tabindex="-1"></a>  )</span>
<span id="cb8-72"><a href="#cb8-72" tabindex="-1"></a>  </span>
<span id="cb8-73"><a href="#cb8-73" tabindex="-1"></a>  <span class="fu">return</span>(retval)</span>
<span id="cb8-74"><a href="#cb8-74" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">system.time</span>(tmp_out <span class="ot">&lt;-</span> <span class="fu">mapply</span>(fit_data,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                              <span class="at">this_error_model =</span> fitopts<span class="sc">$</span>error_model,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                              <span class="at">this_dose_norm =</span> fitopts<span class="sc">$</span>dose_norm,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>                              <span class="at">this_log10_trans =</span> fitopts<span class="sc">$</span>log10_trans,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                              <span class="at">this_time_scale =</span> fitopts<span class="sc">$</span>time_scale,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>                              <span class="at">n_cores =</span> <span class="dv">14</span>))</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="fu">mean</span>(tmp_out)<span class="sc">/</span><span class="dv">60</span> <span class="co"># Average runtime (in minutes) per fitting option</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="fu">median</span>(tmp_out)<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="fu">sum</span>(tmp_out) <span class="co"># Looks like there&#39;s 10 extra seconds of overhead for non-fitting methods</span></span></code></pre></div>
</div>
<div id="characterizing-the-data" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Characterizing the
data</h1>
<p>Load in one of the saved fit objects; it doesn’t matter which one,
since we will be using only the pre-processed data, which is the same
regardless of fitting options.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                        read_date_pk,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                        <span class="st">&quot;mypk_fit_110p.Rds&quot;</span>))</span></code></pre></div>
<p>Number of observations:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<p>Number of unique chemicals:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<p>Number of unique references:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">distinct</span>(Reference) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<p>Number of unique species:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">distinct</span>(Species) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<p>Number of unique combinations of Chemical and Species:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<p>Number of unique combinations of Chemical, Species, and
Reference:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species, Reference) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<p>Number of unique combinations of Chemical, Species, Reference, Route,
Media:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species, Reference, Route, Media) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<p>Number of unique combinations of Chemical, Species, Reference, Route,
Media, Dose:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species, Reference, Route, Media, Dose) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<div id="number-of-data-groups-with-both-blood-and-plasma-data-available" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Number of data groups
with both blood and plasma data available</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">blood_and_plasma =</span> <span class="fu">all</span>(<span class="fu">c</span>(<span class="st">&quot;blood&quot;</span>,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>                  <span class="st">&quot;plasma&quot;</span>) <span class="sc">%in%</span> Media)) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_both =</span> <span class="fu">sum</span>(blood_and_plasma))</span></code></pre></div>
</div>
<div id="number-of-data-groups-where-time-scaling-could-occur" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Number of data groups
where time scaling could occur</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">get_data</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">t_mid =</span> <span class="fu">mean</span>(<span class="fu">range</span>(Time)),</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    <span class="at">t_mid_log10 =</span> <span class="fu">midpt_log10</span>(Time),</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>            <span class="at">new_time_units =</span> <span class="fu">auto_units</span>(<span class="at">y =</span> Time,</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>                       <span class="at">from =</span> <span class="st">&quot;hours&quot;</span>,</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>                       <span class="at">target =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="fu">count</span>(new_time_units)</span></code></pre></div>
</div>
<div id="how-many-experiments-chemical-species-reference-route-media-were-flagged-for-potential-dose-dependence" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> How many experiments
(Chemical, Species, Reference, Route, Media) were flagged for potential
dose dependence?</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">get_data_info</span>(my_pk)<span class="sc">$</span>dose_norm_check <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">AUC_flag =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(data_flag_AUC)),</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>            <span class="at">Cmax_flag =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(data_flag_Cmax)),</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>            <span class="at">total_multi_dose =</span> <span class="fu">sum</span>(n_dose_groups<span class="sc">&gt;</span><span class="dv">1</span>),</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>            <span class="at">total_expts =</span> <span class="fu">n</span>())</span></code></pre></div>
</div>
<div id="evaluating-time-and-concentration-ranges" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Evaluating time and
concentration ranges</h2>
<p>Supp. Figure 2: Concentration and final time-points have wide ranges
across CvT datasets.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co">#compute duration and concentration range across experiments (Chemical, Species, Reference, Route, Media, Dose)</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>data_range <span class="ot">&lt;-</span> my_pk<span class="sc">$</span>data <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="fu">filter</span>(Detect, <span class="sc">!</span>exclude) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, Reference, Media, Route, Dose, Dose.Units) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">maxT =</span> <span class="fu">max</span>(Time)<span class="sc">/</span><span class="dv">24</span>,</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>         <span class="at">concRange =</span> <span class="fu">log10</span>(<span class="fu">max</span>(Conc)<span class="sc">/</span><span class="fu">min</span>(Conc))) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>   </span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="co">#Panel A: histogram of day of final timepoint per experiment  </span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>sf_2A <span class="ot">&lt;-</span> data_range <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> maxT)) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">40</span>,</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>number,</span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">30</span>, <span class="dv">365</span>)) <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a>  <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Day of final Timepoint&quot;</span>,</span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb22-27"><a href="#cb22-27" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" tabindex="-1"></a><span class="co">#panel B: histogram of fold concentration range</span></span>
<span id="cb22-29"><a href="#cb22-29" tabindex="-1"></a>sf_2B <span class="ot">&lt;-</span> data_range <span class="sc">%&gt;%</span></span>
<span id="cb22-30"><a href="#cb22-30" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> concRange)) <span class="sc">+</span></span>
<span id="cb22-31"><a href="#cb22-31" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb22-32"><a href="#cb22-32" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">40</span>,</span>
<span id="cb22-33"><a href="#cb22-33" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-34"><a href="#cb22-34" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb22-35"><a href="#cb22-35" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>),</span>
<span id="cb22-36"><a href="#cb22-36" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb22-37"><a href="#cb22-37" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log10(Concentration Range)&quot;</span>,</span>
<span id="cb22-38"><a href="#cb22-38" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-39"><a href="#cb22-39" tabindex="-1"></a>  <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-40"><a href="#cb22-40" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb22-41"><a href="#cb22-41" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb22-42"><a href="#cb22-42" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-43"><a href="#cb22-43" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb22-44"><a href="#cb22-44" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb22-45"><a href="#cb22-45" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb22-46"><a href="#cb22-46" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-47"><a href="#cb22-47" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-48"><a href="#cb22-48" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb22-49"><a href="#cb22-49" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span>
<span id="cb22-50"><a href="#cb22-50" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" tabindex="-1"></a>sf_2AB <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(sf_2A, sf_2B,</span>
<span id="cb22-52"><a href="#cb22-52" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), </span>
<span id="cb22-53"><a href="#cb22-53" tabindex="-1"></a>                    <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb22-54"><a href="#cb22-54" tabindex="-1"></a></span>
<span id="cb22-55"><a href="#cb22-55" tabindex="-1"></a>sf_2AB</span>
<span id="cb22-56"><a href="#cb22-56" tabindex="-1"></a></span>
<span id="cb22-57"><a href="#cb22-57" tabindex="-1"></a><span class="co">#save PDF version</span></span>
<span id="cb22-58"><a href="#cb22-58" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb22-59"><a href="#cb22-59" tabindex="-1"></a>              <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb22-60"><a href="#cb22-60" tabindex="-1"></a>              today,</span>
<span id="cb22-61"><a href="#cb22-61" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig2_ConcTimeRanges&quot;</span>,</span>
<span id="cb22-62"><a href="#cb22-62" tabindex="-1"></a>              <span class="st">&quot;.pdf&quot;</span>),</span>
<span id="cb22-63"><a href="#cb22-63" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.2</span>,</span>
<span id="cb22-64"><a href="#cb22-64" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb22-65"><a href="#cb22-65" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb22-66"><a href="#cb22-66" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb22-67"><a href="#cb22-67" tabindex="-1"></a></span>
<span id="cb22-68"><a href="#cb22-68" tabindex="-1"></a><span class="co">#save PNG version</span></span>
<span id="cb22-69"><a href="#cb22-69" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb22-70"><a href="#cb22-70" tabindex="-1"></a>              <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb22-71"><a href="#cb22-71" tabindex="-1"></a>              today,</span>
<span id="cb22-72"><a href="#cb22-72" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig2_ConcTimeRanges&quot;</span>,</span>
<span id="cb22-73"><a href="#cb22-73" tabindex="-1"></a>              <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb22-74"><a href="#cb22-74" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.2</span>,</span>
<span id="cb22-75"><a href="#cb22-75" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb22-76"><a href="#cb22-76" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb22-77"><a href="#cb22-77" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb22-78"><a href="#cb22-78" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb22-79"><a href="#cb22-79" tabindex="-1"></a></span>
<span id="cb22-80"><a href="#cb22-80" tabindex="-1"></a><span class="fu">rm</span>(sf_2A, sf_2B, sf_2AB)</span></code></pre></div>
</div>
<div id="evaluating-data-variability" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Evaluating data
variability</h2>
<div id="figure-3" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Figure 3</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>data_cvt <span class="ot">&lt;-</span> <span class="fu">get_data</span>(my_pk)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>data_counts <span class="ot">&lt;-</span> data_cvt <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(Detect) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(Chemical, Species, Reference, Route, Media, Dose, Time, N_Subjects,</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="at">name =</span> <span class="st">&quot;Count&quot;</span>)</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>data_counts <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(data_counts, data_cvt,</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Chemical&quot;</span>, <span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Reference&quot;</span>,</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="st">&quot;Route&quot;</span>, <span class="st">&quot;Media&quot;</span>, <span class="st">&quot;Dose&quot;</span>, <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="st">&quot;N_Subjects&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">data_descr =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>(Count <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> N_Subjects <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="st">&quot;Individual Data, Multiple Observations&quot;</span>,</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>(Count <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> N_Subjects <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> <span class="st">&quot;Individual Data, Single Observation&quot;</span>,</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>(Count <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> N_Subjects <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> Conc_SD <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">&quot;Grouped Data w SD&quot;</span>,</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>(N_Subjects <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> Conc_SD <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">&quot;Grouped Data no SD&quot;</span>,</span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="at">.default =</span> <span class="cn">NA_character_</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>))</span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a>indiv_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_counts,</span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>                     <span class="at">subset =</span> (data_descr <span class="sc">%in%</span> <span class="st">&quot;Individual Data, Multiple Observations&quot;</span>))</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>indiv_data <span class="ot">&lt;-</span> indiv_data <span class="sc">%&gt;%</span></span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(Chemical, Species, Reference, Route, Media, Dose, Time) <span class="sc">%&gt;%</span></span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">replicate_mean =</span> <span class="fu">mean</span>(Conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a>indiv_data_bygroup <span class="ot">&lt;-</span> indiv_data <span class="sc">%&gt;%</span></span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Chemical, Species) <span class="sc">%&gt;%</span></span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">AFE =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">mean</span>(<span class="fu">log10</span>(Conc<span class="sc">/</span>replicate_mean)),</span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a>                                                                                               <span class="at">AAFE =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">mean</span>(<span class="fu">abs</span>(<span class="fu">log10</span>(Conc<span class="sc">/</span>replicate_mean)))) <span class="sc">%&gt;%</span></span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a>indiv_data_bygroup <span class="sc">%&gt;%</span> <span class="fu">count</span>(AFE <span class="sc">&lt;</span> <span class="fl">0.5</span>)</span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a>indiv_data_bygroup <span class="sc">%&gt;%</span> <span class="fu">count</span>(AFE <span class="sc">&gt;</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Do twofold-test; use only the information about the observations at
this point (predictions will be handled later).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>my_tf <span class="ot">&lt;-</span> my_pk <span class="sc">%&gt;%</span> <span class="fu">twofold_test</span>()</span></code></pre></div>
<p>Figure 3 Panel A: Histogram of mean-normalized concentrations</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>pl3A <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>individual_data <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="co"># Plotting</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> foldConc)) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">3.1</span>),</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>)) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">750</span>, <span class="dv">1000</span>),</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;2.5&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;7.5&quot;</span>, <span class="st">&quot;10&quot;</span>)) <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>),</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>,</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Mean-normalized concentration&quot;</span>,</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>                <span class="at">y =</span> <span class="st">&quot;Observations (hundreds))&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>pl3A</span></code></pre></div>
<p>Figure 3 Panel B: Plot of mean-normalized concentrations
vs. ADME-Normalized Time</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co">#get time of peak concentration for use in calculated ADME-normalized time</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>my_nca <span class="ot">&lt;-</span> <span class="fu">nca</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(param_name <span class="sc">%in%</span> <span class="st">&quot;tmax&quot;</span>)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>pl3B <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>individual_data <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>  <span class="fu">inner_join</span>(my_nca <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Species,</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>                            Route, Media,</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>                            <span class="at">tmax =</span> param_value) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tmax))) <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>           Species,</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>           Reference,</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>           Route,</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>           Media,</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>           Dose) <span class="sc">%&gt;%</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>         <span class="at">normTime =</span> <span class="fu">ifelse</span>(</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>           Route <span class="sc">==</span> <span class="st">&quot;iv&quot;</span>,</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>           <span class="dv">1</span> <span class="sc">+</span> Time<span class="sc">/</span><span class="fu">max</span>(Time),</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>           <span class="fu">ifelse</span>(</span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a>             Time <span class="sc">&gt;</span> tmax,</span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>             ((Time <span class="sc">-</span> tmax)<span class="sc">/</span><span class="fu">max</span>(Time)) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>             <span class="fl">0.5</span> <span class="sc">+</span> Time<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>tmax)</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>           )</span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span></span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a>    <span class="at">x =</span> normTime,</span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a>    <span class="at">y =</span> foldConc</span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;tmax&quot;</span>, <span class="st">&quot;end&quot;</span>)) <span class="sc">+</span></span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>),</span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>,</span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb26-37"><a href="#cb26-37" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-38"><a href="#cb26-38" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Route),</span>
<span id="cb26-39"><a href="#cb26-39" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-40"><a href="#cb26-40" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;ADME-Normalized Time&quot;</span>,</span>
<span id="cb26-41"><a href="#cb26-41" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Mean-Normalized</span><span class="sc">\n</span><span class="st">Concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-42"><a href="#cb26-42" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb26-43"><a href="#cb26-43" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb26-44"><a href="#cb26-44" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-45"><a href="#cb26-45" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb26-46"><a href="#cb26-46" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb26-47"><a href="#cb26-47" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb26-48"><a href="#cb26-48" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-49"><a href="#cb26-49" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb26-50"><a href="#cb26-50" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb26-51"><a href="#cb26-51" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.125</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>),</span>
<span id="cb26-52"><a href="#cb26-52" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-53"><a href="#cb26-53" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb26-54"><a href="#cb26-54" tabindex="-1"></a></span>
<span id="cb26-55"><a href="#cb26-55" tabindex="-1"></a>pl3B</span></code></pre></div>
<p>Paste these two plots together</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>pl3 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(pl3A,</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>                          pl3B,</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>                          <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>                          <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co">#save PDF version</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>              today,</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>                <span class="st">&quot;_Fig3.pdf&quot;</span>),</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>      pl3,</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>          <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>      <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>      <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a><span class="co">#Save PNG version</span></span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a>              today,</span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>                <span class="st">&quot;_Fig3.png&quot;</span>),</span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>      pl3,</span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a>          <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a>      <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>      <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a>      <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a><span class="co">#remove unneeded objects</span></span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a><span class="fu">rm</span>(pl3A, pl3B, pl3)</span></code></pre></div>
</div>
<div id="supplemental-figure-3-histogram-of-data-variability-by-time" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Supplemental Figure
3: Histogram of data variability by time</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>plsupp3 <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>individual_data <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  <span class="fu">inner_join</span>(my_nca <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Species,</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>                            Route, Media,</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>                            <span class="at">tmax =</span> param_value) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tmax))) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>           Species,</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>           Reference,</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>           Route,</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>           Media,</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>           Dose) <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>         <span class="at">normTime =</span> <span class="fu">ifelse</span>(</span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>           Route <span class="sc">==</span> <span class="st">&quot;iv&quot;</span>,</span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>           <span class="dv">1</span> <span class="sc">+</span> Time<span class="sc">/</span><span class="fu">max</span>(Time),</span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>           <span class="fu">ifelse</span>(</span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>             Time <span class="sc">&gt;</span> tmax,</span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>             ((Time <span class="sc">-</span> tmax)<span class="sc">/</span><span class="fu">max</span>(Time)) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>             <span class="fl">0.5</span> <span class="sc">+</span> Time<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>tmax)</span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>           )</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span></span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a>    <span class="at">x =</span> normTime</span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;tmax&quot;</span>, <span class="st">&quot;end&quot;</span>)) <span class="sc">+</span></span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Route),</span>
<span id="cb28-30"><a href="#cb28-30" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-31"><a href="#cb28-31" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;ADME-Normalized Time&quot;</span>,</span>
<span id="cb28-32"><a href="#cb28-32" tabindex="-1"></a>       <span class="st">&quot;# Observations&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-33"><a href="#cb28-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb28-34"><a href="#cb28-34" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb28-35"><a href="#cb28-35" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-36"><a href="#cb28-36" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb28-37"><a href="#cb28-37" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb28-38"><a href="#cb28-38" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb28-39"><a href="#cb28-39" tabindex="-1"></a>        <span class="co">#axis.ticks = element_blank(),</span></span>
<span id="cb28-40"><a href="#cb28-40" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-41"><a href="#cb28-41" tabindex="-1"></a>        <span class="co">#axis.text.x = element_blank(),</span></span>
<span id="cb28-42"><a href="#cb28-42" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb28-43"><a href="#cb28-43" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb28-44"><a href="#cb28-44" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.125</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>),</span>
<span id="cb28-45"><a href="#cb28-45" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-46"><a href="#cb28-46" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb28-47"><a href="#cb28-47" tabindex="-1"></a></span>
<span id="cb28-48"><a href="#cb28-48" tabindex="-1"></a><span class="co">#save PDF version</span></span>
<span id="cb28-49"><a href="#cb28-49" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb28-50"><a href="#cb28-50" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb28-51"><a href="#cb28-51" tabindex="-1"></a>              today,</span>
<span id="cb28-52"><a href="#cb28-52" tabindex="-1"></a>                <span class="st">&quot;_Supp_Fig3&quot;</span>,</span>
<span id="cb28-53"><a href="#cb28-53" tabindex="-1"></a>                <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb28-54"><a href="#cb28-54" tabindex="-1"></a>      plsupp3,</span>
<span id="cb28-55"><a href="#cb28-55" tabindex="-1"></a>          <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb28-56"><a href="#cb28-56" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb28-57"><a href="#cb28-57" tabindex="-1"></a>      <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb28-58"><a href="#cb28-58" tabindex="-1"></a>      <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb28-59"><a href="#cb28-59" tabindex="-1"></a>      <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb28-60"><a href="#cb28-60" tabindex="-1"></a></span>
<span id="cb28-61"><a href="#cb28-61" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb28-62"><a href="#cb28-62" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb28-63"><a href="#cb28-63" tabindex="-1"></a>              today,</span>
<span id="cb28-64"><a href="#cb28-64" tabindex="-1"></a>                <span class="st">&quot;_Supp_Fig3&quot;</span>,</span>
<span id="cb28-65"><a href="#cb28-65" tabindex="-1"></a>                <span class="st">&quot;.pdf&quot;</span>),</span>
<span id="cb28-66"><a href="#cb28-66" tabindex="-1"></a>      plsupp3,</span>
<span id="cb28-67"><a href="#cb28-67" tabindex="-1"></a>          <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb28-68"><a href="#cb28-68" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb28-69"><a href="#cb28-69" tabindex="-1"></a>      <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb28-70"><a href="#cb28-70" tabindex="-1"></a>      <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="evaluating-fitting-options" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Evaluating fitting
options</h1>
<p>Here we evaluate the various fitting options by:</p>
<ul>
<li>Counting the number of 1-, 2-compartment and flat model fits that
had lowest AIC (winning model).<br />
</li>
<li>Summarizing the root mean squared log10 error between model fit and
NCA approximation of:
<ul>
<li>Cmax</li>
<li>AUC_infinity</li>
<li>(Counts and filters extreme values of log10(model/NCA) &gt;
log10(20) for AUC_infinity)<br />
</li>
<li>(Counts and filters non-finite and zero values of AUC_infinity)</li>
</ul></li>
<li>A summary goodness-of-fit table for each data group’s winning model
and fitting options that includes:
<ul>
<li>R-squared<br />
</li>
<li>RMSLE<br />
</li>
<li>AIC<br />
</li>
</ul></li>
<li>All predictions for each data group and fitting option (winning
models only)<br />
</li>
<li>Model errors within a factor of two for each fitting option</li>
</ul>
<p>Define some helper functions to do the various model evaluations.</p>
<div id="winning-model-tally" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Winning model
tally</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># Evaluation</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="co"># Winning Model Tally</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>winmodel_comparison <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>  </span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>                     time_indic,</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a>  </span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a>  </span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a>  <span class="co"># Wide winning model</span></span>
<span id="cb29-25"><a href="#cb29-25" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb29-26"><a href="#cb29-26" tabindex="-1"></a>    winning_model <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(<span class="at">obj =</span> current_rds) </span>
<span id="cb29-27"><a href="#cb29-27" tabindex="-1"></a>    </span>
<span id="cb29-28"><a href="#cb29-28" tabindex="-1"></a>    wide_winning_model <span class="ot">&lt;-</span> winning_model <span class="sc">%&gt;%</span></span>
<span id="cb29-29"><a href="#cb29-29" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(method, model) <span class="sc">%&gt;%</span></span>
<span id="cb29-30"><a href="#cb29-30" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-31"><a href="#cb29-31" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> model,</span>
<span id="cb29-32"><a href="#cb29-32" tabindex="-1"></a>                         <span class="at">values_from =</span> n)</span>
<span id="cb29-33"><a href="#cb29-33" tabindex="-1"></a>  })</span>
<span id="cb29-34"><a href="#cb29-34" tabindex="-1"></a>  <span class="fu">return</span>(wide_winning_model)</span>
<span id="cb29-35"><a href="#cb29-35" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="rmsle-for-cmax-and-auc-with-some-tallys-for-extreme-values" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> RMSLE for Cmax and
AUC (with some tallys for extreme values)</h2>
<p>First we need to determine how to filter out cases where NCA or
tkstats predicted ridiculously large AUCs. To do this, create a function
to plot <span class="math inline">\(AUC_{\infty}\)</span> predicted by
the model vs. <span class="math inline">\(AUC_{\infty}\)</span>
estimated by NCA, for each set of fitting options. Show the identity
line, and also show lines for a factor of 20 above and below the
identity line, since a 20-fold cutoff is one proposed cutoff. Do the
same for Cmax, as well.</p>
<div id="auc_inf-and-cmax-comparison" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> AUC_inf and Cmax
comparison</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>AUC_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>    this_error_model,</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>    this_dose_norm,</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>    this_log10_trans,</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>    this_time_scale) {</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>  </span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>                     time_indic,</span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a>  </span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;Evaluation for: &quot;</span>, pk_name))</span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a>  <span class="co"># Cmax and AUC_inf RMSEs</span></span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a>  <span class="co">#note that eval_tkstats already filters winning models</span></span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a>  <span class="co">#use finite_only = FALSE so that we can count the excluded cases</span></span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(RMSLE_eval <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(<span class="at">obj =</span> current_rds, </span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a>                                             <span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a>                                             <span class="at">finite_only =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a>                                             <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a>                                  <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name) <span class="sc">%&gt;%</span></span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a>                                  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a>                                    Options,</span>
<span id="cb30-33"><a href="#cb30-33" tabindex="-1"></a>                                    Chemical,</span>
<span id="cb30-34"><a href="#cb30-34" tabindex="-1"></a>                                    Species,</span>
<span id="cb30-35"><a href="#cb30-35" tabindex="-1"></a>                                    Route,</span>
<span id="cb30-36"><a href="#cb30-36" tabindex="-1"></a>                                    Media,</span>
<span id="cb30-37"><a href="#cb30-37" tabindex="-1"></a>                                    Reference,</span>
<span id="cb30-38"><a href="#cb30-38" tabindex="-1"></a>                                    method,</span>
<span id="cb30-39"><a href="#cb30-39" tabindex="-1"></a>                                    model,</span>
<span id="cb30-40"><a href="#cb30-40" tabindex="-1"></a>                                    <span class="fu">starts_with</span>(<span class="st">&quot;Cmax&quot;</span>),</span>
<span id="cb30-41"><a href="#cb30-41" tabindex="-1"></a>                                    <span class="fu">starts_with</span>(<span class="st">&quot;AUC_&quot;</span>)</span>
<span id="cb30-42"><a href="#cb30-42" tabindex="-1"></a>                                  ))</span>
<span id="cb30-43"><a href="#cb30-43" tabindex="-1"></a>  </span>
<span id="cb30-44"><a href="#cb30-44" tabindex="-1"></a> these_opts <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic,</span>
<span id="cb30-45"><a href="#cb30-45" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb30-46"><a href="#cb30-46" tabindex="-1"></a>                     time_indic,</span>
<span id="cb30-47"><a href="#cb30-47" tabindex="-1"></a>                     errmodel_indic)</span>
<span id="cb30-48"><a href="#cb30-48" tabindex="-1"></a>  </span>
<span id="cb30-49"><a href="#cb30-49" tabindex="-1"></a>  <span class="co">#plot AUC infinity for tkstats vs. AUC infinity for NCA</span></span>
<span id="cb30-50"><a href="#cb30-50" tabindex="-1"></a>   <span class="co">#show identity line and 20x above and below lines</span></span>
<span id="cb30-51"><a href="#cb30-51" tabindex="-1"></a> AUC_plot <span class="ot">&lt;-</span> RMSLE_eval <span class="sc">%&gt;%</span></span>
<span id="cb30-52"><a href="#cb30-52" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.finite</span>(AUC_infinity.nca) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(AUC_infinity.tkstats)) <span class="sc">%&gt;%</span></span>
<span id="cb30-53"><a href="#cb30-53" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-54"><a href="#cb30-54" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> AUC_infinity.nca,</span>
<span id="cb30-55"><a href="#cb30-55" tabindex="-1"></a>                   <span class="at">y =</span> AUC_infinity.tkstats,</span>
<span id="cb30-56"><a href="#cb30-56" tabindex="-1"></a>                   <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb30-57"><a href="#cb30-57" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span> <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb30-58"><a href="#cb30-58" tabindex="-1"></a>    <span class="fu">annotation_logticks</span>() <span class="sc">+</span></span>
<span id="cb30-59"><a href="#cb30-59" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb30-60"><a href="#cb30-60" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fu">log10</span>(<span class="dv">20</span>), <span class="at">slope =</span> <span class="dv">1</span>),</span>
<span id="cb30-61"><a href="#cb30-61" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb30-62"><a href="#cb30-62" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fu">log10</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>), <span class="at">slope =</span> <span class="dv">1</span>),</span>
<span id="cb30-63"><a href="#cb30-63" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb30-64"><a href="#cb30-64" tabindex="-1"></a>      <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(method)) <span class="sc">+</span></span>
<span id="cb30-65"><a href="#cb30-65" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(these_opts,</span>
<span id="cb30-66"><a href="#cb30-66" tabindex="-1"></a>                    <span class="st">&quot;AUC_inf pred vs. AUC_inf NCA&quot;</span>)) <span class="sc">+</span></span>
<span id="cb30-67"><a href="#cb30-67" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;model_1comp&quot;</span> <span class="ot">=</span> <span class="st">&quot;#0398FC&quot;</span>,</span>
<span id="cb30-68"><a href="#cb30-68" tabindex="-1"></a>                                 <span class="st">&quot;model_2comp&quot;</span> <span class="ot">=</span> <span class="st">&quot;#D68E09&quot;</span>,</span>
<span id="cb30-69"><a href="#cb30-69" tabindex="-1"></a>                               <span class="st">&quot;model_flat&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb30-70"><a href="#cb30-70" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Winning model&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-71"><a href="#cb30-71" tabindex="-1"></a>      <span class="fu">coord_equal</span>()</span>
<span id="cb30-72"><a href="#cb30-72" tabindex="-1"></a> </span>
<span id="cb30-73"><a href="#cb30-73" tabindex="-1"></a> Cmax_plot <span class="ot">&lt;-</span> RMSLE_eval <span class="sc">%&gt;%</span></span>
<span id="cb30-74"><a href="#cb30-74" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.finite</span>(Cmax.nca) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(Cmax.tkstats)) <span class="sc">%&gt;%</span></span>
<span id="cb30-75"><a href="#cb30-75" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-76"><a href="#cb30-76" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Cmax.nca,</span>
<span id="cb30-77"><a href="#cb30-77" tabindex="-1"></a>                   <span class="at">y =</span> Cmax.tkstats,</span>
<span id="cb30-78"><a href="#cb30-78" tabindex="-1"></a>                   <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb30-79"><a href="#cb30-79" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span> <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb30-80"><a href="#cb30-80" tabindex="-1"></a>    <span class="fu">annotation_logticks</span>() <span class="sc">+</span></span>
<span id="cb30-81"><a href="#cb30-81" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb30-82"><a href="#cb30-82" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fu">log10</span>(<span class="dv">20</span>), <span class="at">slope =</span> <span class="dv">1</span>),</span>
<span id="cb30-83"><a href="#cb30-83" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb30-84"><a href="#cb30-84" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="fu">log10</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>), <span class="at">slope =</span> <span class="dv">1</span>),</span>
<span id="cb30-85"><a href="#cb30-85" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb30-86"><a href="#cb30-86" tabindex="-1"></a>      <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(method)) <span class="sc">+</span></span>
<span id="cb30-87"><a href="#cb30-87" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(these_opts,</span>
<span id="cb30-88"><a href="#cb30-88" tabindex="-1"></a>                    <span class="st">&quot;Cmax pred vs. Cmax NCA&quot;</span>)) <span class="sc">+</span></span>
<span id="cb30-89"><a href="#cb30-89" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;model_1comp&quot;</span> <span class="ot">=</span> <span class="st">&quot;#0398FC&quot;</span>,</span>
<span id="cb30-90"><a href="#cb30-90" tabindex="-1"></a>                                 <span class="st">&quot;model_2comp&quot;</span> <span class="ot">=</span> <span class="st">&quot;#D68E09&quot;</span>,</span>
<span id="cb30-91"><a href="#cb30-91" tabindex="-1"></a>                               <span class="st">&quot;model_flat&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb30-92"><a href="#cb30-92" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Winning model&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-93"><a href="#cb30-93" tabindex="-1"></a>      <span class="fu">coord_equal</span>()</span>
<span id="cb30-94"><a href="#cb30-94" tabindex="-1"></a></span>
<span id="cb30-95"><a href="#cb30-95" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb30-96"><a href="#cb30-96" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">AUC_plot =</span> AUC_plot,</span>
<span id="cb30-97"><a href="#cb30-97" tabindex="-1"></a>    <span class="at">Cmax_plot =</span> Cmax_plot</span>
<span id="cb30-98"><a href="#cb30-98" tabindex="-1"></a>    )</span>
<span id="cb30-99"><a href="#cb30-99" tabindex="-1"></a>  )</span>
<span id="cb30-100"><a href="#cb30-100" tabindex="-1"></a>}</span></code></pre></div>
<p>Run these plots for all fitting opts</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>all_AUC_plots <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">this_plot =</span> <span class="fu">list</span>(<span class="fu">AUC_plot</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale)</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>                                 )</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>                   )</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="co">#save the plots</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>  <span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>  today,</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>  <span class="st">&quot;_AUCinf_nca_vs_tk_plots.pdf&quot;</span>),</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  <span class="at">onefile =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7</span>)</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>plotlist <span class="ot">&lt;-</span> all_AUC_plots <span class="sc">%&gt;%</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>  <span class="fu">pull</span>(this_plot)</span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="fu">seq_along</span>(plotlist)) {</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a>  <span class="fu">print</span>(plotlist[[x]][[<span class="st">&quot;AUC_plot&quot;</span>]])</span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>}</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(</span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a>  <span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a>  today,</span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a>  <span class="st">&quot;_Cmax_nca_vs_tk_plots.pdf&quot;</span>),</span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a>  <span class="at">onefile =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7</span>)</span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a>plotlist <span class="ot">&lt;-</span> all_AUC_plots <span class="sc">%&gt;%</span></span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a>  <span class="fu">pull</span>(this_plot)</span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="fu">seq_along</span>(plotlist)) {</span>
<span id="cb31-38"><a href="#cb31-38" tabindex="-1"></a>  <span class="fu">print</span>(plotlist[[x]][[<span class="st">&quot;Cmax_plot&quot;</span>]])</span>
<span id="cb31-39"><a href="#cb31-39" tabindex="-1"></a>}</span>
<span id="cb31-40"><a href="#cb31-40" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb31-41"><a href="#cb31-41" tabindex="-1"></a></span>
<span id="cb31-42"><a href="#cb31-42" tabindex="-1"></a><span class="fu">rm</span>(plotlist, all_AUC_plots)</span></code></pre></div>
<p>It appears that the best filter, other than filtering out NA, Inf,
zero, and negative values, would be to filter out any AUC_inf values
greater than 1e7, since that cutoff identifies outliers.</p>
<p>Write the function for RMSLE for Cmax and AUC accordingly.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="co"># RMSLE for Cmax and AUC</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>rmsles_Cmax_AUC <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>    this_error_model,</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>    this_dose_norm,</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>    this_log10_trans,</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>    this_time_scale) {</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>  </span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a>                     time_indic,</span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb32-21"><a href="#cb32-21" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb32-22"><a href="#cb32-22" tabindex="-1"></a>  </span>
<span id="cb32-23"><a href="#cb32-23" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;Evaluation for: &quot;</span>, pk_name))</span>
<span id="cb32-24"><a href="#cb32-24" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb32-25"><a href="#cb32-25" tabindex="-1"></a>  <span class="co"># Cmax and AUC_inf RMSEs</span></span>
<span id="cb32-26"><a href="#cb32-26" tabindex="-1"></a>  <span class="co">#note that eval_tkstats already filters winning models</span></span>
<span id="cb32-27"><a href="#cb32-27" tabindex="-1"></a>  <span class="co">#use finite_only = FALSE so that we can count the excluded cases</span></span>
<span id="cb32-28"><a href="#cb32-28" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(RMSLE_eval <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(<span class="at">obj =</span> current_rds, </span>
<span id="cb32-29"><a href="#cb32-29" tabindex="-1"></a>                                             <span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-30"><a href="#cb32-30" tabindex="-1"></a>                                             <span class="at">finite_only =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-31"><a href="#cb32-31" tabindex="-1"></a>                                             <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-32"><a href="#cb32-32" tabindex="-1"></a>                                  <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name) <span class="sc">%&gt;%</span></span>
<span id="cb32-33"><a href="#cb32-33" tabindex="-1"></a>                                  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb32-34"><a href="#cb32-34" tabindex="-1"></a>                                    Options,</span>
<span id="cb32-35"><a href="#cb32-35" tabindex="-1"></a>                                    Chemical,</span>
<span id="cb32-36"><a href="#cb32-36" tabindex="-1"></a>                                    Species,</span>
<span id="cb32-37"><a href="#cb32-37" tabindex="-1"></a>                                    Route,</span>
<span id="cb32-38"><a href="#cb32-38" tabindex="-1"></a>                                    Media,</span>
<span id="cb32-39"><a href="#cb32-39" tabindex="-1"></a>                                    Reference,</span>
<span id="cb32-40"><a href="#cb32-40" tabindex="-1"></a>                                    method,</span>
<span id="cb32-41"><a href="#cb32-41" tabindex="-1"></a>                                    model,</span>
<span id="cb32-42"><a href="#cb32-42" tabindex="-1"></a>                                    <span class="fu">starts_with</span>(<span class="st">&quot;Cmax&quot;</span>),</span>
<span id="cb32-43"><a href="#cb32-43" tabindex="-1"></a>                                    <span class="fu">starts_with</span>(<span class="st">&quot;AUC_&quot;</span>)</span>
<span id="cb32-44"><a href="#cb32-44" tabindex="-1"></a>                                  ))</span>
<span id="cb32-45"><a href="#cb32-45" tabindex="-1"></a> </span>
<span id="cb32-46"><a href="#cb32-46" tabindex="-1"></a>  <span class="co">#Couunt bad observations:</span></span>
<span id="cb32-47"><a href="#cb32-47" tabindex="-1"></a>  <span class="co">#zero, NA, infinite</span></span>
<span id="cb32-48"><a href="#cb32-48" tabindex="-1"></a>  RMSLE_badobs <span class="ot">&lt;-</span> RMSLE_eval <span class="sc">%&gt;%</span> </span>
<span id="cb32-49"><a href="#cb32-49" tabindex="-1"></a>    <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb32-50"><a href="#cb32-50" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">total_expts =</span> <span class="fu">n</span>(),</span>
<span id="cb32-51"><a href="#cb32-51" tabindex="-1"></a>              <span class="at">count_AUCinf_NCA_0 =</span> <span class="fu">sum</span>(AUC_infinity.nca <span class="sc">%in%</span> <span class="dv">0</span>),</span>
<span id="cb32-52"><a href="#cb32-52" tabindex="-1"></a>              <span class="at">count_AUCinf_pred_0 =</span> <span class="fu">sum</span>(AUC_infinity.tkstats <span class="sc">%in%</span> <span class="dv">0</span>),</span>
<span id="cb32-53"><a href="#cb32-53" tabindex="-1"></a>              <span class="at">count_AUCinf_NCA_isNA =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(AUC_infinity.nca)),</span>
<span id="cb32-54"><a href="#cb32-54" tabindex="-1"></a>              <span class="at">count_AUCinf_pred_isNA =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(AUC_infinity.tkstats)),</span>
<span id="cb32-55"><a href="#cb32-55" tabindex="-1"></a>              <span class="at">count_AUCinf_NCA_isInf =</span> <span class="fu">sum</span>(<span class="fu">is.infinite</span>(AUC_infinity.nca)),</span>
<span id="cb32-56"><a href="#cb32-56" tabindex="-1"></a>              <span class="at">count_AUCinf_pred_isInf =</span> <span class="fu">sum</span>(<span class="fu">is.infinite</span>(AUC_infinity.tkstats)),</span>
<span id="cb32-57"><a href="#cb32-57" tabindex="-1"></a>             <span class="at">count_Cmax_NCA_0 =</span> <span class="fu">sum</span>(Cmax.nca <span class="sc">%in%</span> <span class="dv">0</span>),</span>
<span id="cb32-58"><a href="#cb32-58" tabindex="-1"></a>              <span class="at">count_Cmax_pred_0 =</span> <span class="fu">sum</span>(Cmax.tkstats <span class="sc">%in%</span> <span class="dv">0</span>),</span>
<span id="cb32-59"><a href="#cb32-59" tabindex="-1"></a>              <span class="at">count_Cmax_NCA_isNA =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Cmax.nca)),</span>
<span id="cb32-60"><a href="#cb32-60" tabindex="-1"></a>              <span class="at">count_Cmax_pred_isNA =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Cmax.tkstats)),</span>
<span id="cb32-61"><a href="#cb32-61" tabindex="-1"></a>              <span class="at">count_Cmax_NCA_isInf =</span> <span class="fu">sum</span>(<span class="fu">is.infinite</span>(Cmax.nca)),</span>
<span id="cb32-62"><a href="#cb32-62" tabindex="-1"></a>              <span class="at">count_Cmax_pred_isInf =</span> <span class="fu">sum</span>(<span class="fu">is.infinite</span>(Cmax.tkstats))</span>
<span id="cb32-63"><a href="#cb32-63" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb32-64"><a href="#cb32-64" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb32-65"><a href="#cb32-65" tabindex="-1"></a>  </span>
<span id="cb32-66"><a href="#cb32-66" tabindex="-1"></a>  <span class="co">#count cases where AUC or Cmax was negative,</span></span>
<span id="cb32-67"><a href="#cb32-67" tabindex="-1"></a>  <span class="co">#or where AUC_inf was greater than 1e7</span></span>
<span id="cb32-68"><a href="#cb32-68" tabindex="-1"></a>  RMSLE_neg <span class="ot">&lt;-</span> RMSLE_eval <span class="sc">%&gt;%</span></span>
<span id="cb32-69"><a href="#cb32-69" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.finite</span>(AUC_infinity.nca),</span>
<span id="cb32-70"><a href="#cb32-70" tabindex="-1"></a>                            <span class="fu">is.finite</span>(AUC_infinity.tkstats),</span>
<span id="cb32-71"><a href="#cb32-71" tabindex="-1"></a>                            <span class="fu">is.finite</span>(Cmax.nca),</span>
<span id="cb32-72"><a href="#cb32-72" tabindex="-1"></a>                            <span class="fu">is.finite</span>(Cmax.tkstats)) <span class="sc">%&gt;%</span></span>
<span id="cb32-73"><a href="#cb32-73" tabindex="-1"></a>    <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb32-74"><a href="#cb32-74" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">count_AUCinf_NCA_lt0 =</span> <span class="fu">sum</span>(AUC_infinity.nca <span class="sc">&lt;</span> <span class="dv">0</span>),</span>
<span id="cb32-75"><a href="#cb32-75" tabindex="-1"></a>              <span class="at">count_AUCinf_pred_lt0 =</span> <span class="fu">sum</span>(AUC_infinity.tkstats <span class="sc">&lt;</span> <span class="dv">0</span>),</span>
<span id="cb32-76"><a href="#cb32-76" tabindex="-1"></a>              <span class="at">count_Cmax_NCA_lt0 =</span> <span class="fu">sum</span>(AUC_infinity.nca <span class="sc">&lt;</span> <span class="dv">0</span>),</span>
<span id="cb32-77"><a href="#cb32-77" tabindex="-1"></a>              <span class="at">count_Cmax_pred_lt0 =</span> <span class="fu">sum</span>(AUC_infinity.tkstats <span class="sc">&lt;</span> <span class="dv">0</span>),</span>
<span id="cb32-78"><a href="#cb32-78" tabindex="-1"></a>              <span class="at">count_AUCinf_NCA_gt_1e7 =</span> <span class="fu">sum</span>(AUC_infinity.nca <span class="sc">&gt;</span> <span class="fl">1e7</span>),</span>
<span id="cb32-79"><a href="#cb32-79" tabindex="-1"></a>               <span class="at">count_AUCinf_pred_gt_1e7 =</span> <span class="fu">sum</span>(AUC_infinity.tkstats <span class="sc">&gt;</span> <span class="fl">1e7</span>),</span>
<span id="cb32-80"><a href="#cb32-80" tabindex="-1"></a>       )</span>
<span id="cb32-81"><a href="#cb32-81" tabindex="-1"></a>  </span>
<span id="cb32-82"><a href="#cb32-82" tabindex="-1"></a>  RMSLE_badobs <span class="ot">&lt;-</span> RMSLE_badobs <span class="sc">%&gt;%</span></span>
<span id="cb32-83"><a href="#cb32-83" tabindex="-1"></a>    <span class="fu">left_join</span>(RMSLE_neg, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Options&quot;</span>,</span>
<span id="cb32-84"><a href="#cb32-84" tabindex="-1"></a>                                    <span class="st">&quot;method&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-85"><a href="#cb32-85" tabindex="-1"></a>        <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-86"><a href="#cb32-86" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">total_excl =</span> <span class="fu">sum</span>(</span>
<span id="cb32-87"><a href="#cb32-87" tabindex="-1"></a>      <span class="fu">c_across</span>(</span>
<span id="cb32-88"><a href="#cb32-88" tabindex="-1"></a>      <span class="fu">starts_with</span>(<span class="st">&quot;count&quot;</span>)</span>
<span id="cb32-89"><a href="#cb32-89" tabindex="-1"></a>      )</span>
<span id="cb32-90"><a href="#cb32-90" tabindex="-1"></a>      )</span>
<span id="cb32-91"><a href="#cb32-91" tabindex="-1"></a>    )</span>
<span id="cb32-92"><a href="#cb32-92" tabindex="-1"></a>  </span>
<span id="cb32-93"><a href="#cb32-93" tabindex="-1"></a>  <span class="co">#compute RMSLEs after excluding the bad observations</span></span>
<span id="cb32-94"><a href="#cb32-94" tabindex="-1"></a>  RMSLE_eval <span class="ot">&lt;-</span> RMSLE_eval <span class="sc">%&gt;%</span></span>
<span id="cb32-95"><a href="#cb32-95" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.finite</span>(AUC_infinity.nca),</span>
<span id="cb32-96"><a href="#cb32-96" tabindex="-1"></a>           <span class="fu">is.finite</span>(AUC_infinity.tkstats)) <span class="sc">%&gt;%</span></span>
<span id="cb32-97"><a href="#cb32-97" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb32-98"><a href="#cb32-98" tabindex="-1"></a>      AUC_infinity.nca <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb32-99"><a href="#cb32-99" tabindex="-1"></a>      AUC_infinity.tkstats <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb32-100"><a href="#cb32-100" tabindex="-1"></a>      AUC_infinity.nca <span class="sc">&lt;</span> <span class="fl">1e7</span>,</span>
<span id="cb32-101"><a href="#cb32-101" tabindex="-1"></a>      AUC_infinity.tkstats <span class="sc">&lt;</span> <span class="fl">1e7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-102"><a href="#cb32-102" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-103"><a href="#cb32-103" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb32-104"><a href="#cb32-104" tabindex="-1"></a>      <span class="at">SLE_Cmax =</span> (<span class="fu">log10</span>(Cmax.tkstats) <span class="sc">-</span> <span class="fu">log10</span>(Cmax.nca)) <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb32-105"><a href="#cb32-105" tabindex="-1"></a>      <span class="at">SLE_AUC_inf =</span> (<span class="fu">log10</span>(AUC_infinity.tkstats) <span class="sc">-</span> <span class="fu">log10</span>(AUC_infinity.nca)) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb32-106"><a href="#cb32-106" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb32-107"><a href="#cb32-107" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SLE_Cmax), <span class="sc">!</span><span class="fu">is.na</span>(SLE_AUC_inf)) <span class="sc">%&gt;%</span></span>
<span id="cb32-108"><a href="#cb32-108" tabindex="-1"></a>    <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb32-109"><a href="#cb32-109" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb32-110"><a href="#cb32-110" tabindex="-1"></a>      <span class="at">n_expts =</span> <span class="fu">n</span>(),</span>
<span id="cb32-111"><a href="#cb32-111" tabindex="-1"></a>      <span class="at">RMSLE_Cmax =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(SLE_Cmax, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>),</span>
<span id="cb32-112"><a href="#cb32-112" tabindex="-1"></a>      <span class="at">RMSLE_AUC =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(SLE_AUC_inf, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb32-113"><a href="#cb32-113" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb32-114"><a href="#cb32-114" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb32-115"><a href="#cb32-115" tabindex="-1"></a>  </span>
<span id="cb32-116"><a href="#cb32-116" tabindex="-1"></a>  <span class="co">#merge in counts of bad obs</span></span>
<span id="cb32-117"><a href="#cb32-117" tabindex="-1"></a>  </span>
<span id="cb32-118"><a href="#cb32-118" tabindex="-1"></a>  RMSLE_eval <span class="ot">&lt;-</span> RMSLE_eval <span class="sc">%&gt;%</span></span>
<span id="cb32-119"><a href="#cb32-119" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(RMSLE_badobs,</span>
<span id="cb32-120"><a href="#cb32-120" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Options&quot;</span>, <span class="st">&quot;method&quot;</span>))</span>
<span id="cb32-121"><a href="#cb32-121" tabindex="-1"></a>  </span>
<span id="cb32-122"><a href="#cb32-122" tabindex="-1"></a>  <span class="fu">return</span>(RMSLE_eval)</span>
<span id="cb32-123"><a href="#cb32-123" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="goodness-of-fit-metrics" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Goodness of fit
metrics</h2>
<p>Goodness-of-fit table with R-squared, RMSLE and AIC:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># Goodness-of-fit table with R-squared, RMSLE and AIC</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>get_gof <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>  </span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>                     time_indic,</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>  </span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>  winning_model <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(<span class="fu">get_winning_model</span>(<span class="at">obj =</span> current_rds))</span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a>  </span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a>    this_rsq <span class="ot">&lt;-</span> <span class="fu">rsq.pk</span>(current_rds,</span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a>                    <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a>                    <span class="at">rsq_group =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(Chemical, Species),</span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a>                    <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a>      <span class="fu">semi_join</span>(winning_model)</span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a>    </span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a>    this_AIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(current_rds) <span class="sc">%&gt;%</span></span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a>      <span class="fu">semi_join</span>(winning_model)</span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a>    </span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a>    this_rmsle <span class="ot">&lt;-</span> <span class="fu">rmse.pk</span>(current_rds,</span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a>                      <span class="at">rmse_group =</span> <span class="fu">vars</span>(Chemical, Species),</span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a>                      <span class="at">use_scale_conc =</span> <span class="fu">list</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a>                                            <span class="at">log10_trans =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a>                      <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a>      <span class="fu">semi_join</span>(winning_model)</span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a>  })</span>
<span id="cb33-42"><a href="#cb33-42" tabindex="-1"></a>  </span>
<span id="cb33-43"><a href="#cb33-43" tabindex="-1"></a>  <span class="co"># Since they are all joined by winmodel</span></span>
<span id="cb33-44"><a href="#cb33-44" tabindex="-1"></a>  <span class="co"># all three must have same NROW</span></span>
<span id="cb33-45"><a href="#cb33-45" tabindex="-1"></a>  <span class="fu">message</span>(</span>
<span id="cb33-46"><a href="#cb33-46" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;For &quot;</span>, pk_name, <span class="st">&quot;... outputs below must have same number of rows&quot;</span>)</span>
<span id="cb33-47"><a href="#cb33-47" tabindex="-1"></a>  )</span>
<span id="cb33-48"><a href="#cb33-48" tabindex="-1"></a>  </span>
<span id="cb33-49"><a href="#cb33-49" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;rsq: &quot;</span>, <span class="fu">NROW</span>(this_rsq)))</span>
<span id="cb33-50"><a href="#cb33-50" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;aic: &quot;</span>, <span class="fu">NROW</span>(this_AIC)))</span>
<span id="cb33-51"><a href="#cb33-51" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;rmsle: &quot;</span>, <span class="fu">NROW</span>(this_rmsle)))</span>
<span id="cb33-52"><a href="#cb33-52" tabindex="-1"></a>  </span>
<span id="cb33-53"><a href="#cb33-53" tabindex="-1"></a>  gof_df <span class="ot">&lt;-</span> this_rsq <span class="sc">%&gt;%</span></span>
<span id="cb33-54"><a href="#cb33-54" tabindex="-1"></a>    <span class="fu">inner_join</span>(this_AIC, <span class="at">by =</span> <span class="fu">join_by</span>(Chemical, Species, method, model)) <span class="sc">%&gt;%</span></span>
<span id="cb33-55"><a href="#cb33-55" tabindex="-1"></a>    <span class="fu">inner_join</span>(this_rmsle, <span class="at">by =</span> <span class="fu">join_by</span>(Chemical, Species, method, model)) <span class="sc">%&gt;%</span></span>
<span id="cb33-56"><a href="#cb33-56" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name, <span class="at">.before =</span> Chemical)</span>
<span id="cb33-57"><a href="#cb33-57" tabindex="-1"></a>  </span>
<span id="cb33-58"><a href="#cb33-58" tabindex="-1"></a>  <span class="fu">return</span>(gof_df)</span>
<span id="cb33-59"><a href="#cb33-59" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="get-all-predictions" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Get all
predictions</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="co"># All predictions </span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>get_all_preds <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>  </span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a>                     time_indic,</span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a>  </span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a>  </span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a>  </span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a>  <span class="co"># Wide winning model</span></span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb34-27"><a href="#cb34-27" tabindex="-1"></a>    winning_model <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(<span class="at">obj =</span> current_rds) <span class="sc">%&gt;%</span></span>
<span id="cb34-28"><a href="#cb34-28" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(near_flat, preds_below_loq))</span>
<span id="cb34-29"><a href="#cb34-29" tabindex="-1"></a>    this_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(current_rds,</span>
<span id="cb34-30"><a href="#cb34-30" tabindex="-1"></a>                          <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-31"><a href="#cb34-31" tabindex="-1"></a>      <span class="fu">semi_join</span>(winning_model) <span class="sc">%&gt;%</span></span>
<span id="cb34-32"><a href="#cb34-32" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name, <span class="at">.before =</span> Chemical)</span>
<span id="cb34-33"><a href="#cb34-33" tabindex="-1"></a>  })</span>
<span id="cb34-34"><a href="#cb34-34" tabindex="-1"></a>  <span class="fu">return</span>(this_preds)</span>
<span id="cb34-35"><a href="#cb34-35" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="factor-of-two-model-error" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Factor of two model
error</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># Factor of two model error</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>tf_tests <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>  </span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>                     time_indic,</span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a>  current_rds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Now analyzing: &quot;</span>, pk_name))</span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a>  </span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">twofold_test</span>(current_rds,</span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a>                      <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a>                      <span class="at">suppress_messages =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a>  </span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a>  out <span class="ot">&lt;-</span> out<span class="sc">$</span>model_error_summary <span class="sc">%&gt;%</span></span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name)</span>
<span id="cb35-29"><a href="#cb35-29" tabindex="-1"></a>  </span>
<span id="cb35-30"><a href="#cb35-30" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb35-31"><a href="#cb35-31" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="evaluate-the-various-gof-metrics" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Evaluate the various
GOF metrics</h2>
<p>Now call these functions and do the evaluations.</p>
<p>Winning model comparisons:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="co">#winning model</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="fu">system.time</span>(wm_comp <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">winmodel_comp =</span> <span class="fu">list</span>(</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>                <span class="fu">winmodel_comparison</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(winmodel_comp))</span></code></pre></div>
<p>RMSLE for Cmax and AUC:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="co">#RMSLE for Cmax and AUC</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="fu">system.time</span>(cmax_auc_rmsle_tbl <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">nca_comp =</span> <span class="fu">list</span>(</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>                <span class="fu">rmsles_Cmax_AUC</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(nca_comp))</span></code></pre></div>
<p>Goodness-of-fit metrics table:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="co">#GOF table</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="fu">system.time</span>(gof_tbl <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">gof_win =</span> <span class="fu">list</span>(</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>                <span class="fu">get_gof</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(gof_win))</span></code></pre></div>
<p>Factor of two:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="co">#factor of two</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="fu">system.time</span>(all_tf_tests <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">TF =</span> <span class="fu">list</span>(</span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a>                <span class="fu">tf_tests</span>(error_model,</span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a>                         <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>                         <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a>                         <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(TF))</span></code></pre></div>
<p>Get all predictions:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co">#all predictions</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="fu">system.time</span>(all_preds <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">these_preds =</span> <span class="fu">list</span>(</span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>                <span class="fu">get_all_preds</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>                                 <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>                                 <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>                                 <span class="at">this_time_scale =</span> time_scale))) <span class="sc">%&gt;%</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>              tidyr<span class="sc">::</span><span class="fu">unnest</span>(these_preds))</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="co">#Save preds to a file as well</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a><span class="fu">saveRDS</span>(all_preds, <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>                          today,</span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>                          <span class="st">&quot;_all_preds.Rds&quot;</span>))</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a><span class="fu">rm</span>(all_preds)</span></code></pre></div>
<p>Produce and save tables for these evaluation metrics.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>(win_mdl_count_by_opts <span class="ot">&lt;-</span> gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Options, method, model) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> model,</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>              <span class="at">values_from =</span> n) )</span></code></pre></div>
</div>
<div id="rank-fitting-options" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Rank fitting
options</h2>
<p>Rank fitting options by count of Chemical-Species data groups where
RMSLE &lt; 1</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  <span class="fu">count</span>(RMSLE <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">RMSLE &lt; 1</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">8</span>)</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a><span class="co"># bobyqa-optimized options 010h, 110h, 110p</span></span></code></pre></div>
<p>What about R-squared greater than 0.75?</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>  <span class="fu">count</span>(Rsq <span class="sc">&gt;</span> <span class="fl">0.75</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Rsq &gt; 0.75</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">8</span>)</span></code></pre></div>
<p>What about both RMSLE &lt; 1 and R-squared greater than 0.75?</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>rmsle_rsq_rank <span class="ot">&lt;-</span> gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  <span class="fu">count</span>(RMSLE <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> Rsq <span class="sc">&gt;</span> <span class="fl">0.75</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">RMSLE &lt; 1 &amp; Rsq &gt; 0.75</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">`</span><span class="at"># Chemical-Species data groups</span><span class="st">`</span> <span class="ot">=</span> n) </span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>rmsle_rsq_rank <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="dv">8</span>)</span></code></pre></div>
<p>Looking at both criteria together, it appears that the best set of
fitting options is actually the simplest: 000p (no data transformation
and pooled error model), bobyqa-optimized.</p>
<p>But also, let’s add in the Cmax/AUC RMSLE calculations: Sort the
fitting options from smallest to greatest RMSLE for Cmax and AUC, and
see which set of fitting options yields the lowest RMSLE.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>cmax_auc_rmsle_rank <span class="ot">&lt;-</span> cmax_auc_rmsle_tbl <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>  <span class="fu">arrange</span>(RMSLE_Cmax, RMSLE_AUC) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>  <span class="fu">select</span>(Options, method, RMSLE_Cmax, RMSLE_AUC) </span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a>cmax_auc_rmsle_rank <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">8</span>)</span></code></pre></div>
<p>This ranking strongly suggests 110p, with 100p as a second choice
(both bobyqa).</p>
<p>110p was ranked number 3 in the list of RMSLE and Rsq criteria 9and
100p was ranked number 5). So we select 110p bobyqa as the best when all
of these metrics are considered.</p>
</div>
<div id="supplemental-table-2-save-evaluation-results" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> Supplemental Table 2:
Save evaluation results</h2>
<p>Write the evaluation results to a spreadsheet, including the
rankings.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="co"># Write the results to file</span></span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="at">x =</span> <span class="fu">list</span>(</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>  <span class="at">Fit_Counts =</span> wm_comp,</span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>  <span class="at">AUC_and_Cmax_RMSLE_summary =</span> cmax_auc_rmsle_tbl,</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>  <span class="at">Prediction_Evaluations =</span> gof_tbl,</span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a>  <span class="at">Twofold_Tests =</span> all_tf_tests,</span>
<span id="cb47-8"><a href="#cb47-8" tabindex="-1"></a>   <span class="at">RMSLE_Rsq_rank =</span> rmsle_rsq_rank,</span>
<span id="cb47-9"><a href="#cb47-9" tabindex="-1"></a>                         <span class="at">Cmax_AUC_RMSLE_rank =</span> cmax_auc_rmsle_rank),</span>
<span id="cb47-10"><a href="#cb47-10" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb47-11"><a href="#cb47-11" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb47-12"><a href="#cb47-12" tabindex="-1"></a>                today,</span>
<span id="cb47-13"><a href="#cb47-13" tabindex="-1"></a>                <span class="st">&quot;_Supp_Table2_eval_results&quot;</span>,</span>
<span id="cb47-14"><a href="#cb47-14" tabindex="-1"></a>                <span class="st">&quot;.xlsx&quot;</span>))</span>
<span id="cb47-15"><a href="#cb47-15" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" tabindex="-1"></a><span class="fu">rm</span>(wm_comp, cmax_auc_rmsle_tbl, gof_tbl, all_tf_tests)</span>
<span id="cb47-17"><a href="#cb47-17" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
</div>
<div id="plots-for-evaluation-of-fitting-options" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> Plots for evaluation
of fitting options</h2>
<div id="goodness-of-fit-metrics-rsq-and-rmsle-across-fitting-options" class="section level3" number="7.9.1">
<h3><span class="header-section-number">7.9.1</span> Goodness-of-fit
metrics Rsq and RMSLE across fitting options</h3>
<p>Plot R-sq vs. RMSLE for the various fitting options, color-coding by
winning model.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>gof_tbl <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>                today,</span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>                <span class="st">&quot;_Supp_Table2_eval_results&quot;</span>,</span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>                <span class="st">&quot;.xlsx&quot;</span>),</span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a>                <span class="at">sheet =</span> <span class="st">&quot;Prediction_Evaluations&quot;</span>)</span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a> gof_tbl <span class="ot">&lt;-</span> gof_tbl <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">opts =</span> <span class="fu">substr</span>(Options, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a>                <span class="at">model_text =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(model <span class="sc">%in%</span> <span class="st">&quot;model_1comp&quot;</span> <span class="sc">~</span> <span class="st">&quot;1comp&quot;</span>,</span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a>                                              model <span class="sc">%in%</span> <span class="st">&quot;model_2comp&quot;</span> <span class="sc">~</span> <span class="st">&quot;2comp&quot;</span>,</span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a>                                              model <span class="sc">%in%</span> <span class="st">&quot;model_flat&quot;</span> <span class="sc">~</span> <span class="st">&quot;flat&quot;</span>,</span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a>                                              <span class="at">.default =</span> <span class="cn">NA_character_</span>))</span>
<span id="cb48-14"><a href="#cb48-14" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" tabindex="-1"></a>fig_rsq_rmsle <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gof_tbl) <span class="sc">+</span></span>
<span id="cb48-16"><a href="#cb48-16" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> RMSLE,</span>
<span id="cb48-17"><a href="#cb48-17" tabindex="-1"></a>                 <span class="at">y =</span> Rsq,</span>
<span id="cb48-18"><a href="#cb48-18" tabindex="-1"></a>                 <span class="at">color =</span> model_text)) <span class="sc">+</span></span>
<span id="cb48-19"><a href="#cb48-19" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(opts),</span>
<span id="cb48-20"><a href="#cb48-20" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(<span class="fu">interaction</span>(error_model, method)</span>
<span id="cb48-21"><a href="#cb48-21" tabindex="-1"></a>                         )</span>
<span id="cb48-22"><a href="#cb48-22" tabindex="-1"></a>             ) <span class="sc">+</span></span>
<span id="cb48-23"><a href="#cb48-23" tabindex="-1"></a> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;1comp&quot;</span> <span class="ot">=</span> <span class="st">&quot;#0398FC&quot;</span>,</span>
<span id="cb48-24"><a href="#cb48-24" tabindex="-1"></a>                                 <span class="st">&quot;2comp&quot;</span> <span class="ot">=</span> <span class="st">&quot;#D68E09&quot;</span>,</span>
<span id="cb48-25"><a href="#cb48-25" tabindex="-1"></a>                               <span class="st">&quot;flat&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb48-26"><a href="#cb48-26" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Winning model&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-27"><a href="#cb48-27" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb48-28"><a href="#cb48-28" tabindex="-1"></a></span>
<span id="cb48-29"><a href="#cb48-29" tabindex="-1"></a>fig_rsq_rmsle</span></code></pre></div>
<p>This figure reveals two things:</p>
<p>First, when L-BFGS-B is the optimizer, RMSLEs are much larger for a
subset of data groups compared to bobyqa.</p>
<p>Second, when L-BFGS-B is the optimizer, the flat model is the winning
model for a much greater number of data groups, indicating that for some
data groups, L-BFGS-B could not locate a reasonable set of model
parameters for 1- or 2-comapartment models, but bobyqa could.</p>
<p>If we zoom in to RMSLE &lt; 2:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>fig_rsq_rmsle_zoom <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gof_tbl) <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> RMSLE,</span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a>                 <span class="at">y =</span> Rsq,</span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a>                 <span class="at">color =</span> model_text)) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(opts),</span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(<span class="fu">interaction</span>(error_model, method)</span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>                         )</span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a>             ) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;1comp&quot;</span> <span class="ot">=</span> <span class="st">&quot;#0398FC&quot;</span>,</span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a>                                 <span class="st">&quot;2comp&quot;</span> <span class="ot">=</span> <span class="st">&quot;#D68E09&quot;</span>,</span>
<span id="cb49-11"><a href="#cb49-11" tabindex="-1"></a>                               <span class="st">&quot;flat&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb49-12"><a href="#cb49-12" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&quot;Winning model&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb49-15"><a href="#cb49-15" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" tabindex="-1"></a>fig_rsq_rmsle_zoom</span></code></pre></div>
<p>When each time-scaling fit (when “1” is in the last place of the fit
options shorthand) is compared to the fit in the row immediately above
it (the same dose-normalization and log10-transformations options, but
without time scaling), it can be seen that time scaling either has
little effect on goodness of fit, or it makes RMSLE and/or R-squared
slightly worse.</p>
<p>Save these figures.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="co">#PDF versions</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a>              today,</span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig4&quot;</span>,</span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a>              <span class="st">&quot;.pdf&quot;</span>),</span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a>       fig_rsq_rmsle,</span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">11</span>,</span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">8.5</span>)</span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb50-12"><a href="#cb50-12" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb50-13"><a href="#cb50-13" tabindex="-1"></a>              today,</span>
<span id="cb50-14"><a href="#cb50-14" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig5&quot;</span>,</span>
<span id="cb50-15"><a href="#cb50-15" tabindex="-1"></a>              <span class="st">&quot;.pdf&quot;</span>),</span>
<span id="cb50-16"><a href="#cb50-16" tabindex="-1"></a>       fig_rsq_rmsle_zoom,</span>
<span id="cb50-17"><a href="#cb50-17" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">11</span>,</span>
<span id="cb50-18"><a href="#cb50-18" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">8.5</span>)</span>
<span id="cb50-19"><a href="#cb50-19" tabindex="-1"></a></span>
<span id="cb50-20"><a href="#cb50-20" tabindex="-1"></a><span class="co">#PNG versions</span></span>
<span id="cb50-21"><a href="#cb50-21" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb50-22"><a href="#cb50-22" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb50-23"><a href="#cb50-23" tabindex="-1"></a>              today,</span>
<span id="cb50-24"><a href="#cb50-24" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig4&quot;</span>,</span>
<span id="cb50-25"><a href="#cb50-25" tabindex="-1"></a>              <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb50-26"><a href="#cb50-26" tabindex="-1"></a>       fig_rsq_rmsle,</span>
<span id="cb50-27"><a href="#cb50-27" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">11</span>,</span>
<span id="cb50-28"><a href="#cb50-28" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">8.5</span>)</span>
<span id="cb50-29"><a href="#cb50-29" tabindex="-1"></a></span>
<span id="cb50-30"><a href="#cb50-30" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb50-31"><a href="#cb50-31" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb50-32"><a href="#cb50-32" tabindex="-1"></a>              today,</span>
<span id="cb50-33"><a href="#cb50-33" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig5&quot;</span>,</span>
<span id="cb50-34"><a href="#cb50-34" tabindex="-1"></a>              <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb50-35"><a href="#cb50-35" tabindex="-1"></a>       fig_rsq_rmsle_zoom,</span>
<span id="cb50-36"><a href="#cb50-36" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">11</span>,</span>
<span id="cb50-37"><a href="#cb50-37" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">8.5</span>)</span>
<span id="cb50-38"><a href="#cb50-38" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" tabindex="-1"></a><span class="fu">rm</span>(fig_rsq_rmsle_zoom, fig_rsq_rmsle, gof_tbl)</span></code></pre></div>
</div>
<div id="cmax-rmsle-vs.-auc-rmsle-across-fitting-options" class="section level3" number="7.9.2">
<h3><span class="header-section-number">7.9.2</span> Cmax RMSLE vs. AUC
RMSLE across fitting options</h3>
<p>Plot Cmax RMSLE vs. AUC RMSLE.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="co">#read in table</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a>cmax_auc_rmsle_tbl <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>                                                   <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a>                                                  today,</span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a>                                                  <span class="st">&quot;_Supp_Table2_eval_results.xlsx&quot;</span>),</span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a>                                     <span class="at">sheet =</span> <span class="st">&quot;AUC_and_Cmax_RMSLE_summary&quot;</span>)</span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a><span class="co">#make plot</span></span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a>cmax_auc_rmsle_tbl <span class="ot">&lt;-</span> cmax_auc_rmsle_tbl <span class="sc">%&gt;%</span></span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">opts =</span> <span class="fu">substr</span>(Options, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a>cmax_auc_rmsle_fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(cmax_auc_rmsle_tbl) <span class="sc">+</span></span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> RMSLE_AUC,</span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a>                 <span class="at">y =</span> RMSLE_Cmax,</span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a>                 <span class="at">color =</span> opts),</span>
<span id="cb51-15"><a href="#cb51-15" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(error_model),</span>
<span id="cb51-17"><a href="#cb51-17" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(method)) <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>,</span>
<span id="cb51-19"><a href="#cb51-19" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">&quot;Fit options&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-20"><a href="#cb51-20" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb51-21"><a href="#cb51-21" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" tabindex="-1"></a>cmax_auc_rmsle_fig</span>
<span id="cb51-23"><a href="#cb51-23" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" tabindex="-1"></a><span class="co">#save plot</span></span>
<span id="cb51-25"><a href="#cb51-25" tabindex="-1"></a><span class="co">#PDF version</span></span>
<span id="cb51-26"><a href="#cb51-26" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb51-27"><a href="#cb51-27" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb51-28"><a href="#cb51-28" tabindex="-1"></a>              today,</span>
<span id="cb51-29"><a href="#cb51-29" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig6&quot;</span>,</span>
<span id="cb51-30"><a href="#cb51-30" tabindex="-1"></a>                <span class="st">&quot;.pdf&quot;</span>),</span>
<span id="cb51-31"><a href="#cb51-31" tabindex="-1"></a>      cmax_auc_rmsle_fig,</span>
<span id="cb51-32"><a href="#cb51-32" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb51-33"><a href="#cb51-33" tabindex="-1"></a>      <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb51-34"><a href="#cb51-34" tabindex="-1"></a></span>
<span id="cb51-35"><a href="#cb51-35" tabindex="-1"></a><span class="co">#PNG version</span></span>
<span id="cb51-36"><a href="#cb51-36" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb51-37"><a href="#cb51-37" tabindex="-1"></a>                <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb51-38"><a href="#cb51-38" tabindex="-1"></a>              today,</span>
<span id="cb51-39"><a href="#cb51-39" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig6&quot;</span>,</span>
<span id="cb51-40"><a href="#cb51-40" tabindex="-1"></a>                <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb51-41"><a href="#cb51-41" tabindex="-1"></a>      cmax_auc_rmsle_fig,</span>
<span id="cb51-42"><a href="#cb51-42" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb51-43"><a href="#cb51-43" tabindex="-1"></a>      <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb51-44"><a href="#cb51-44" tabindex="-1"></a>      <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb51-45"><a href="#cb51-45" tabindex="-1"></a>      <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb51-46"><a href="#cb51-46" tabindex="-1"></a></span>
<span id="cb51-47"><a href="#cb51-47" tabindex="-1"></a><span class="fu">rm</span>(cmax_auc_rmsle_fig, cmax_auc_rmsle_tbl)</span></code></pre></div>
<p>This figure reveals that overall, L-BFGS-B produced fits that did not
match NCA-estimated Cmax or AUC as well as bobyqa fits. Considering only
the bobyqa fits, the pooled error model achieved the smallest
differences between NCA and model-predicted Cmax and AUC, and it did so
with the two sets of fitting options that included both
dose-normalization and log10-transformation.</p>
<p>Plot predicted vs. observed concentrations for everything, using the
winning fit options and the winning model for each data group.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>all_preds <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>                          today,</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>                          <span class="st">&quot;_all_preds.Rds&quot;</span>))</span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a><span class="co">#select winning fit opts: 110p bobyqa</span></span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a>all_preds_prep <span class="ot">&lt;-</span> all_preds <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8" tabindex="-1"></a>  <span class="fu">filter</span>(Options <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;110p&quot;</span>),</span>
<span id="cb52-9"><a href="#cb52-9" tabindex="-1"></a>         method <span class="sc">%in%</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="#cb52-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Conc_est_sub =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(Conc_est <span class="sc">&lt;</span> pLOQ,</span>
<span id="cb52-11"><a href="#cb52-11" tabindex="-1"></a>         pLOQ,</span>
<span id="cb52-12"><a href="#cb52-12" tabindex="-1"></a>         Conc_est),</span>
<span id="cb52-13"><a href="#cb52-13" tabindex="-1"></a>         <span class="at">Conc_est_belowLOQ =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(Conc_est <span class="sc">&lt;</span> pLOQ,</span>
<span id="cb52-14"><a href="#cb52-14" tabindex="-1"></a>         <span class="cn">TRUE</span>,</span>
<span id="cb52-15"><a href="#cb52-15" tabindex="-1"></a>         <span class="cn">FALSE</span>),</span>
<span id="cb52-16"><a href="#cb52-16" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">as.factor</span>(<span class="fu">paste</span>(Chemical, Chemical_Name, Species)),</span>
<span id="cb52-17"><a href="#cb52-17" tabindex="-1"></a>         <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-18"><a href="#cb52-18" tabindex="-1"></a>  <span class="fu">select</span>(ID, Options,</span>
<span id="cb52-19"><a href="#cb52-19" tabindex="-1"></a>         dose_norm, log10_trans, time_scale,</span>
<span id="cb52-20"><a href="#cb52-20" tabindex="-1"></a>         Route, Media, Dose,</span>
<span id="cb52-21"><a href="#cb52-21" tabindex="-1"></a>         Conc, Conc_est_sub, Conc_est_belowLOQ,</span>
<span id="cb52-22"><a href="#cb52-22" tabindex="-1"></a>         Time, Reference)</span>
<span id="cb52-23"><a href="#cb52-23" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" tabindex="-1"></a>split_preds <span class="ot">&lt;-</span> <span class="fu">split</span>(all_preds_prep, all_preds_prep<span class="sc">$</span>ID)</span>
<span id="cb52-25"><a href="#cb52-25" tabindex="-1"></a></span>
<span id="cb52-26"><a href="#cb52-26" tabindex="-1"></a>sp_plots <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(split_preds), <span class="cf">function</span>(i) {</span>
<span id="cb52-27"><a href="#cb52-27" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> split_preds[[i]],</span>
<span id="cb52-28"><a href="#cb52-28" tabindex="-1"></a>         <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Conc,</span>
<span id="cb52-29"><a href="#cb52-29" tabindex="-1"></a>                       <span class="at">y =</span> Conc_est_sub,</span>
<span id="cb52-30"><a href="#cb52-30" tabindex="-1"></a>                       <span class="at">color =</span> <span class="fu">as.factor</span>(Dose),</span>
<span id="cb52-31"><a href="#cb52-31" tabindex="-1"></a>                       <span class="at">shape =</span> Reference)) <span class="sc">+</span></span>
<span id="cb52-32"><a href="#cb52-32" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Observed conc, mg/L&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-33"><a href="#cb52-33" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Predicted conc, mg/L&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-34"><a href="#cb52-34" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb52-35"><a href="#cb52-35" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb52-36"><a href="#cb52-36" tabindex="-1"></a>    <span class="fu">facet_grid</span>(Route <span class="sc">~</span> Media, </span>
<span id="cb52-37"><a href="#cb52-37" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-38"><a href="#cb52-38" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb52-39"><a href="#cb52-39" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb52-40"><a href="#cb52-40" tabindex="-1"></a>    <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">&quot;bl&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-41"><a href="#cb52-41" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">name =</span> <span class="st">&quot;Dose, mg/kg&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-42"><a href="#cb52-42" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb52-43"><a href="#cb52-43" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> i) <span class="sc">+</span></span>
<span id="cb52-44"><a href="#cb52-44" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb52-45"><a href="#cb52-45" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb52-46"><a href="#cb52-46" tabindex="-1"></a>}</span>
<span id="cb52-47"><a href="#cb52-47" tabindex="-1"></a>)</span>
<span id="cb52-48"><a href="#cb52-48" tabindex="-1"></a></span>
<span id="cb52-49"><a href="#cb52-49" tabindex="-1"></a><span class="co"># Very BIG FILE</span></span>
<span id="cb52-50"><a href="#cb52-50" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(</span>
<span id="cb52-51"><a href="#cb52-51" tabindex="-1"></a>  <span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb52-52"><a href="#cb52-52" tabindex="-1"></a>  <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb52-53"><a href="#cb52-53" tabindex="-1"></a>  today,</span>
<span id="cb52-54"><a href="#cb52-54" tabindex="-1"></a>   <span class="st">&quot;_log10_predvsobs_plots_110pbobyqa_all.pdf&quot;</span>),</span>
<span id="cb52-55"><a href="#cb52-55" tabindex="-1"></a>  <span class="at">onefile =</span> <span class="cn">TRUE</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb52-56"><a href="#cb52-56" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="fu">seq_along</span>(sp_plots)) {</span>
<span id="cb52-57"><a href="#cb52-57" tabindex="-1"></a>  <span class="fu">print</span>(sp_plots[[x]])</span>
<span id="cb52-58"><a href="#cb52-58" tabindex="-1"></a>}</span>
<span id="cb52-59"><a href="#cb52-59" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb52-60"><a href="#cb52-60" tabindex="-1"></a></span>
<span id="cb52-61"><a href="#cb52-61" tabindex="-1"></a><span class="fu">rm</span>(sp_plots, split_preds, all_preds_prep, all_preds)</span></code></pre></div>
</div>
</div>
</div>
<div id="analysis-plots-and-tables-for-best-set-of-fitting-options" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Analysis Plots and
Tables for Best Set of Fitting Options</h1>
<p>Begin by collating the data needed for plots. These data are
generally accessible using functions/methods for evaluating fitted
<code>pk</code> objects.</p>
<p>Read in the fitted <code>pk</code> object for the best set of fitting
options.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>                        read_date_pk,</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a>                        <span class="st">&quot;mypk_fit_110p.Rds&quot;</span>))</span></code></pre></div>
<p>Get winning model; predictions; residuals; TK stats; NCA results;
twofold test results; coefficients; coefficient SDs.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co"># after fitting pk object for all cvt objects or reading the fitted pk object in `setup`</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>winmodel <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>)</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>my_preds <span class="ot">&lt;-</span> <span class="fu">semi_join</span>(<span class="fu">predict</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>), winmodel) </span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>my_residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel) </span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a>my_tkstats <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a>my_nca <span class="ot">&lt;-</span> <span class="fu">get_nca</span>(my_pk)</span>
<span id="cb54-8"><a href="#cb54-8" tabindex="-1"></a>all_my_data <span class="ot">&lt;-</span> <span class="fu">get_data</span>(my_pk)</span>
<span id="cb54-9"><a href="#cb54-9" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" tabindex="-1"></a><span class="co">#merge together long form coefs and long form coef SDs</span></span>
<span id="cb54-11"><a href="#cb54-11" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" tabindex="-1"></a>my_tf <span class="ot">&lt;-</span> <span class="fu">twofold_test</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>)  </span>
<span id="cb54-13"><a href="#cb54-13" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" tabindex="-1"></a><span class="fu">NROW</span>(all_my_data) <span class="sc">&gt;</span> <span class="fu">NROW</span>(my_preds) <span class="co"># THis must be true... or else try distinct(my_preds)</span></span>
<span id="cb54-15"><a href="#cb54-15" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" tabindex="-1"></a>my_coef_sd <span class="ot">&lt;-</span> <span class="fu">coef_sd</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span> <span class="co">#this will take a few minutes to run</span></span>
<span id="cb54-17"><a href="#cb54-17" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel) <span class="co">#keep only coefs &amp; SDs for winning model</span></span>
<span id="cb54-18"><a href="#cb54-18" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" tabindex="-1"></a><span class="co"># Writing file to xlsx</span></span>
<span id="cb54-20"><a href="#cb54-20" tabindex="-1"></a>writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="at">predictions =</span> my_preds,</span>
<span id="cb54-21"><a href="#cb54-21" tabindex="-1"></a>                             <span class="at">tkstats =</span> my_tkstats,</span>
<span id="cb54-22"><a href="#cb54-22" tabindex="-1"></a>                             <span class="at">coefs_sds =</span> my_coef_sd),</span>
<span id="cb54-23"><a href="#cb54-23" tabindex="-1"></a>                    <span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb54-24"><a href="#cb54-24" tabindex="-1"></a>                                  <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb54-25"><a href="#cb54-25" tabindex="-1"></a>                                  today,</span>
<span id="cb54-26"><a href="#cb54-26" tabindex="-1"></a>                                  <span class="st">&quot;_Supp_Table3&quot;</span>,</span>
<span id="cb54-27"><a href="#cb54-27" tabindex="-1"></a>                                  <span class="st">&quot;.xlsx&quot;</span>))</span></code></pre></div>
<p>Compute fold errors, r-squared, AIC, RMSLE, RMSE.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>fe_df <span class="ot">&lt;-</span> <span class="fu">fold_error</span>(my_pk,</span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a>                     <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" tabindex="-1"></a>r2_df <span class="ot">&lt;-</span> <span class="fu">rsq</span>(my_pk,</span>
<span id="cb55-7"><a href="#cb55-7" tabindex="-1"></a>             <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-8"><a href="#cb55-8" tabindex="-1"></a>             <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-9"><a href="#cb55-9" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="#cb55-10" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb55-11"><a href="#cb55-11" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" tabindex="-1"></a>myAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-13"><a href="#cb55-13" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb55-14"><a href="#cb55-14" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" tabindex="-1"></a>myRMSLE <span class="ot">&lt;-</span> <span class="fu">rmse</span>(my_pk,</span>
<span id="cb55-16"><a href="#cb55-16" tabindex="-1"></a>               <span class="at">use_scale_conc =</span> <span class="fu">list</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-17"><a href="#cb55-17" tabindex="-1"></a>                                     <span class="at">log10_trans =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-18"><a href="#cb55-18" tabindex="-1"></a>               <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-19"><a href="#cb55-19" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-20"><a href="#cb55-20" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)  </span>
<span id="cb55-21"><a href="#cb55-21" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" tabindex="-1"></a>myRMSE <span class="ot">&lt;-</span> <span class="fu">rmse</span>(my_pk,</span>
<span id="cb55-23"><a href="#cb55-23" tabindex="-1"></a>               <span class="at">rmse_group =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(Chemical,</span>
<span id="cb55-24"><a href="#cb55-24" tabindex="-1"></a>                                          Species,</span>
<span id="cb55-25"><a href="#cb55-25" tabindex="-1"></a>                                          Route,</span>
<span id="cb55-26"><a href="#cb55-26" tabindex="-1"></a>                                          Media,</span>
<span id="cb55-27"><a href="#cb55-27" tabindex="-1"></a>                                          Dose),</span>
<span id="cb55-28"><a href="#cb55-28" tabindex="-1"></a>               <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-29"><a href="#cb55-29" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-30"><a href="#cb55-30" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel) </span></code></pre></div>
<div id="supp-figure-7-invivopkfit-model-performance" class="section level3" number="8.0.1">
<h3><span class="header-section-number">8.0.1</span> Supp Figure 7:
invivoPKfit model performance</h3>
<p>Overall fold error distributions.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a>my_tf<span class="sc">$</span>model_error_all <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;model_1comp&quot;</span>, <span class="st">&quot;model_2comp&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Route.model =</span> <span class="fu">factor</span>(<span class="fu">paste</span>(Route, model),</span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;iv model_1comp&quot;</span>,</span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a>                                         <span class="st">&quot;iv model_2comp&quot;</span>,</span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a>                                         <span class="st">&quot;oral model_1comp&quot;</span>,</span>
<span id="cb56-7"><a href="#cb56-7" tabindex="-1"></a>                                         <span class="st">&quot;oral model_2comp&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb56-8"><a href="#cb56-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Fold_Error,</span>
<span id="cb56-9"><a href="#cb56-9" tabindex="-1"></a>             <span class="at">fill =</span> Route.model)) <span class="sc">+</span></span>
<span id="cb56-10"><a href="#cb56-10" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="cn">NA</span>,</span>
<span id="cb56-11"><a href="#cb56-11" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_stack</span>(),</span>
<span id="cb56-12"><a href="#cb56-12" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb56-13"><a href="#cb56-13" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10)) <span class="sc">+</span></span>
<span id="cb56-14"><a href="#cb56-14" tabindex="-1"></a>  <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-15"><a href="#cb56-15" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>,</span>
<span id="cb56-16"><a href="#cb56-16" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">&quot;Route/winning model&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-17"><a href="#cb56-17" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb56-18"><a href="#cb56-18" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-19"><a href="#cb56-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Predicted/Observed&quot;</span>,</span>
<span id="cb56-20"><a href="#cb56-20" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Observations&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-21"><a href="#cb56-21" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb56-22"><a href="#cb56-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb56-23"><a href="#cb56-23" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb56-24"><a href="#cb56-24" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey95&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb56-25"><a href="#cb56-25" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="fl">1.5</span>), <span class="dv">100</span>))</span>
<span id="cb56-26"><a href="#cb56-26" tabindex="-1"></a></span>
<span id="cb56-27"><a href="#cb56-27" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb56-29"><a href="#cb56-29" tabindex="-1"></a>               <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb56-30"><a href="#cb56-30" tabindex="-1"></a>                                  today,</span>
<span id="cb56-31"><a href="#cb56-31" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig7_PredictedObserved_compartmentModels.png&quot;</span>),</span>
<span id="cb56-32"><a href="#cb56-32" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>, <span class="at">width =</span> <span class="dv">7</span>)</span>
<span id="cb56-33"><a href="#cb56-33" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb56-35"><a href="#cb56-35" tabindex="-1"></a>               <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb56-36"><a href="#cb56-36" tabindex="-1"></a>                                  today,</span>
<span id="cb56-37"><a href="#cb56-37" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig7_PredictedObserved_compartmentModels.pdf&quot;</span>),</span>
<span id="cb56-38"><a href="#cb56-38" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>, <span class="at">width =</span> <span class="dv">7</span>)</span>
<span id="cb56-39"><a href="#cb56-39" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div id="figure-4-and-supplemental-figures-4-5-model-performance-vs-data-variability" class="section level3" number="8.0.2">
<h3><span class="header-section-number">8.0.2</span> Figure 4 and
Supplemental Figures 4 &amp; 5: Model performance vs Data
Variability</h3>
<p>Here we examine the performance of “best fit” models with relation to
data variability. Here, because we are trying to specifically compare
data variability with model performance, we look at data with replicated
timepoint observations, which are largely data with individual animal
data.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>my_tf<span class="sc">$</span>indiv_data_test_fold_errors <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>  <span class="fu">select</span>(model, <span class="fu">starts_with</span>(<span class="st">&quot;percent_&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" tabindex="-1"></a>pl_4A <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>indiv_data_fold_errors <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" tabindex="-1"></a>  <span class="co"># For Plotting</span></span>
<span id="cb57-7"><a href="#cb57-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb57-8"><a href="#cb57-8" tabindex="-1"></a>    <span class="at">y =</span> Fold_Error,</span>
<span id="cb57-9"><a href="#cb57-9" tabindex="-1"></a>    <span class="at">x =</span> foldConc</span>
<span id="cb57-10"><a href="#cb57-10" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb57-11"><a href="#cb57-11" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-13"><a href="#cb57-13" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-14"><a href="#cb57-14" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10),</span>
<span id="cb57-15"><a href="#cb57-15" tabindex="-1"></a>                <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb57-16"><a href="#cb57-16" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10),</span>
<span id="cb57-17"><a href="#cb57-17" tabindex="-1"></a>                <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.0001</span>, <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb57-18"><a href="#cb57-18" tabindex="-1"></a>  <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">&quot;bl&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-19"><a href="#cb57-19" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;cividis&quot;</span>,</span>
<span id="cb57-20"><a href="#cb57-20" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>),</span>
<span id="cb57-21"><a href="#cb57-21" tabindex="-1"></a>                       <span class="at">oob =</span> scales<span class="sc">::</span>oob_squish) <span class="sc">+</span></span>
<span id="cb57-22"><a href="#cb57-22" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Model Error&quot;</span>,</span>
<span id="cb57-23"><a href="#cb57-23" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Data Variability&quot;</span>,</span>
<span id="cb57-24"><a href="#cb57-24" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-25"><a href="#cb57-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb57-26"><a href="#cb57-26" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb57-27"><a href="#cb57-27" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-28"><a href="#cb57-28" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb57-29"><a href="#cb57-29" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb57-30"><a href="#cb57-30" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb57-31"><a href="#cb57-31" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-32"><a href="#cb57-32" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-33"><a href="#cb57-33" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb57-34"><a href="#cb57-34" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) </span>
<span id="cb57-35"><a href="#cb57-35" tabindex="-1"></a></span>
<span id="cb57-36"><a href="#cb57-36" tabindex="-1"></a>pl_4A</span>
<span id="cb57-37"><a href="#cb57-37" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb57-38"><a href="#cb57-38" tabindex="-1"></a>              today,</span>
<span id="cb57-39"><a href="#cb57-39" tabindex="-1"></a>              <span class="st">&quot;_Fig4A_ModelPerformance_vDataVariability.png&quot;</span>),</span>
<span id="cb57-40"><a href="#cb57-40" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb57-41"><a href="#cb57-41" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb57-42"><a href="#cb57-42" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb57-43"><a href="#cb57-43" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb57-44"><a href="#cb57-44" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)  </span></code></pre></div>
<p>Create table.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>  </span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>indiv_data_test_fold_errors <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="st">&quot;All&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="#cb58-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;percent_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-7"><a href="#cb58-7" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="#cb58-8" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;percentages&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-9"><a href="#cb58-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentages =</span> <span class="fu">case_when</span>(</span>
<span id="cb58-10"><a href="#cb58-10" tabindex="-1"></a>    percentages <span class="sc">==</span> <span class="st">&quot;percent_both_within&quot;</span> <span class="sc">~</span> <span class="st">&quot;Both within a factor of 2&quot;</span>,</span>
<span id="cb58-11"><a href="#cb58-11" tabindex="-1"></a>    percentages <span class="sc">==</span> <span class="st">&quot;percent_both_outside&quot;</span> <span class="sc">~</span> <span class="st">&quot;Both outside a factor of 2&quot;</span>,</span>
<span id="cb58-12"><a href="#cb58-12" tabindex="-1"></a>    percentages <span class="sc">==</span> <span class="st">&quot;percent_model_outside&quot;</span> <span class="sc">~</span> <span class="st">&quot;Model too variable&quot;</span>,</span>
<span id="cb58-13"><a href="#cb58-13" tabindex="-1"></a>    percentages <span class="sc">==</span> <span class="st">&quot;percent_data_outside&quot;</span> <span class="sc">~</span> <span class="st">&quot;Data too variable&quot;</span></span>
<span id="cb58-14"><a href="#cb58-14" tabindex="-1"></a>  ))</span>
<span id="cb58-15"><a href="#cb58-15" tabindex="-1"></a>  </span>
<span id="cb58-16"><a href="#cb58-16" tabindex="-1"></a><span class="fu">names</span>(my_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;Overall (%)&quot;</span>)</span>
<span id="cb58-17"><a href="#cb58-17" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" tabindex="-1"></a><span class="fu">flextable</span>(my_table) <span class="sc">%&gt;%</span></span>
<span id="cb58-19"><a href="#cb58-19" tabindex="-1"></a>  <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-20"><a href="#cb58-20" tabindex="-1"></a>  <span class="fu">fontsize</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-21"><a href="#cb58-21" tabindex="-1"></a>  <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">j =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-22"><a href="#cb58-22" tabindex="-1"></a>  <span class="fu">autofit</span>()</span>
<span id="cb58-23"><a href="#cb58-23" tabindex="-1"></a></span>
<span id="cb58-24"><a href="#cb58-24" tabindex="-1"></a>table_plot <span class="ot">&lt;-</span> <span class="fu">gen_grob</span>(<span class="fu">flextable</span>(my_table) <span class="sc">%&gt;%</span></span>
<span id="cb58-25"><a href="#cb58-25" tabindex="-1"></a>                         <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-26"><a href="#cb58-26" tabindex="-1"></a>                         <span class="fu">fontsize</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-27"><a href="#cb58-27" tabindex="-1"></a>                         <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">j =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-28"><a href="#cb58-28" tabindex="-1"></a>                         <span class="fu">autofit</span>(),</span>
<span id="cb58-29"><a href="#cb58-29" tabindex="-1"></a>                       <span class="at">autowidths =</span> <span class="cn">TRUE</span>,</span>
<span id="cb58-30"><a href="#cb58-30" tabindex="-1"></a>                       <span class="at">fit =</span> <span class="st">&quot;width&quot;</span>)</span>
<span id="cb58-31"><a href="#cb58-31" tabindex="-1"></a></span>
<span id="cb58-32"><a href="#cb58-32" tabindex="-1"></a></span>
<span id="cb58-33"><a href="#cb58-33" tabindex="-1"></a>dual_plot <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(pl_4A,</span>
<span id="cb58-34"><a href="#cb58-34" tabindex="-1"></a>                       table_plot,</span>
<span id="cb58-35"><a href="#cb58-35" tabindex="-1"></a>                       <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb58-36"><a href="#cb58-36" tabindex="-1"></a>                       <span class="at">align =</span> <span class="st">&quot;hv&quot;</span>,</span>
<span id="cb58-37"><a href="#cb58-37" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb58-38"><a href="#cb58-38" tabindex="-1"></a>          <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb58-39"><a href="#cb58-39" tabindex="-1"></a>          )</span>
<span id="cb58-40"><a href="#cb58-40" tabindex="-1"></a></span>
<span id="cb58-41"><a href="#cb58-41" tabindex="-1"></a>dual_plot</span>
<span id="cb58-42"><a href="#cb58-42" tabindex="-1"></a></span>
<span id="cb58-43"><a href="#cb58-43" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb58-44"><a href="#cb58-44" tabindex="-1"></a>              <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb58-45"><a href="#cb58-45" tabindex="-1"></a>              today,</span>
<span id="cb58-46"><a href="#cb58-46" tabindex="-1"></a>              <span class="st">&quot;_Fig4.png&quot;</span>),</span>
<span id="cb58-47"><a href="#cb58-47" tabindex="-1"></a>       <span class="at">plot =</span> dual_plot,</span>
<span id="cb58-48"><a href="#cb58-48" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">4.5</span>,</span>
<span id="cb58-49"><a href="#cb58-49" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb58-50"><a href="#cb58-50" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb58-51"><a href="#cb58-51" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb58-52"><a href="#cb58-52" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb58-53"><a href="#cb58-53" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)  </span></code></pre></div>
</div>
<div id="figure-5-multiple-goodness-of-fit-metrics-validate-model-performance" class="section level3" number="8.0.3">
<h3><span class="header-section-number">8.0.3</span> Figure 5: Multiple
goodness-of-fit metrics validate model performance</h3>
<p>Here we analyze and validate model performance per data group using
R-squared, RMSE, and fraction of predictions that are within 2-fold for
each Chemical, Species, Route, Media, and Dose groupings.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>combined_gof_df <span class="ot">&lt;-</span> my_tf<span class="sc">$</span>model_error_all <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, model, method) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">within_2fold =</span> <span class="fu">sum</span>(<span class="fu">between</span>(Fold_Error, <span class="fl">0.5</span>, <span class="dv">2</span>))<span class="sc">/</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>  <span class="fu">left_join</span>(r2_df) <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a>  <span class="fu">left_join</span>(myAIC) <span class="sc">%&gt;%</span></span>
<span id="cb59-6"><a href="#cb59-6" tabindex="-1"></a>  <span class="fu">left_join</span>(myRMSLE) <span class="sc">%&gt;%</span></span>
<span id="cb59-7"><a href="#cb59-7" tabindex="-1"></a>  <span class="fu">semi_join</span>(winmodel)</span>
<span id="cb59-8"><a href="#cb59-8" tabindex="-1"></a>  </span>
<span id="cb59-9"><a href="#cb59-9" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" tabindex="-1"></a>mypl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> combined_gof_df,</span>
<span id="cb59-11"><a href="#cb59-11" tabindex="-1"></a>               <span class="fu">aes</span>(</span>
<span id="cb59-12"><a href="#cb59-12" tabindex="-1"></a>                 <span class="at">x =</span> within_2fold,</span>
<span id="cb59-13"><a href="#cb59-13" tabindex="-1"></a>                 <span class="at">y =</span> Rsq,</span>
<span id="cb59-14"><a href="#cb59-14" tabindex="-1"></a>                 <span class="at">color =</span> model,</span>
<span id="cb59-15"><a href="#cb59-15" tabindex="-1"></a>               )) <span class="sc">+</span></span>
<span id="cb59-16"><a href="#cb59-16" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb59-17"><a href="#cb59-17" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;longdash&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-18"><a href="#cb59-18" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb59-19"><a href="#cb59-19" tabindex="-1"></a>    <span class="co">#coord_cartesian(xlim = c(0,1), ylim = c(0,1)) +</span></span>
<span id="cb59-20"><a href="#cb59-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fraction of predictions within 2-fold&quot;</span>,</span>
<span id="cb59-21"><a href="#cb59-21" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;R-squared value&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-22"><a href="#cb59-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="co">#aspect.ratio = 1,</span></span>
<span id="cb59-23"><a href="#cb59-23" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb59-24"><a href="#cb59-24" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-25"><a href="#cb59-25" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb59-26"><a href="#cb59-26" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-27"><a href="#cb59-27" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-28"><a href="#cb59-28" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb59-29"><a href="#cb59-29" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-30"><a href="#cb59-30" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>()</span>
<span id="cb59-31"><a href="#cb59-31" tabindex="-1"></a>  )</span>
<span id="cb59-32"><a href="#cb59-32" tabindex="-1"></a>  </span>
<span id="cb59-33"><a href="#cb59-33" tabindex="-1"></a>panelA_plot <span class="ot">&lt;-</span> ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(mypl,</span>
<span id="cb59-34"><a href="#cb59-34" tabindex="-1"></a>                                   <span class="at">groupFill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb59-35"><a href="#cb59-35" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,</span>
<span id="cb59-36"><a href="#cb59-36" tabindex="-1"></a>                    <span class="at">xparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>),</span>
<span id="cb59-37"><a href="#cb59-37" tabindex="-1"></a>                    <span class="at">yparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>))</span>
<span id="cb59-38"><a href="#cb59-38" tabindex="-1"></a>panelA_plot</span>
<span id="cb59-39"><a href="#cb59-39" tabindex="-1"></a></span>
<span id="cb59-40"><a href="#cb59-40" tabindex="-1"></a>panelB_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> myRMSE,</span>
<span id="cb59-41"><a href="#cb59-41" tabindex="-1"></a>               <span class="fu">aes</span>(</span>
<span id="cb59-42"><a href="#cb59-42" tabindex="-1"></a>                 <span class="at">x =</span> RMSE,</span>
<span id="cb59-43"><a href="#cb59-43" tabindex="-1"></a>                 <span class="at">fill =</span> model</span>
<span id="cb59-44"><a href="#cb59-44" tabindex="-1"></a>               )) <span class="sc">+</span> </span>
<span id="cb59-45"><a href="#cb59-45" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb59-46"><a href="#cb59-46" tabindex="-1"></a>  <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">&quot;b&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-47"><a href="#cb59-47" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>,</span>
<span id="cb59-48"><a href="#cb59-48" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_stack</span>(),</span>
<span id="cb59-49"><a href="#cb59-49" tabindex="-1"></a>                 <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb59-50"><a href="#cb59-50" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-51"><a href="#cb59-51" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;grey10&quot;</span>)) <span class="sc">+</span></span>
<span id="cb59-52"><a href="#cb59-52" tabindex="-1"></a>   <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;grey10&quot;</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-53"><a href="#cb59-53" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb59-54"><a href="#cb59-54" tabindex="-1"></a>        <span class="co">#aspect.ratio = 1,</span></span>
<span id="cb59-55"><a href="#cb59-55" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb59-56"><a href="#cb59-56" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-57"><a href="#cb59-57" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb59-58"><a href="#cb59-58" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-59"><a href="#cb59-59" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-60"><a href="#cb59-60" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-61"><a href="#cb59-61" tabindex="-1"></a>    <span class="at">panel.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.125</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>),</span>
<span id="cb59-62"><a href="#cb59-62" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-63"><a href="#cb59-63" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb59-64"><a href="#cb59-64" tabindex="-1"></a>panelB_plot</span>
<span id="cb59-65"><a href="#cb59-65" tabindex="-1"></a></span>
<span id="cb59-66"><a href="#cb59-66" tabindex="-1"></a>plAB <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_elements</span>(panelA_plot) <span class="sc">+</span> panelB_plot <span class="sc">+</span></span>
<span id="cb59-67"><a href="#cb59-67" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&#39;collect&#39;</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.9</span>)) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">&amp;</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb59-68"><a href="#cb59-68" tabindex="-1"></a></span>
<span id="cb59-69"><a href="#cb59-69" tabindex="-1"></a><span class="co">#save PNG version</span></span>
<span id="cb59-70"><a href="#cb59-70" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb59-71"><a href="#cb59-71" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb59-72"><a href="#cb59-72" tabindex="-1"></a>                         today,</span>
<span id="cb59-73"><a href="#cb59-73" tabindex="-1"></a>                         <span class="st">&quot;_Fig5.png&quot;</span>),</span>
<span id="cb59-74"><a href="#cb59-74" tabindex="-1"></a>       plAB,</span>
<span id="cb59-75"><a href="#cb59-75" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb59-76"><a href="#cb59-76" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb59-77"><a href="#cb59-77" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb59-78"><a href="#cb59-78" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb59-79"><a href="#cb59-79" tabindex="-1"></a></span>
<span id="cb59-80"><a href="#cb59-80" tabindex="-1"></a><span class="co">#save PDF version</span></span>
<span id="cb59-81"><a href="#cb59-81" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb59-82"><a href="#cb59-82" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb59-83"><a href="#cb59-83" tabindex="-1"></a>                         today,</span>
<span id="cb59-84"><a href="#cb59-84" tabindex="-1"></a>                         <span class="st">&quot;_Fig5.pdf&quot;</span>),</span>
<span id="cb59-85"><a href="#cb59-85" tabindex="-1"></a>       plAB,</span>
<span id="cb59-86"><a href="#cb59-86" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb59-87"><a href="#cb59-87" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb59-88"><a href="#cb59-88" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>)</span></code></pre></div>
</div>
<div id="figure-7-examples-fits-for-chemicals-with-r-squared-and-within-2-fold" class="section level3" number="8.0.4">
<h3><span class="header-section-number">8.0.4</span> Figure 7: Examples
fits for chemicals with R-squared and within 2-fold</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk,</span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>           <span class="at">best_fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>           <span class="at">use_scale_conc =</span> <span class="fu">list</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>                                 <span class="at">log10_trans =</span> <span class="cn">FALSE</span>),</span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a>           <span class="at">drop_nonDetect =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" tabindex="-1"></a>cvt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(curation_set_tag <span class="sc">==</span> <span class="st">&quot;CVT_Showa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-9"><a href="#cb60-9" tabindex="-1"></a>  <span class="fu">pull</span>(analyte_dtxsid) <span class="ot">-&gt;</span> Showa_chems</span>
<span id="cb60-10"><a href="#cb60-10" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" tabindex="-1"></a>my_rsq <span class="ot">&lt;-</span> <span class="fu">rsq</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>)</span>
<span id="cb60-13"><a href="#cb60-13" tabindex="-1"></a>my_rsq <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(winmodel) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID2020139&quot;</span>,</span>
<span id="cb60-14"><a href="#cb60-14" tabindex="-1"></a>                            <span class="st">&quot;DTXSID4023917&quot;</span>,</span>
<span id="cb60-15"><a href="#cb60-15" tabindex="-1"></a>                            <span class="st">&quot;DTXSID3061635&quot;</span>,</span>
<span id="cb60-16"><a href="#cb60-16" tabindex="-1"></a>                            <span class="st">&quot;DTXSID8030760&quot;</span>))</span>
<span id="cb60-17"><a href="#cb60-17" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" tabindex="-1"></a><span class="co">#High rsq: DTXSID2020139 and DTXSID4023917</span></span>
<span id="cb60-19"><a href="#cb60-19" tabindex="-1"></a><span class="co">#Low rsq: DTXSID3061635 and DTXSID8030760</span></span>
<span id="cb60-20"><a href="#cb60-20" tabindex="-1"></a></span>
<span id="cb60-21"><a href="#cb60-21" tabindex="-1"></a>fe_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID2020139&quot;</span>,</span>
<span id="cb60-22"><a href="#cb60-22" tabindex="-1"></a>                                  <span class="st">&quot;DTXSID4023917&quot;</span>,</span>
<span id="cb60-23"><a href="#cb60-23" tabindex="-1"></a>                                  <span class="st">&quot;DTXSID3061635&quot;</span>,</span>
<span id="cb60-24"><a href="#cb60-24" tabindex="-1"></a>                                  <span class="st">&quot;DTXSID8030760&quot;</span>), Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Chemical, Species) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">frac_2fold =</span> <span class="fu">sum</span>(Fold_Error <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> Fold_Error <span class="sc">&gt;</span> <span class="fl">0.5</span>)<span class="sc">/</span><span class="fu">n</span>())</span>
<span id="cb60-25"><a href="#cb60-25" tabindex="-1"></a></span>
<span id="cb60-26"><a href="#cb60-26" tabindex="-1"></a><span class="co"># # A tibble: 4 × 3</span></span>
<span id="cb60-27"><a href="#cb60-27" tabindex="-1"></a><span class="co"># # Groups:   Chemical [4]</span></span>
<span id="cb60-28"><a href="#cb60-28" tabindex="-1"></a><span class="co">#   Chemical      Species frac_2fold</span></span>
<span id="cb60-29"><a href="#cb60-29" tabindex="-1"></a><span class="co">#   &lt;chr&gt;         &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span id="cb60-30"><a href="#cb60-30" tabindex="-1"></a><span class="co"># 1 DTXSID2020139 rat          0.271</span></span>
<span id="cb60-31"><a href="#cb60-31" tabindex="-1"></a><span class="co"># 2 DTXSID3061635 rat          0.125</span></span>
<span id="cb60-32"><a href="#cb60-32" tabindex="-1"></a><span class="co"># 3 DTXSID4023917 rat          0.953</span></span>
<span id="cb60-33"><a href="#cb60-33" tabindex="-1"></a><span class="co"># 4 DTXSID8030760 rat          0.778</span></span>
<span id="cb60-34"><a href="#cb60-34" tabindex="-1"></a></span>
<span id="cb60-35"><a href="#cb60-35" tabindex="-1"></a><span class="co">#High frac 2fold: DTXSID4023917 and DTXSID8030760</span></span>
<span id="cb60-36"><a href="#cb60-36" tabindex="-1"></a><span class="co">#Low frac 2fold: DTXSID2020139 and DTXSID3061635</span></span>
<span id="cb60-37"><a href="#cb60-37" tabindex="-1"></a></span>
<span id="cb60-38"><a href="#cb60-38" tabindex="-1"></a>pl_sub <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span></span>
<span id="cb60-39"><a href="#cb60-39" tabindex="-1"></a>  <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID2020139&quot;</span>,</span>
<span id="cb60-40"><a href="#cb60-40" tabindex="-1"></a>                         <span class="st">&quot;DTXSID4023917&quot;</span>,</span>
<span id="cb60-41"><a href="#cb60-41" tabindex="-1"></a>                         <span class="st">&quot;DTXSID3061635&quot;</span>,</span>
<span id="cb60-42"><a href="#cb60-42" tabindex="-1"></a>                         <span class="st">&quot;DTXSID8030760&quot;</span>),</span>
<span id="cb60-43"><a href="#cb60-43" tabindex="-1"></a>         Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>) </span>
<span id="cb60-44"><a href="#cb60-44" tabindex="-1"></a></span>
<span id="cb60-45"><a href="#cb60-45" tabindex="-1"></a>ex_fits <span class="ot">&lt;-</span> pl_sub <span class="sc">%&gt;%</span></span>
<span id="cb60-46"><a href="#cb60-46" tabindex="-1"></a>  <span class="fu">pull</span>(final_plot)</span>
<span id="cb60-47"><a href="#cb60-47" tabindex="-1"></a>ex_fits <span class="ot">&lt;-</span> <span class="fu">set_names</span>(ex_fits,</span>
<span id="cb60-48"><a href="#cb60-48" tabindex="-1"></a>          pl_sub<span class="sc">$</span>Chemical)</span>
<span id="cb60-49"><a href="#cb60-49" tabindex="-1"></a></span>
<span id="cb60-50"><a href="#cb60-50" tabindex="-1"></a></span>
<span id="cb60-51"><a href="#cb60-51" tabindex="-1"></a></span>
<span id="cb60-52"><a href="#cb60-52" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(</span>
<span id="cb60-53"><a href="#cb60-53" tabindex="-1"></a>  <span class="co">#Low frac 2fold and high Rsq</span></span>
<span id="cb60-54"><a href="#cb60-54" tabindex="-1"></a>  ex_fits[[<span class="st">&quot;DTXSID2020139&quot;</span>]] <span class="sc">+</span></span>
<span id="cb60-55"><a href="#cb60-55" tabindex="-1"></a>                                     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#a6bddb&quot;</span>,</span>
<span id="cb60-56"><a href="#cb60-56" tabindex="-1"></a>                                                                   <span class="st">&quot;#74a9cf&quot;</span>,</span>
<span id="cb60-57"><a href="#cb60-57" tabindex="-1"></a>                                                                   <span class="st">&quot;#41bbc4&quot;</span>,</span>
<span id="cb60-58"><a href="#cb60-58" tabindex="-1"></a>                                                                   <span class="st">&quot;#2b8cbe&quot;</span>,</span>
<span id="cb60-59"><a href="#cb60-59" tabindex="-1"></a>                                                                   <span class="st">&quot;#045a8d&quot;</span>)) <span class="sc">+</span></span>
<span id="cb60-60"><a href="#cb60-60" tabindex="-1"></a>                                     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-61"><a href="#cb60-61" tabindex="-1"></a>                                     <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb60-62"><a href="#cb60-62" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;A: DTXSID2020139 rat&quot;</span>),</span>
<span id="cb60-63"><a href="#cb60-63" tabindex="-1"></a>  <span class="co">#high frac 2fold and high Rsq</span></span>
<span id="cb60-64"><a href="#cb60-64" tabindex="-1"></a>                                   ex_fits[[<span class="st">&quot;DTXSID4023917&quot;</span>]] <span class="sc">+</span></span>
<span id="cb60-65"><a href="#cb60-65" tabindex="-1"></a>                                     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,</span>
<span id="cb60-66"><a href="#cb60-66" tabindex="-1"></a>                                                                   <span class="st">&quot;grey40&quot;</span>)) <span class="sc">+</span></span>
<span id="cb60-67"><a href="#cb60-67" tabindex="-1"></a>                                     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-68"><a href="#cb60-68" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;B: DTXSID4023917 rat&quot;</span>),</span>
<span id="cb60-69"><a href="#cb60-69" tabindex="-1"></a>  </span>
<span id="cb60-70"><a href="#cb60-70" tabindex="-1"></a>  <span class="co">#low frac 2fold and low rsq</span></span>
<span id="cb60-71"><a href="#cb60-71" tabindex="-1"></a>                                    ex_fits[[<span class="st">&quot;DTXSID3061635&quot;</span>]] <span class="sc">+</span></span>
<span id="cb60-72"><a href="#cb60-72" tabindex="-1"></a>                                     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#006837&quot;</span>)) <span class="sc">+</span></span>
<span id="cb60-73"><a href="#cb60-73" tabindex="-1"></a>                                     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-74"><a href="#cb60-74" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;C: DTXSID3061635 rat&quot;</span>),</span>
<span id="cb60-75"><a href="#cb60-75" tabindex="-1"></a>  </span>
<span id="cb60-76"><a href="#cb60-76" tabindex="-1"></a>  <span class="co">#high frac2fold and low rsq</span></span>
<span id="cb60-77"><a href="#cb60-77" tabindex="-1"></a>                                   ex_fits[[<span class="st">&quot;DTXSID8030760&quot;</span>]] <span class="sc">+</span></span>
<span id="cb60-78"><a href="#cb60-78" tabindex="-1"></a>                                     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">&quot;magenta3&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-79"><a href="#cb60-79" tabindex="-1"></a>                                     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-80"><a href="#cb60-80" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;D: DTXSID8030760 rat&quot;</span>)</span>
<span id="cb60-81"><a href="#cb60-81" tabindex="-1"></a>                                  ),</span>
<span id="cb60-82"><a href="#cb60-82" tabindex="-1"></a>                   <span class="at">scale =</span> <span class="fl">0.85</span>)</span>
<span id="cb60-83"><a href="#cb60-83" tabindex="-1"></a></span>
<span id="cb60-84"><a href="#cb60-84" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb60-85"><a href="#cb60-85" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb60-86"><a href="#cb60-86" tabindex="-1"></a>                         today,</span>
<span id="cb60-87"><a href="#cb60-87" tabindex="-1"></a>                         <span class="st">&quot;_Fig7.png&quot;</span>),</span>
<span id="cb60-88"><a href="#cb60-88" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">12</span>,</span>
<span id="cb60-89"><a href="#cb60-89" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb60-90"><a href="#cb60-90" tabindex="-1"></a></span>
<span id="cb60-91"><a href="#cb60-91" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb60-92"><a href="#cb60-92" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb60-93"><a href="#cb60-93" tabindex="-1"></a>                         today,</span>
<span id="cb60-94"><a href="#cb60-94" tabindex="-1"></a>                         <span class="st">&quot;_Fig7.pdf&quot;</span>),</span>
<span id="cb60-95"><a href="#cb60-95" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">12</span>,</span>
<span id="cb60-96"><a href="#cb60-96" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>)</span></code></pre></div>
<div id="supp.-fig-8-plots-of-the-five-data-groups-that-were-best-fit-by-the-null-model" class="section level4" number="8.0.4.1">
<h4><span class="header-section-number">8.0.4.1</span> Supp. Fig 8:
plots of the five data groups that were best fit by the null model</h4>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>flat_chems <span class="ot">&lt;-</span> winmodel <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="st">&quot;model_flat&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species)</span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a><span class="fu">print</span>(flat_chems)</span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk,</span>
<span id="cb61-7"><a href="#cb61-7" tabindex="-1"></a><span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb61-8"><a href="#cb61-8" tabindex="-1"></a><span class="at">best_fit =</span> <span class="cn">FALSE</span>,</span>
<span id="cb61-9"><a href="#cb61-9" tabindex="-1"></a><span class="at">use_scale_conc =</span> <span class="fu">list</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-10"><a href="#cb61-10" tabindex="-1"></a><span class="at">log10_trans =</span> <span class="cn">FALSE</span>),</span>
<span id="cb61-11"><a href="#cb61-11" tabindex="-1"></a><span class="at">drop_nonDetect =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-12"><a href="#cb61-12" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" tabindex="-1"></a>flat_fits <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> </span>
<span id="cb61-14"><a href="#cb61-14" tabindex="-1"></a>  <span class="fu">inner_join</span>(flat_chems) <span class="sc">%&gt;%</span></span>
<span id="cb61-15"><a href="#cb61-15" tabindex="-1"></a>                              <span class="fu">pull</span>(final_plot)</span>
<span id="cb61-16"><a href="#cb61-16" tabindex="-1"></a></span>
<span id="cb61-17"><a href="#cb61-17" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> flat_fits)</span>
<span id="cb61-18"><a href="#cb61-18" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb61-20"><a href="#cb61-20" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb61-21"><a href="#cb61-21" tabindex="-1"></a>                         today,</span>
<span id="cb61-22"><a href="#cb61-22" tabindex="-1"></a>                         <span class="st">&quot;_Supp_Fig8.pdf&quot;</span>),</span>
<span id="cb61-23"><a href="#cb61-23" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb61-24"><a href="#cb61-24" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">16</span>,</span>
<span id="cb61-25"><a href="#cb61-25" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb61-26"><a href="#cb61-26" tabindex="-1"></a></span>
<span id="cb61-27"><a href="#cb61-27" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb61-28"><a href="#cb61-28" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb61-29"><a href="#cb61-29" tabindex="-1"></a>                         today,</span>
<span id="cb61-30"><a href="#cb61-30" tabindex="-1"></a>                         <span class="st">&quot;_Supp_Fig8.png&quot;</span>),</span>
<span id="cb61-31"><a href="#cb61-31" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb61-32"><a href="#cb61-32" tabindex="-1"></a>       <span class="at">height =</span><span class="dv">8</span>,</span>
<span id="cb61-33"><a href="#cb61-33" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">16</span>,</span>
<span id="cb61-34"><a href="#cb61-34" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb61-35"><a href="#cb61-35" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="figure-6-comparing-derived-tk-stats-with-human-tk-stats-from-lombardo-et-al." class="section level3" number="8.0.5">
<h3><span class="header-section-number">8.0.5</span> Figure 6: Comparing
derived TK stats with human TK stats from Lombardo et al.</h3>
<p>This meta-analysis compares the TK stats from model fits with other
published studies.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>cvt_DTXSIDs <span class="ot">&lt;-</span> <span class="fu">unique</span>(my_pk<span class="sc">$</span>data<span class="sc">$</span>Chemical)</span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a><span class="co"># First things first, let&#39;s load the data from Lombardo et al.</span></span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>lombardo <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(</span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a>         <span class="st">&quot;Lombardo2018-Supplemental_82966_revised_corrected.xlsx&quot;</span>),</span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">8</span>)</span>
<span id="cb62-7"><a href="#cb62-7" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" tabindex="-1"></a><span class="co">#use ctxR to search the Dashboard for DTXSIDs corresponding to these CASRNs</span></span>
<span id="cb62-9"><a href="#cb62-9" tabindex="-1"></a>lombardo_dtxsid <span class="ot">&lt;-</span> ctxR<span class="sc">::</span><span class="fu">chemical_equal_batch</span>(</span>
<span id="cb62-10"><a href="#cb62-10" tabindex="-1"></a>  <span class="at">word_list =</span> <span class="fu">unique</span>(lombardo<span class="sc">$</span><span class="st">`</span><span class="at">CAS #</span><span class="st">`</span>)</span>
<span id="cb62-11"><a href="#cb62-11" tabindex="-1"></a>)</span>
<span id="cb62-12"><a href="#cb62-12" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" tabindex="-1"></a><span class="co">#merge in the DTXSIDs</span></span>
<span id="cb62-14"><a href="#cb62-14" tabindex="-1"></a>lombardo <span class="ot">&lt;-</span> lombardo <span class="sc">%&gt;%</span></span>
<span id="cb62-15"><a href="#cb62-15" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">left_join</span>(lombardo_dtxsid<span class="sc">$</span>valid <span class="sc">%&gt;%</span></span>
<span id="cb62-16"><a href="#cb62-16" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">select</span>(searchValue, dtxsid, preferredName),</span>
<span id="cb62-17"><a href="#cb62-17" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;CAS #&quot;</span> <span class="ot">=</span> <span class="st">&quot;searchValue&quot;</span>))</span>
<span id="cb62-18"><a href="#cb62-18" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" tabindex="-1"></a><span class="co">#any left unidentified: search by name</span></span>
<span id="cb62-20"><a href="#cb62-20" tabindex="-1"></a>lombardo_missing <span class="ot">&lt;-</span> lombardo <span class="sc">%&gt;%</span></span>
<span id="cb62-21"><a href="#cb62-21" tabindex="-1"></a>  dplyr<span class="sc">::</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(dtxsid))</span>
<span id="cb62-22"><a href="#cb62-22" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" tabindex="-1"></a>missing_names <span class="ot">&lt;-</span> lombardo_missing <span class="sc">%&gt;%</span></span>
<span id="cb62-24"><a href="#cb62-24" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">pull</span>(Name)</span>
<span id="cb62-25"><a href="#cb62-25" tabindex="-1"></a></span>
<span id="cb62-26"><a href="#cb62-26" tabindex="-1"></a>lombardo_dtxsid_name <span class="ot">&lt;-</span> ctxR<span class="sc">::</span><span class="fu">chemical_equal_batch</span>(</span>
<span id="cb62-27"><a href="#cb62-27" tabindex="-1"></a>  <span class="at">word_list =</span> <span class="fu">unique</span>(missing_names)</span>
<span id="cb62-28"><a href="#cb62-28" tabindex="-1"></a>)</span>
<span id="cb62-29"><a href="#cb62-29" tabindex="-1"></a></span>
<span id="cb62-30"><a href="#cb62-30" tabindex="-1"></a>lombardo_missing <span class="ot">&lt;-</span> lombardo_missing <span class="sc">%&gt;%</span></span>
<span id="cb62-31"><a href="#cb62-31" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">left_join</span>(lombardo_dtxsid_name<span class="sc">$</span>valid <span class="sc">%&gt;%</span> </span>
<span id="cb62-32"><a href="#cb62-32" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">select</span>(searchValue, dtxsid, preferredName),</span>
<span id="cb62-33"><a href="#cb62-33" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span> <span class="ot">=</span> <span class="st">&quot;searchValue&quot;</span>) )</span>
<span id="cb62-34"><a href="#cb62-34" tabindex="-1"></a></span>
<span id="cb62-35"><a href="#cb62-35" tabindex="-1"></a>lombardo <span class="ot">&lt;-</span>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(lombardo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dtxsid)),</span>
<span id="cb62-36"><a href="#cb62-36" tabindex="-1"></a>                      lombardo_missing)</span>
<span id="cb62-37"><a href="#cb62-37" tabindex="-1"></a></span>
<span id="cb62-38"><a href="#cb62-38" tabindex="-1"></a>lombard_abbr <span class="ot">&lt;-</span> lombardo <span class="sc">%&gt;%</span></span>
<span id="cb62-39"><a href="#cb62-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dtxsid,</span>
<span id="cb62-40"><a href="#cb62-40" tabindex="-1"></a>                preferredName,</span>
<span id="cb62-41"><a href="#cb62-41" tabindex="-1"></a>                <span class="at">Vss =</span> <span class="st">`</span><span class="at">human VDss (L/kg)</span><span class="st">`</span>,</span>
<span id="cb62-42"><a href="#cb62-42" tabindex="-1"></a>                <span class="at">CLtot =</span> <span class="st">`</span><span class="at">human CL (mL/min/kg)</span><span class="st">`</span>,</span>
<span id="cb62-43"><a href="#cb62-43" tabindex="-1"></a>                <span class="at">halflife =</span> <span class="st">`</span><span class="at">terminal  t1/2 (h)</span><span class="st">`</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb62-44"><a href="#cb62-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Species =</span> <span class="st">&#39;human&#39;</span>,</span>
<span id="cb62-45"><a href="#cb62-45" tabindex="-1"></a>                <span class="at">source =</span> <span class="st">&quot;Lombardo et al.&quot;</span>,</span>
<span id="cb62-46"><a href="#cb62-46" tabindex="-1"></a>                <span class="at">CLtot =</span> CLtot<span class="sc">*</span><span class="dv">60</span><span class="sc">/</span><span class="dv">1000</span> <span class="co"># Lombardo reports this as mL/min/kg, need L/h/kg</span></span>
<span id="cb62-47"><a href="#cb62-47" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-48"><a href="#cb62-48" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">arrange</span>(halflife)</span>
<span id="cb62-49"><a href="#cb62-49" tabindex="-1"></a></span>
<span id="cb62-50"><a href="#cb62-50" tabindex="-1"></a>my_pk_vals <span class="ot">&lt;-</span> my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb62-51"><a href="#cb62-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">dtxsid =</span> Chemical,</span>
<span id="cb62-52"><a href="#cb62-52" tabindex="-1"></a>                Species,</span>
<span id="cb62-53"><a href="#cb62-53" tabindex="-1"></a>                model,</span>
<span id="cb62-54"><a href="#cb62-54" tabindex="-1"></a>                <span class="at">halflife =</span> halflife.tkstats,</span>
<span id="cb62-55"><a href="#cb62-55" tabindex="-1"></a>                <span class="at">Vss =</span> Vss.tkstats,</span>
<span id="cb62-56"><a href="#cb62-56" tabindex="-1"></a>                <span class="at">CLtot =</span> CLtot.tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb62-57"><a href="#cb62-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-58"><a href="#cb62-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">&quot;invivoPKfit&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-59"><a href="#cb62-59" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(model <span class="sc">!=</span> <span class="st">&quot;model_flat&quot;</span>,</span>
<span id="cb62-60"><a href="#cb62-60" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">is.na</span>(halflife))</span>
<span id="cb62-61"><a href="#cb62-61" tabindex="-1"></a></span>
<span id="cb62-62"><a href="#cb62-62" tabindex="-1"></a>lombardo_inner <span class="ot">&lt;-</span> my_pk_vals <span class="sc">%&gt;%</span></span>
<span id="cb62-63"><a href="#cb62-63" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">inner_join</span>(lombard_abbr, <span class="at">by =</span> <span class="st">&quot;dtxsid&quot;</span>)</span>
<span id="cb62-64"><a href="#cb62-64" tabindex="-1"></a><span class="co">#79 chemicals in common</span></span>
<span id="cb62-65"><a href="#cb62-65" tabindex="-1"></a></span>
<span id="cb62-66"><a href="#cb62-66" tabindex="-1"></a>lombardo_comparison <span class="ot">&lt;-</span>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(lombard_abbr <span class="sc">%&gt;%</span></span>
<span id="cb62-67"><a href="#cb62-67" tabindex="-1"></a>                                    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb62-68"><a href="#cb62-68" tabindex="-1"></a>                                     dtxsid <span class="sc">%in%</span></span>
<span id="cb62-69"><a href="#cb62-69" tabindex="-1"></a>                                       lombardo_inner<span class="sc">$</span>dtxsid</span>
<span id="cb62-70"><a href="#cb62-70" tabindex="-1"></a>                                   ),</span>
<span id="cb62-71"><a href="#cb62-71" tabindex="-1"></a>                                 my_pk_vals <span class="sc">%&gt;%</span></span>
<span id="cb62-72"><a href="#cb62-72" tabindex="-1"></a>                                    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb62-73"><a href="#cb62-73" tabindex="-1"></a>                                     dtxsid <span class="sc">%in%</span></span>
<span id="cb62-74"><a href="#cb62-74" tabindex="-1"></a>                                       lombardo_inner<span class="sc">$</span>dtxsid</span>
<span id="cb62-75"><a href="#cb62-75" tabindex="-1"></a>                                   )</span>
<span id="cb62-76"><a href="#cb62-76" tabindex="-1"></a>)</span>
<span id="cb62-77"><a href="#cb62-77" tabindex="-1"></a></span>
<span id="cb62-78"><a href="#cb62-78" tabindex="-1"></a><span class="co">#merge in chemical names</span></span>
<span id="cb62-79"><a href="#cb62-79" tabindex="-1"></a></span>
<span id="cb62-80"><a href="#cb62-80" tabindex="-1"></a><span class="co">#get preferred names by DTXSID</span></span>
<span id="cb62-81"><a href="#cb62-81" tabindex="-1"></a>all_details <span class="ot">&lt;-</span> ctxR<span class="sc">::</span><span class="fu">get_chemical_details_batch</span>(</span>
<span id="cb62-82"><a href="#cb62-82" tabindex="-1"></a>  <span class="fu">unique</span>(lombardo_comparison<span class="sc">$</span>dtxsid)</span>
<span id="cb62-83"><a href="#cb62-83" tabindex="-1"></a>)</span>
<span id="cb62-84"><a href="#cb62-84" tabindex="-1"></a></span>
<span id="cb62-85"><a href="#cb62-85" tabindex="-1"></a>lombardo_comparison <span class="ot">&lt;-</span> lombardo_comparison <span class="sc">%&gt;%</span></span>
<span id="cb62-86"><a href="#cb62-86" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>preferredName) <span class="sc">%&gt;%</span></span>
<span id="cb62-87"><a href="#cb62-87" tabindex="-1"></a>  <span class="fu">left_join</span>(all_details <span class="sc">%&gt;%</span> <span class="fu">select</span>(dtxsid, preferredName))</span>
<span id="cb62-88"><a href="#cb62-88" tabindex="-1"></a></span>
<span id="cb62-89"><a href="#cb62-89" tabindex="-1"></a><span class="co">#create a factor variable for chemical names that sorts chemicals from highest to lowest Lombardo halflife</span></span>
<span id="cb62-90"><a href="#cb62-90" tabindex="-1"></a></span>
<span id="cb62-91"><a href="#cb62-91" tabindex="-1"></a>chemnames_levels <span class="ot">&lt;-</span> lombardo_comparison <span class="sc">%&gt;%</span></span>
<span id="cb62-92"><a href="#cb62-92" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(source <span class="sc">%in%</span> <span class="st">&quot;Lombardo et al.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-93"><a href="#cb62-93" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">arrange</span>(halflife) <span class="sc">%&gt;%</span></span>
<span id="cb62-94"><a href="#cb62-94" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">pull</span>(preferredName)</span>
<span id="cb62-95"><a href="#cb62-95" tabindex="-1"></a></span>
<span id="cb62-96"><a href="#cb62-96" tabindex="-1"></a></span>
<span id="cb62-97"><a href="#cb62-97" tabindex="-1"></a>lombardo_comparison <span class="ot">&lt;-</span> lombardo_comparison <span class="sc">%&gt;%</span></span>
<span id="cb62-98"><a href="#cb62-98" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">preferredName =</span> <span class="fu">factor</span>(preferredName,</span>
<span id="cb62-99"><a href="#cb62-99" tabindex="-1"></a>                                <span class="at">levels =</span> chemnames_levels))</span>
<span id="cb62-100"><a href="#cb62-100" tabindex="-1"></a></span>
<span id="cb62-101"><a href="#cb62-101" tabindex="-1"></a><span class="co">#get invivoPKfit species for plot-splitting purposes</span></span>
<span id="cb62-102"><a href="#cb62-102" tabindex="-1"></a>ivpk_species <span class="ot">&lt;-</span> lombardo_comparison <span class="sc">%&gt;%</span></span>
<span id="cb62-103"><a href="#cb62-103" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(source <span class="sc">%in%</span> <span class="st">&quot;invivoPKfit&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-104"><a href="#cb62-104" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(dtxsid, Species) <span class="sc">%&gt;%</span></span>
<span id="cb62-105"><a href="#cb62-105" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">invivopkfit_species =</span> Species)</span>
<span id="cb62-106"><a href="#cb62-106" tabindex="-1"></a></span>
<span id="cb62-107"><a href="#cb62-107" tabindex="-1"></a>lombardo_comparison <span class="ot">&lt;-</span> lombardo_comparison <span class="sc">%&gt;%</span></span>
<span id="cb62-108"><a href="#cb62-108" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(ivpk_species,</span>
<span id="cb62-109"><a href="#cb62-109" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&quot;dtxsid&quot;</span>)</span>
<span id="cb62-110"><a href="#cb62-110" tabindex="-1"></a></span>
<span id="cb62-111"><a href="#cb62-111" tabindex="-1"></a><span class="co">#reshape longer and plot</span></span>
<span id="cb62-112"><a href="#cb62-112" tabindex="-1"></a>lombardo_comparison <span class="sc">%&gt;%</span></span>
<span id="cb62-113"><a href="#cb62-113" tabindex="-1"></a>   tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;Vss&quot;</span>, <span class="st">&quot;CLtot&quot;</span>, <span class="st">&quot;halflife&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb62-114"><a href="#cb62-114" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb62-115"><a href="#cb62-115" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;halflife&quot;</span>, <span class="st">&quot;Vss&quot;</span>, <span class="st">&quot;CLtot&quot;</span>)</span>
<span id="cb62-116"><a href="#cb62-116" tabindex="-1"></a>                               )</span>
<span id="cb62-117"><a href="#cb62-117" tabindex="-1"></a>                 ) <span class="sc">%&gt;%</span></span>
<span id="cb62-118"><a href="#cb62-118" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb62-119"><a href="#cb62-119" tabindex="-1"></a>    <span class="at">x =</span> value,</span>
<span id="cb62-120"><a href="#cb62-120" tabindex="-1"></a>    <span class="at">y =</span> preferredName</span>
<span id="cb62-121"><a href="#cb62-121" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb62-122"><a href="#cb62-122" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> source,</span>
<span id="cb62-123"><a href="#cb62-123" tabindex="-1"></a>                 <span class="at">color =</span> source),</span>
<span id="cb62-124"><a href="#cb62-124" tabindex="-1"></a>             <span class="co">#position = position_dodge(0.7),</span></span>
<span id="cb62-125"><a href="#cb62-125" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">5</span><span class="sc">/</span>.pt, <span class="at">stroke =</span> <span class="fl">2.5</span><span class="sc">/</span>.pt) <span class="sc">+</span></span>
<span id="cb62-126"><a href="#cb62-126" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(name),</span>
<span id="cb62-127"><a href="#cb62-127" tabindex="-1"></a>             <span class="at">rows =</span> <span class="fu">vars</span>(invivopkfit_species),</span>
<span id="cb62-128"><a href="#cb62-128" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb62-129"><a href="#cb62-129" tabindex="-1"></a>             <span class="at">space =</span>  <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb62-130"><a href="#cb62-130" tabindex="-1"></a>             <span class="at">drop =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb62-131"><a href="#cb62-131" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>( <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10)) <span class="sc">+</span></span>
<span id="cb62-132"><a href="#cb62-132" tabindex="-1"></a>  <span class="co">#annotation_logticks(sides = &quot;b&quot;) +</span></span>
<span id="cb62-133"><a href="#cb62-133" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Lombardo et al.&quot;</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb62-134"><a href="#cb62-134" tabindex="-1"></a>                                <span class="st">&quot;invivoPKfit&quot;</span> <span class="ot">=</span> <span class="dv">22</span>)) <span class="sc">+</span></span>
<span id="cb62-135"><a href="#cb62-135" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#d95f02&quot;</span>, <span class="st">&quot;#1b9e77&quot;</span>)) <span class="sc">+</span></span>
<span id="cb62-136"><a href="#cb62-136" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">x =</span> <span class="st">&quot;axis_logticks&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-137"><a href="#cb62-137" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb62-138"><a href="#cb62-138" tabindex="-1"></a>                                    <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb62-139"><a href="#cb62-139" tabindex="-1"></a>                                    <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb62-140"><a href="#cb62-140" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-141"><a href="#cb62-141" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb62-142"><a href="#cb62-142" tabindex="-1"></a>         <span class="at">panel.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;line&quot;</span>),</span>
<span id="cb62-143"><a href="#cb62-143" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb62-144"><a href="#cb62-144" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb62-145"><a href="#cb62-145" tabindex="-1"></a>       <span class="at">strip.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-146"><a href="#cb62-146" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb62-147"><a href="#cb62-147" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-148"><a href="#cb62-148" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-149"><a href="#cb62-149" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb62-150"><a href="#cb62-150" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb62-151"><a href="#cb62-151" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-152"><a href="#cb62-152" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-153"><a href="#cb62-153" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb62-154"><a href="#cb62-154" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-155"><a href="#cb62-155" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb62-156"><a href="#cb62-156" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>())</span>
<span id="cb62-157"><a href="#cb62-157" tabindex="-1"></a></span>
<span id="cb62-158"><a href="#cb62-158" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb62-159"><a href="#cb62-159" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb62-160"><a href="#cb62-160" tabindex="-1"></a>                         today,</span>
<span id="cb62-161"><a href="#cb62-161" tabindex="-1"></a>                         <span class="st">&quot;_Fig6.png&quot;</span>),</span>
<span id="cb62-162"><a href="#cb62-162" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">11</span>,</span>
<span id="cb62-163"><a href="#cb62-163" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb62-164"><a href="#cb62-164" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb62-165"><a href="#cb62-165" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb62-166"><a href="#cb62-166" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb62-167"><a href="#cb62-167" tabindex="-1"></a></span>
<span id="cb62-168"><a href="#cb62-168" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb62-169"><a href="#cb62-169" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb62-170"><a href="#cb62-170" tabindex="-1"></a>                         today,</span>
<span id="cb62-171"><a href="#cb62-171" tabindex="-1"></a>                         <span class="st">&quot;_Fig6.pdf&quot;</span>),</span>
<span id="cb62-172"><a href="#cb62-172" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">11</span>,</span>
<span id="cb62-173"><a href="#cb62-173" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb62-174"><a href="#cb62-174" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-9-fgutabs-comparison-with-literature-values-compiled-by-musther-et-al.-2014" class="section level3" number="8.0.6">
<h3><span class="header-section-number">8.0.6</span> Supp. Fig. 9:
Fgutabs comparison with literature values compiled by Musther et
al. (2014)</h3>
<p>Compare with literature values of Fgutabs from the supplemental
material of Musther et al. 2014.</p>
<p>Read in these literature values and reshape them to prepare for
fitting.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>species_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">&quot;Mouse&quot;</span>,</span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Dosing Formulation&quot;</span>,</span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a>                    <span class="st">&quot;Strain&quot;</span>,</span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a>                    <span class="st">&quot;Sex&quot;</span>,</span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a>                    <span class="st">&quot;F% Mean&quot;</span>,</span>
<span id="cb63-6"><a href="#cb63-6" tabindex="-1"></a>                    <span class="st">&quot;F% Range&quot;</span>),</span>
<span id="cb63-7"><a href="#cb63-7" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>),</span>
<span id="cb63-8"><a href="#cb63-8" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Rat&quot;</span>,</span>
<span id="cb63-10"><a href="#cb63-10" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Dosing Formulation&quot;</span>,</span>
<span id="cb63-11"><a href="#cb63-11" tabindex="-1"></a>                    <span class="st">&quot;Strain&quot;</span>,</span>
<span id="cb63-12"><a href="#cb63-12" tabindex="-1"></a>                    <span class="st">&quot;Sex&quot;</span>,</span>
<span id="cb63-13"><a href="#cb63-13" tabindex="-1"></a>                    <span class="st">&quot;F% Mean&quot;</span>,</span>
<span id="cb63-14"><a href="#cb63-14" tabindex="-1"></a>         <span class="st">&quot;WSD&quot;</span>,</span>
<span id="cb63-15"><a href="#cb63-15" tabindex="-1"></a>                    <span class="st">&quot;F% Range&quot;</span>),</span>
<span id="cb63-16"><a href="#cb63-16" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>),</span>
<span id="cb63-17"><a href="#cb63-17" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Dog&quot;</span>,</span>
<span id="cb63-19"><a href="#cb63-19" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Dosing Formulation&quot;</span>,</span>
<span id="cb63-20"><a href="#cb63-20" tabindex="-1"></a>                    <span class="st">&quot;Strain&quot;</span>,</span>
<span id="cb63-21"><a href="#cb63-21" tabindex="-1"></a>                    <span class="st">&quot;Sex&quot;</span>,</span>
<span id="cb63-22"><a href="#cb63-22" tabindex="-1"></a>                    <span class="st">&quot;F% Mean&quot;</span>,</span>
<span id="cb63-23"><a href="#cb63-23" tabindex="-1"></a>         <span class="st">&quot;WSD&quot;</span>,</span>
<span id="cb63-24"><a href="#cb63-24" tabindex="-1"></a>                    <span class="st">&quot;F% Range&quot;</span>),</span>
<span id="cb63-25"><a href="#cb63-25" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>),</span>
<span id="cb63-26"><a href="#cb63-26" tabindex="-1"></a></span>
<span id="cb63-27"><a href="#cb63-27" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Non-Human Primate&quot;</span>,</span>
<span id="cb63-28"><a href="#cb63-28" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Dosing Formulation&quot;</span>,</span>
<span id="cb63-29"><a href="#cb63-29" tabindex="-1"></a>                    <span class="st">&quot;Strain&quot;</span>,</span>
<span id="cb63-30"><a href="#cb63-30" tabindex="-1"></a>                    <span class="st">&quot;Sex&quot;</span>,</span>
<span id="cb63-31"><a href="#cb63-31" tabindex="-1"></a>                    <span class="st">&quot;F% Mean&quot;</span>,</span>
<span id="cb63-32"><a href="#cb63-32" tabindex="-1"></a>         <span class="st">&quot;WSD&quot;</span>,</span>
<span id="cb63-33"><a href="#cb63-33" tabindex="-1"></a>                    <span class="st">&quot;F% Range&quot;</span>),</span>
<span id="cb63-34"><a href="#cb63-34" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>),</span>
<span id="cb63-35"><a href="#cb63-35" tabindex="-1"></a></span>
<span id="cb63-36"><a href="#cb63-36" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Human&quot;</span>,</span>
<span id="cb63-37"><a href="#cb63-37" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Dosing Formulation&quot;</span>,</span>
<span id="cb63-38"><a href="#cb63-38" tabindex="-1"></a>                    <span class="st">&quot;Sex&quot;</span>,</span>
<span id="cb63-39"><a href="#cb63-39" tabindex="-1"></a>                    <span class="st">&quot;F% Mean&quot;</span>,</span>
<span id="cb63-40"><a href="#cb63-40" tabindex="-1"></a>         <span class="st">&quot;WSD&quot;</span>,</span>
<span id="cb63-41"><a href="#cb63-41" tabindex="-1"></a>                    <span class="st">&quot;F% Range&quot;</span>),</span>
<span id="cb63-42"><a href="#cb63-42" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb63-43"><a href="#cb63-43" tabindex="-1"></a>)</span>
<span id="cb63-44"><a href="#cb63-44" tabindex="-1"></a></span>
<span id="cb63-45"><a href="#cb63-45" tabindex="-1"></a></span>
<span id="cb63-46"><a href="#cb63-46" tabindex="-1"></a></span>
<span id="cb63-47"><a href="#cb63-47" tabindex="-1"></a>musther2014 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(</span>
<span id="cb63-48"><a href="#cb63-48" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb63-49"><a href="#cb63-49" tabindex="-1"></a>                <span class="st">&quot;SupTableMusther2014.xlsx&quot;</span>),</span>
<span id="cb63-50"><a href="#cb63-50" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">&quot;Sheet1&quot;</span>,</span>
<span id="cb63-51"><a href="#cb63-51" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">1</span>,</span>
<span id="cb63-52"><a href="#cb63-52" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="fu">c</span>( <span class="st">&quot;Compound&quot;</span>,</span>
<span id="cb63-53"><a href="#cb63-53" tabindex="-1"></a>                 <span class="st">&quot;CAS&quot;</span>,</span>
<span id="cb63-54"><a href="#cb63-54" tabindex="-1"></a>                 <span class="st">&quot;MW&quot;</span>, <span class="st">&quot;Ion Class&quot;</span>,</span>
<span id="cb63-55"><a href="#cb63-55" tabindex="-1"></a>               species_cols,</span>
<span id="cb63-56"><a href="#cb63-56" tabindex="-1"></a>                <span class="st">&quot;References.mouse&quot;</span>,</span>
<span id="cb63-57"><a href="#cb63-57" tabindex="-1"></a>                <span class="st">&quot;References.rat&quot;</span>,</span>
<span id="cb63-58"><a href="#cb63-58" tabindex="-1"></a>                <span class="st">&quot;References.dog&quot;</span>,</span>
<span id="cb63-59"><a href="#cb63-59" tabindex="-1"></a>                <span class="st">&quot;References.NHP&quot;</span>,</span>
<span id="cb63-60"><a href="#cb63-60" tabindex="-1"></a>                <span class="st">&quot;References.human&quot;</span></span>
<span id="cb63-61"><a href="#cb63-61" tabindex="-1"></a>                ),</span>
<span id="cb63-62"><a href="#cb63-62" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span></span>
<span id="cb63-63"><a href="#cb63-63" tabindex="-1"></a>  ) </span>
<span id="cb63-64"><a href="#cb63-64" tabindex="-1"></a></span>
<span id="cb63-65"><a href="#cb63-65" tabindex="-1"></a><span class="co">#pivot longer</span></span>
<span id="cb63-66"><a href="#cb63-66" tabindex="-1"></a>musther2014_long <span class="ot">&lt;-</span> musther2014 <span class="sc">%&gt;%</span></span>
<span id="cb63-67"><a href="#cb63-67" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Compound,</span>
<span id="cb63-68"><a href="#cb63-68" tabindex="-1"></a>           CAS,</span>
<span id="cb63-69"><a href="#cb63-69" tabindex="-1"></a>         <span class="fu">contains</span>(<span class="st">&quot;F% Mean&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb63-70"><a href="#cb63-70" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span><span class="fu">c</span>(Compound, CAS),</span>
<span id="cb63-71"><a href="#cb63-71" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;Species&quot;</span>, <span class="st">&quot;stat&quot;</span>),</span>
<span id="cb63-72"><a href="#cb63-72" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-73"><a href="#cb63-73" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">gsub</span>(<span class="at">x=</span>value,</span>
<span id="cb63-74"><a href="#cb63-74" tabindex="-1"></a>                      <span class="at">pattern =</span> <span class="st">&quot;&lt;&quot;</span>,</span>
<span id="cb63-75"><a href="#cb63-75" tabindex="-1"></a>                      <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb63-76"><a href="#cb63-76" tabindex="-1"></a>         <span class="at">value_num =</span> <span class="fu">as.numeric</span>(value))</span></code></pre></div>
<p>Use <code>ctxR</code> to get DTXSIDs from CAS number.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a>musther2014_dtxsid <span class="ot">&lt;-</span> ctxR<span class="sc">::</span><span class="fu">chemical_equal_batch</span>(<span class="at">word_list =</span> <span class="fu">unique</span>(musther2014_long<span class="sc">$</span>CAS))</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>musther2014_long <span class="ot">&lt;-</span> musther2014_long <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>  <span class="fu">left_join</span>(musther2014_dtxsid<span class="sc">$</span>valid <span class="sc">%&gt;%</span> <span class="fu">select</span>(searchValue, dtxsid, preferredName),</span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;CAS&quot;</span> <span class="ot">=</span> <span class="st">&quot;searchValue&quot;</span>))</span></code></pre></div>
<p>Get Fgutabs estimates from the fitted <code>pk</code> object.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>fgutabs <span class="ot">&lt;-</span> <span class="fu">coef</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>   <span class="fu">semi_join</span>(winmodel) <span class="sc">%&gt;%</span> <span class="co">#keep only winning models</span></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fgutabs =</span> coefs_vector[<span class="st">&quot;Fgutabs&quot;</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Fgutabs))</span></code></pre></div>
<p>How many chemicals overlapped at all</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">intersect</span>(musther2014_long<span class="sc">$</span>dtxsid,</span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>                 <span class="fu">get_data</span>(my_pk)<span class="sc">$</span>Chemical))</span></code></pre></div>
<p>Join with the literature estimates, keeping only cases with data in
both tables</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>fgutabs_pk_musther <span class="ot">&lt;-</span> fgutabs <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(musther2014_long,</span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>                                             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Chemical&quot;</span> <span class="ot">=</span> <span class="st">&quot;dtxsid&quot;</span>))</span></code></pre></div>
<p>Make a plot:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="co">#capitalize invivopkfit species to harmonize with Musther</span></span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a>fgutabs_pk_musther <span class="ot">&lt;-</span> fgutabs_pk_musther <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Species.x =</span>  stringr<span class="sc">::</span><span class="fu">str_to_sentence</span>(Species.x))</span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" tabindex="-1"></a><span class="fu">ggplot</span>(fgutabs_pk_musther) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> preferredName,</span>
<span id="cb68-7"><a href="#cb68-7" tabindex="-1"></a>                 <span class="at">x =</span> Fgutabs,</span>
<span id="cb68-8"><a href="#cb68-8" tabindex="-1"></a>                 <span class="at">shape =</span> Species.x,</span>
<span id="cb68-9"><a href="#cb68-9" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;invivopkfit&quot;</span>),</span>
<span id="cb68-10"><a href="#cb68-10" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">4</span>,</span>
<span id="cb68-11"><a href="#cb68-11" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-12"><a href="#cb68-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> preferredName,</span>
<span id="cb68-13"><a href="#cb68-13" tabindex="-1"></a>                 <span class="at">x =</span> value_num<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb68-14"><a href="#cb68-14" tabindex="-1"></a>                 <span class="at">shape =</span> Species.y,</span>
<span id="cb68-15"><a href="#cb68-15" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;Musther et al. 2014&quot;</span>),</span>
<span id="cb68-16"><a href="#cb68-16" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb68-17"><a href="#cb68-17" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb68-18"><a href="#cb68-18" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Rat&quot;</span> <span class="ot">=</span> <span class="dv">21</span>,</span>
<span id="cb68-19"><a href="#cb68-19" tabindex="-1"></a>                                <span class="st">&quot;Mouse&quot;</span> <span class="ot">=</span> <span class="dv">22</span>,</span>
<span id="cb68-20"><a href="#cb68-20" tabindex="-1"></a>                                <span class="st">&quot;Dog&quot;</span> <span class="ot">=</span> <span class="dv">23</span>,</span>
<span id="cb68-21"><a href="#cb68-21" tabindex="-1"></a>                                <span class="st">&quot;Non-Human Primate&quot;</span> <span class="ot">=</span> <span class="dv">24</span>,</span>
<span id="cb68-22"><a href="#cb68-22" tabindex="-1"></a>                                <span class="st">&quot;Human&quot;</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb68-23"><a href="#cb68-23" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;Rat&quot;</span>, <span class="st">&quot;Mouse&quot;</span>, <span class="st">&quot;Dog&quot;</span>, <span class="st">&quot;Non-Human Primate&quot;</span>, <span class="st">&quot;Human&quot;</span>)) <span class="sc">+</span></span>
<span id="cb68-24"><a href="#cb68-24" tabindex="-1"></a>  </span>
<span id="cb68-25"><a href="#cb68-25" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb68-26"><a href="#cb68-26" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-27"><a href="#cb68-27" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-28"><a href="#cb68-28" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb68-29"><a href="#cb68-29" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb68-30"><a href="#cb68-30" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb68-31"><a href="#cb68-31" tabindex="-1"></a>        )</span>
<span id="cb68-32"><a href="#cb68-32" tabindex="-1"></a></span>
<span id="cb68-33"><a href="#cb68-33" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb68-34"><a href="#cb68-34" tabindex="-1"></a>                         <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb68-35"><a href="#cb68-35" tabindex="-1"></a>                         today,</span>
<span id="cb68-36"><a href="#cb68-36" tabindex="-1"></a>                         <span class="st">&quot;_Supp_Fig9.pdf&quot;</span>),</span>
<span id="cb68-37"><a href="#cb68-37" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb68-38"><a href="#cb68-38" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb68-39"><a href="#cb68-39" tabindex="-1"></a></span>
<span id="cb68-40"><a href="#cb68-40" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb68-41"><a href="#cb68-41" tabindex="-1"></a>                          <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb68-42"><a href="#cb68-42" tabindex="-1"></a>                         today,</span>
<span id="cb68-43"><a href="#cb68-43" tabindex="-1"></a>                         <span class="st">&quot;_Supp_Fig9.png&quot;</span>),</span>
<span id="cb68-44"><a href="#cb68-44" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb68-45"><a href="#cb68-45" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb68-46"><a href="#cb68-46" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-10-parallelization-decreases-runtime-of-invivopkfit" class="section level3" number="8.0.7">
<h3><span class="header-section-number">8.0.7</span> Supp. Fig. 10:
Parallelization decreases runtime of invivoPKfit</h3>
<p>Benchmarking for parallelization vs. non-parallelization</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="co"># Randomize the order of chemical species</span></span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>chem_spec <span class="ot">&lt;-</span> cvt <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(analyte_dtxsid, species) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="dv">1</span>)</span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>test_group_size <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="dv">105</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>fit_options <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">error_model =</span> <span class="fu">c</span>(<span class="st">&quot;pooled&quot;</span>,</span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a>                                           <span class="st">&quot;hierarchical&quot;</span>),</span>
<span id="cb69-9"><a href="#cb69-9" tabindex="-1"></a>                           <span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-10"><a href="#cb69-10" tabindex="-1"></a>                           <span class="at">log10_trans =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-11"><a href="#cb69-11" tabindex="-1"></a>                           <span class="at">time_scale =</span> <span class="fu">c</span>(</span>
<span id="cb69-12"><a href="#cb69-12" tabindex="-1"></a>                             <span class="cn">TRUE</span>,</span>
<span id="cb69-13"><a href="#cb69-13" tabindex="-1"></a>                             <span class="cn">FALSE</span>),</span>
<span id="cb69-14"><a href="#cb69-14" tabindex="-1"></a>                           <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-15"><a href="#cb69-15" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" tabindex="-1"></a>fit_options <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(fit_options, test_group_size)</span>
<span id="cb69-17"><a href="#cb69-17" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" tabindex="-1"></a>fit_options <span class="ot">&lt;-</span> fit_options <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-19"><a href="#cb69-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">this_data =</span> <span class="fu">list</span>({</span>
<span id="cb69-20"><a href="#cb69-20" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> chem_spec <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> test_group_size) <span class="sc">%&gt;%</span></span>
<span id="cb69-21"><a href="#cb69-21" tabindex="-1"></a>      <span class="fu">left_join</span>(cvt, <span class="at">by =</span> <span class="fu">join_by</span>(analyte_dtxsid, species)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-22"><a href="#cb69-22" tabindex="-1"></a>      <span class="fu">pk</span>() <span class="sc">+</span></span>
<span id="cb69-23"><a href="#cb69-23" tabindex="-1"></a>        <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="fu">ifelse</span>(<span class="sc">!</span>time_scale, </span>
<span id="cb69-24"><a href="#cb69-24" tabindex="-1"></a>                                      <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb69-25"><a href="#cb69-25" tabindex="-1"></a>                                      <span class="st">&quot;auto&quot;</span>)) <span class="sc">+</span></span>
<span id="cb69-26"><a href="#cb69-26" tabindex="-1"></a>        <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> dose_norm, <span class="at">log10_trans =</span> log10_trans) <span class="sc">+</span></span>
<span id="cb69-27"><a href="#cb69-27" tabindex="-1"></a>        <span class="fu">settings_preprocess</span>(<span class="at">suppress.messages =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-28"><a href="#cb69-28" tabindex="-1"></a>    <span class="fu">do_prefit</span>(tmp)</span>
<span id="cb69-29"><a href="#cb69-29" tabindex="-1"></a>  }</span>
<span id="cb69-30"><a href="#cb69-30" tabindex="-1"></a>  ),</span>
<span id="cb69-31"><a href="#cb69-31" tabindex="-1"></a>  <span class="at">data_size =</span> chem_spec <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> test_group_size) <span class="sc">%&gt;%</span></span>
<span id="cb69-32"><a href="#cb69-32" tabindex="-1"></a>    <span class="fu">left_join</span>(cvt, <span class="at">by =</span> <span class="fu">join_by</span>(analyte_dtxsid, species)) <span class="sc">%&gt;%</span></span>
<span id="cb69-33"><a href="#cb69-33" tabindex="-1"></a>    <span class="fu">NROW</span>())</span>
<span id="cb69-34"><a href="#cb69-34" tabindex="-1"></a></span>
<span id="cb69-35"><a href="#cb69-35" tabindex="-1"></a><span class="co"># Organization of the benchmarking</span></span>
<span id="cb69-36"><a href="#cb69-36" tabindex="-1"></a><span class="co"># For each fit_option, return the four values of system.time() that we want</span></span>
<span id="cb69-37"><a href="#cb69-37" tabindex="-1"></a>df_out <span class="ot">&lt;-</span> fit_options <span class="sc">%&gt;%</span></span>
<span id="cb69-38"><a href="#cb69-38" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-39"><a href="#cb69-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tim_1core =</span> <span class="fu">system.time</span>(<span class="fu">do_fit</span>(this_data))[[<span class="st">&quot;elapsed&quot;</span>]],</span>
<span id="cb69-40"><a href="#cb69-40" tabindex="-1"></a>         <span class="at">tim_4core =</span> <span class="fu">system.time</span>(<span class="fu">do_fit</span>(this_data, <span class="at">n_cores =</span> <span class="dv">4</span>))[[<span class="st">&quot;elapsed&quot;</span>]],</span>
<span id="cb69-41"><a href="#cb69-41" tabindex="-1"></a>         <span class="at">tim_7core =</span> <span class="fu">system.time</span>(<span class="fu">do_fit</span>(this_data, <span class="at">n_cores =</span> <span class="dv">7</span>))[[<span class="st">&quot;elapsed&quot;</span>]],</span>
<span id="cb69-42"><a href="#cb69-42" tabindex="-1"></a>         <span class="at">tim_12core =</span> <span class="fu">system.time</span>(<span class="fu">do_fit</span>(this_data, <span class="at">n_cores =</span> <span class="dv">12</span>))[[<span class="st">&quot;elapsed&quot;</span>]]</span>
<span id="cb69-43"><a href="#cb69-43" tabindex="-1"></a>         )</span>
<span id="cb69-44"><a href="#cb69-44" tabindex="-1"></a></span>
<span id="cb69-45"><a href="#cb69-45" tabindex="-1"></a>df_out <span class="ot">&lt;-</span> df_out <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>this_data)</span>
<span id="cb69-46"><a href="#cb69-46" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb69-47"><a href="#cb69-47" tabindex="-1"></a></span>
<span id="cb69-48"><a href="#cb69-48" tabindex="-1"></a>full_long <span class="ot">&lt;-</span> df_out <span class="sc">%&gt;%</span></span>
<span id="cb69-49"><a href="#cb69-49" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(tim_1core<span class="sc">:</span>tim_12core),</span>
<span id="cb69-50"><a href="#cb69-50" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">&quot;N_cores&quot;</span>,</span>
<span id="cb69-51"><a href="#cb69-51" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">&quot;Time_s&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-52"><a href="#cb69-52" tabindex="-1"></a>  <span class="fu">group_by</span>(N_cores, test_group_size, data_size) <span class="sc">%&gt;%</span></span>
<span id="cb69-53"><a href="#cb69-53" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_time =</span> <span class="fu">mean</span>(Time_s, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">60</span>,</span>
<span id="cb69-54"><a href="#cb69-54" tabindex="-1"></a>            <span class="at">max_time =</span> <span class="fu">max</span>(Time_s, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">60</span>,</span>
<span id="cb69-55"><a href="#cb69-55" tabindex="-1"></a>            <span class="at">min_time =</span> <span class="fu">min</span>(Time_s, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb69-56"><a href="#cb69-56" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb69-57"><a href="#cb69-57" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">N_cores =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(N_cores, <span class="st">&quot;[:digit:]+&quot;</span>)))</span>
<span id="cb69-58"><a href="#cb69-58" tabindex="-1"></a></span>
<span id="cb69-59"><a href="#cb69-59" tabindex="-1"></a>df_out <span class="sc">%&gt;%</span> clipr<span class="sc">::</span><span class="fu">write_clip</span>()</span>
<span id="cb69-60"><a href="#cb69-60" tabindex="-1"></a><span class="fu">ggplot</span>(full_long,</span>
<span id="cb69-61"><a href="#cb69-61" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> test_group_size,</span>
<span id="cb69-62"><a href="#cb69-62" tabindex="-1"></a>           <span class="at">y =</span> mean_time,</span>
<span id="cb69-63"><a href="#cb69-63" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">as.factor</span>(N_cores))) <span class="sc">+</span></span>
<span id="cb69-64"><a href="#cb69-64" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb69-65"><a href="#cb69-65" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> min_time,</span>
<span id="cb69-66"><a href="#cb69-66" tabindex="-1"></a>                <span class="at">ymax =</span> max_time)) <span class="sc">+</span></span>
<span id="cb69-67"><a href="#cb69-67" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> N_cores)) <span class="sc">+</span></span>
<span id="cb69-68"><a href="#cb69-68" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of Data Groups&quot;</span>,</span>
<span id="cb69-69"><a href="#cb69-69" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Runtime (minutes)&quot;</span>,</span>
<span id="cb69-70"><a href="#cb69-70" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Number of Processing Cores&quot;</span>,</span>
<span id="cb69-71"><a href="#cb69-71" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;(with min/max runtime range)&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-72"><a href="#cb69-72" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(N_cores)) <span class="sc">+</span></span>
<span id="cb69-73"><a href="#cb69-73" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;#40c679&quot;</span>, <span class="st">&quot;#31a354&quot;</span>, <span class="st">&quot;#006837&quot;</span>)) <span class="sc">+</span></span>
<span id="cb69-74"><a href="#cb69-74" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb69-75"><a href="#cb69-75" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb69-76"><a href="#cb69-76" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb69-77"><a href="#cb69-77" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb69-78"><a href="#cb69-78" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb69-79"><a href="#cb69-79" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb69-80"><a href="#cb69-80" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb69-81"><a href="#cb69-81" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb69-82"><a href="#cb69-82" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb69-83"><a href="#cb69-83" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb69-84"><a href="#cb69-84" tabindex="-1"></a></span>
<span id="cb69-85"><a href="#cb69-85" tabindex="-1"></a></span>
<span id="cb69-86"><a href="#cb69-86" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb69-87"><a href="#cb69-87" tabindex="-1"></a>              <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb69-88"><a href="#cb69-88" tabindex="-1"></a>              today,</span>
<span id="cb69-89"><a href="#cb69-89" tabindex="-1"></a>              <span class="st">&quot;_Supp_Fig10.png&quot;</span>),</span>
<span id="cb69-90"><a href="#cb69-90" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb69-91"><a href="#cb69-91" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">2.5</span>,</span>
<span id="cb69-92"><a href="#cb69-92" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="summary-fit-data-for-all-fitting-options-all-models-all-data-groups" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Summary fit data for
all fitting options, all models, all data groups</h1>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a>fit_summary_bydatagrp <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb70-4"><a href="#cb70-4" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb70-5"><a href="#cb70-5" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb70-6"><a href="#cb70-6" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb70-7"><a href="#cb70-7" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb70-8"><a href="#cb70-8" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb70-9"><a href="#cb70-9" tabindex="-1"></a>  </span>
<span id="cb70-10"><a href="#cb70-10" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb70-11"><a href="#cb70-11" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb70-12"><a href="#cb70-12" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb70-13"><a href="#cb70-13" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb70-14"><a href="#cb70-14" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb70-15"><a href="#cb70-15" tabindex="-1"></a>                     time_indic,</span>
<span id="cb70-16"><a href="#cb70-16" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb70-17"><a href="#cb70-17" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb70-18"><a href="#cb70-18" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb70-19"><a href="#cb70-19" tabindex="-1"></a>  </span>
<span id="cb70-20"><a href="#cb70-20" tabindex="-1"></a>  my_pk <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb70-21"><a href="#cb70-21" tabindex="-1"></a>  </span>
<span id="cb70-22"><a href="#cb70-22" tabindex="-1"></a>    pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb70-23"><a href="#cb70-23" tabindex="-1"></a>  </span>
<span id="cb70-24"><a href="#cb70-24" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;Summary by data group for: &quot;</span>, pk_name))</span>
<span id="cb70-25"><a href="#cb70-25" tabindex="-1"></a></span>
<span id="cb70-26"><a href="#cb70-26" tabindex="-1"></a>myAFE <span class="ot">&lt;-</span> <span class="fu">AFE</span>(my_pk,</span>
<span id="cb70-27"><a href="#cb70-27" tabindex="-1"></a>              <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-28"><a href="#cb70-28" tabindex="-1"></a>             <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-29"><a href="#cb70-29" tabindex="-1"></a></span>
<span id="cb70-30"><a href="#cb70-30" tabindex="-1"></a>myAAFE <span class="ot">&lt;-</span> <span class="fu">AAFE</span>(my_pk,</span>
<span id="cb70-31"><a href="#cb70-31" tabindex="-1"></a>              <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-32"><a href="#cb70-32" tabindex="-1"></a>             <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-33"><a href="#cb70-33" tabindex="-1"></a></span>
<span id="cb70-34"><a href="#cb70-34" tabindex="-1"></a>my_r2 <span class="ot">&lt;-</span> <span class="fu">rsq</span>(my_pk,</span>
<span id="cb70-35"><a href="#cb70-35" tabindex="-1"></a>             <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-36"><a href="#cb70-36" tabindex="-1"></a>             <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>) </span>
<span id="cb70-37"><a href="#cb70-37" tabindex="-1"></a></span>
<span id="cb70-38"><a href="#cb70-38" tabindex="-1"></a>myAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(my_pk) </span>
<span id="cb70-39"><a href="#cb70-39" tabindex="-1"></a></span>
<span id="cb70-40"><a href="#cb70-40" tabindex="-1"></a>myRMSLE <span class="ot">&lt;-</span> <span class="fu">rmse</span>(my_pk,</span>
<span id="cb70-41"><a href="#cb70-41" tabindex="-1"></a>               <span class="at">use_scale_conc =</span> <span class="fu">list</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-42"><a href="#cb70-42" tabindex="-1"></a>                                     <span class="at">log10_trans =</span> <span class="cn">TRUE</span>),</span>
<span id="cb70-43"><a href="#cb70-43" tabindex="-1"></a>               <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-44"><a href="#cb70-44" tabindex="-1"></a></span>
<span id="cb70-45"><a href="#cb70-45" tabindex="-1"></a></span>
<span id="cb70-46"><a href="#cb70-46" tabindex="-1"></a>myRMSE <span class="ot">&lt;-</span> <span class="fu">rmse</span>(my_pk,</span>
<span id="cb70-47"><a href="#cb70-47" tabindex="-1"></a>               <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-48"><a href="#cb70-48" tabindex="-1"></a>               <span class="at">sub_pLOQ =</span> <span class="cn">TRUE</span>) </span>
<span id="cb70-49"><a href="#cb70-49" tabindex="-1"></a></span>
<span id="cb70-50"><a href="#cb70-50" tabindex="-1"></a>winmodel <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb70-51"><a href="#cb70-51" tabindex="-1"></a>  <span class="fu">select</span>(Chemical, Species, method, model) <span class="sc">%&gt;%</span></span>
<span id="cb70-52"><a href="#cb70-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_winning_model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-53"><a href="#cb70-53" tabindex="-1"></a></span>
<span id="cb70-54"><a href="#cb70-54" tabindex="-1"></a></span>
<span id="cb70-55"><a href="#cb70-55" tabindex="-1"></a> <span class="co">#note convergence codes for each model</span></span>
<span id="cb70-56"><a href="#cb70-56" tabindex="-1"></a>  pf <span class="ot">&lt;-</span> my_pk<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb70-57"><a href="#cb70-57" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(Chemical, Species, model, method, convcode)</span>
<span id="cb70-58"><a href="#cb70-58" tabindex="-1"></a>  </span>
<span id="cb70-59"><a href="#cb70-59" tabindex="-1"></a>  </span>
<span id="cb70-60"><a href="#cb70-60" tabindex="-1"></a>  convcode_labels <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">convcode =</span><span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb70-61"><a href="#cb70-61" tabindex="-1"></a>                                               <span class="dv">1</span>,</span>
<span id="cb70-62"><a href="#cb70-62" tabindex="-1"></a>                                               <span class="dv">20</span>,</span>
<span id="cb70-63"><a href="#cb70-63" tabindex="-1"></a>                                               <span class="dv">21</span>,</span>
<span id="cb70-64"><a href="#cb70-64" tabindex="-1"></a>                                               <span class="dv">10</span>,</span>
<span id="cb70-65"><a href="#cb70-65" tabindex="-1"></a>                                               <span class="dv">51</span>,</span>
<span id="cb70-66"><a href="#cb70-66" tabindex="-1"></a>                                               <span class="dv">52</span>,</span>
<span id="cb70-67"><a href="#cb70-67" tabindex="-1"></a>                                               <span class="dv">9999</span>,</span>
<span id="cb70-68"><a href="#cb70-68" tabindex="-1"></a>                                               <span class="sc">-</span><span class="dv">9999</span>),</span>
<span id="cb70-69"><a href="#cb70-69" tabindex="-1"></a>                                <span class="at">convcode_label =</span> <span class="fu">c</span>(<span class="st">&#39;Successful convergence (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb70-70"><a href="#cb70-70" tabindex="-1"></a>                                                   <span class="st">&#39;The iteration limit maxit had been reached (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb70-71"><a href="#cb70-71" tabindex="-1"></a>                                <span class="st">&#39;the initial set of parameters is inadmissible, that is, that the function cannot be computed or returns an infinite, NULL, or NA value (see ?optimx::optimx))&#39;</span>,</span>
<span id="cb70-72"><a href="#cb70-72" tabindex="-1"></a>  <span class="st">&#39;an intermediate set of parameters is inadmissible (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb70-73"><a href="#cb70-73" tabindex="-1"></a>  <span class="st">&#39;degeneracy of the Nelder–Mead simplex (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb70-74"><a href="#cb70-74" tabindex="-1"></a>  <span class="st">&#39;a warning from the &quot;L-BFGS-B&quot; method (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb70-75"><a href="#cb70-75" tabindex="-1"></a>  <span class="st">&#39;an error from the &quot;L-BFGS-B&quot; method (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb70-76"><a href="#cb70-76" tabindex="-1"></a>  <span class="st">&#39;error in optimx::optimx()&#39;</span>,</span>
<span id="cb70-77"><a href="#cb70-77" tabindex="-1"></a>  <span class="st">&#39;model status was &quot;abort&quot;&#39;</span>)</span>
<span id="cb70-78"><a href="#cb70-78" tabindex="-1"></a>  )</span>
<span id="cb70-79"><a href="#cb70-79" tabindex="-1"></a>  </span>
<span id="cb70-80"><a href="#cb70-80" tabindex="-1"></a>  pf <span class="ot">&lt;-</span> pf <span class="sc">%&gt;%</span></span>
<span id="cb70-81"><a href="#cb70-81" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(convcode_labels)</span>
<span id="cb70-82"><a href="#cb70-82" tabindex="-1"></a>  </span>
<span id="cb70-83"><a href="#cb70-83" tabindex="-1"></a><span class="co">#join absolutely everything together</span></span>
<span id="cb70-84"><a href="#cb70-84" tabindex="-1"></a>summ_by_datagroup <span class="ot">&lt;-</span> pf <span class="sc">%&gt;%</span></span>
<span id="cb70-85"><a href="#cb70-85" tabindex="-1"></a>  <span class="fu">left_join</span>(winmodel) <span class="sc">%&gt;%</span></span>
<span id="cb70-86"><a href="#cb70-86" tabindex="-1"></a>  <span class="fu">left_join</span>(myAIC) <span class="sc">%&gt;%</span></span>
<span id="cb70-87"><a href="#cb70-87" tabindex="-1"></a>  <span class="fu">left_join</span>(myAFE) <span class="sc">%&gt;%</span></span>
<span id="cb70-88"><a href="#cb70-88" tabindex="-1"></a>  <span class="fu">left_join</span>(myAAFE) <span class="sc">%&gt;%</span></span>
<span id="cb70-89"><a href="#cb70-89" tabindex="-1"></a>  <span class="fu">left_join</span>(my_r2) <span class="sc">%&gt;%</span></span>
<span id="cb70-90"><a href="#cb70-90" tabindex="-1"></a>  <span class="fu">left_join</span>(myRMSLE) <span class="sc">%&gt;%</span></span>
<span id="cb70-91"><a href="#cb70-91" tabindex="-1"></a>  <span class="fu">left_join</span>(myRMSE) <span class="sc">%&gt;%</span></span>
<span id="cb70-92"><a href="#cb70-92" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">is_winning_model =</span> <span class="fu">case_when</span>(is_winning_model <span class="sc">%in%</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-93"><a href="#cb70-93" tabindex="-1"></a>                                    <span class="fu">is.na</span>(is_winning_model) <span class="sc">~</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-94"><a href="#cb70-94" tabindex="-1"></a>                                    <span class="at">.default =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-95"><a href="#cb70-95" tabindex="-1"></a>  <span class="fu">arrange</span>(Chemical, Species, method, model)</span>
<span id="cb70-96"><a href="#cb70-96" tabindex="-1"></a></span>
<span id="cb70-97"><a href="#cb70-97" tabindex="-1"></a><span class="fu">return</span>(summ_by_datagroup)</span>
<span id="cb70-98"><a href="#cb70-98" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a>fit_summary_byexpt <span class="ot">&lt;-</span> <span class="cf">function</span>(this_error_model,</span>
<span id="cb71-2"><a href="#cb71-2" tabindex="-1"></a>                             this_dose_norm,</span>
<span id="cb71-3"><a href="#cb71-3" tabindex="-1"></a>                             this_log10_trans,</span>
<span id="cb71-4"><a href="#cb71-4" tabindex="-1"></a>                             this_time_scale) {</span>
<span id="cb71-5"><a href="#cb71-5" tabindex="-1"></a>  dose_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_dose_norm)</span>
<span id="cb71-6"><a href="#cb71-6" tabindex="-1"></a>  log10_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_log10_trans)</span>
<span id="cb71-7"><a href="#cb71-7" tabindex="-1"></a>  time_indic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(this_time_scale)</span>
<span id="cb71-8"><a href="#cb71-8" tabindex="-1"></a>  errmodel_indic <span class="ot">&lt;-</span> <span class="fu">substr</span>(this_error_model, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb71-9"><a href="#cb71-9" tabindex="-1"></a>  </span>
<span id="cb71-10"><a href="#cb71-10" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb71-11"><a href="#cb71-11" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb71-12"><a href="#cb71-12" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_&quot;</span>,</span>
<span id="cb71-13"><a href="#cb71-13" tabindex="-1"></a>                     dose_indic,</span>
<span id="cb71-14"><a href="#cb71-14" tabindex="-1"></a>                     log10_indic,</span>
<span id="cb71-15"><a href="#cb71-15" tabindex="-1"></a>                     time_indic,</span>
<span id="cb71-16"><a href="#cb71-16" tabindex="-1"></a>                     errmodel_indic,</span>
<span id="cb71-17"><a href="#cb71-17" tabindex="-1"></a>                     <span class="st">&quot;.Rds&quot;</span>)</span>
<span id="cb71-18"><a href="#cb71-18" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb71-19"><a href="#cb71-19" tabindex="-1"></a>  </span>
<span id="cb71-20"><a href="#cb71-20" tabindex="-1"></a>  my_pk <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb71-21"><a href="#cb71-21" tabindex="-1"></a>  </span>
<span id="cb71-22"><a href="#cb71-22" tabindex="-1"></a>      pk_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_indic, log10_indic, time_indic, errmodel_indic)</span>
<span id="cb71-23"><a href="#cb71-23" tabindex="-1"></a>  </span>
<span id="cb71-24"><a href="#cb71-24" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;Summary by experiment for: &quot;</span>, pk_name))</span>
<span id="cb71-25"><a href="#cb71-25" tabindex="-1"></a></span>
<span id="cb71-26"><a href="#cb71-26" tabindex="-1"></a>my_tkstats <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(my_pk,</span>
<span id="cb71-27"><a href="#cb71-27" tabindex="-1"></a>                           <span class="at">model =</span> <span class="cn">NULL</span>)</span>
<span id="cb71-28"><a href="#cb71-28" tabindex="-1"></a></span>
<span id="cb71-29"><a href="#cb71-29" tabindex="-1"></a>winmodel <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(my_pk) <span class="sc">%&gt;%</span></span>
<span id="cb71-30"><a href="#cb71-30" tabindex="-1"></a>  <span class="fu">select</span>(Chemical, Species, method, model) <span class="sc">%&gt;%</span></span>
<span id="cb71-31"><a href="#cb71-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_winning_model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-32"><a href="#cb71-32" tabindex="-1"></a></span>
<span id="cb71-33"><a href="#cb71-33" tabindex="-1"></a>pf <span class="ot">&lt;-</span> my_pk<span class="sc">$</span>fit <span class="sc">%&gt;%</span></span>
<span id="cb71-34"><a href="#cb71-34" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(Chemical, Species, model, method, convcode)</span>
<span id="cb71-35"><a href="#cb71-35" tabindex="-1"></a>  </span>
<span id="cb71-36"><a href="#cb71-36" tabindex="-1"></a>  </span>
<span id="cb71-37"><a href="#cb71-37" tabindex="-1"></a>  convcode_labels <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">convcode =</span><span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb71-38"><a href="#cb71-38" tabindex="-1"></a>                                               <span class="dv">1</span>,</span>
<span id="cb71-39"><a href="#cb71-39" tabindex="-1"></a>                                               <span class="dv">20</span>,</span>
<span id="cb71-40"><a href="#cb71-40" tabindex="-1"></a>                                               <span class="dv">21</span>,</span>
<span id="cb71-41"><a href="#cb71-41" tabindex="-1"></a>                                               <span class="dv">10</span>,</span>
<span id="cb71-42"><a href="#cb71-42" tabindex="-1"></a>                                               <span class="dv">51</span>,</span>
<span id="cb71-43"><a href="#cb71-43" tabindex="-1"></a>                                               <span class="dv">52</span>,</span>
<span id="cb71-44"><a href="#cb71-44" tabindex="-1"></a>                                               <span class="dv">9999</span>,</span>
<span id="cb71-45"><a href="#cb71-45" tabindex="-1"></a>                                               <span class="sc">-</span><span class="dv">9999</span>),</span>
<span id="cb71-46"><a href="#cb71-46" tabindex="-1"></a>                                <span class="at">convcode_label =</span> <span class="fu">c</span>(<span class="st">&#39;Successful convergence (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb71-47"><a href="#cb71-47" tabindex="-1"></a>                                                   <span class="st">&#39;The iteration limit maxit had been reached (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb71-48"><a href="#cb71-48" tabindex="-1"></a>                                <span class="st">&#39;the initial set of parameters is inadmissible, that is, that the function cannot be computed or returns an infinite, NULL, or NA value (see ?optimx::optimx))&#39;</span>,</span>
<span id="cb71-49"><a href="#cb71-49" tabindex="-1"></a>  <span class="st">&#39;an intermediate set of parameters is inadmissible (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb71-50"><a href="#cb71-50" tabindex="-1"></a>  <span class="st">&#39;degeneracy of the Nelder–Mead simplex (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb71-51"><a href="#cb71-51" tabindex="-1"></a>  <span class="st">&#39;a warning from the &quot;L-BFGS-B&quot; method (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb71-52"><a href="#cb71-52" tabindex="-1"></a>  <span class="st">&#39;an error from the &quot;L-BFGS-B&quot; method (see ?optimx::optimx)&#39;</span>,</span>
<span id="cb71-53"><a href="#cb71-53" tabindex="-1"></a>  <span class="st">&#39;error in optimx::optimx()&#39;</span>,</span>
<span id="cb71-54"><a href="#cb71-54" tabindex="-1"></a>  <span class="st">&#39;model status was &quot;abort&quot;&#39;</span>)</span>
<span id="cb71-55"><a href="#cb71-55" tabindex="-1"></a>  )</span>
<span id="cb71-56"><a href="#cb71-56" tabindex="-1"></a>  </span>
<span id="cb71-57"><a href="#cb71-57" tabindex="-1"></a>  pf <span class="ot">&lt;-</span> pf <span class="sc">%&gt;%</span></span>
<span id="cb71-58"><a href="#cb71-58" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(convcode_labels)</span>
<span id="cb71-59"><a href="#cb71-59" tabindex="-1"></a>  </span>
<span id="cb71-60"><a href="#cb71-60" tabindex="-1"></a></span>
<span id="cb71-61"><a href="#cb71-61" tabindex="-1"></a>summ_by_expt <span class="ot">&lt;-</span> pf <span class="sc">%&gt;%</span></span>
<span id="cb71-62"><a href="#cb71-62" tabindex="-1"></a>  <span class="fu">left_join</span>(winmodel) <span class="sc">%&gt;%</span></span>
<span id="cb71-63"><a href="#cb71-63" tabindex="-1"></a>  <span class="fu">left_join</span>(my_tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb71-64"><a href="#cb71-64" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">is_winning_model =</span> <span class="fu">case_when</span>(is_winning_model <span class="sc">%in%</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-65"><a href="#cb71-65" tabindex="-1"></a>                                    <span class="fu">is.na</span>(is_winning_model) <span class="sc">~</span> <span class="cn">FALSE</span>,</span>
<span id="cb71-66"><a href="#cb71-66" tabindex="-1"></a>                                    <span class="at">.default =</span> <span class="cn">FALSE</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb71-67"><a href="#cb71-67" tabindex="-1"></a>  <span class="fu">arrange</span>(Chemical, Species, method, model)</span>
<span id="cb71-68"><a href="#cb71-68" tabindex="-1"></a></span>
<span id="cb71-69"><a href="#cb71-69" tabindex="-1"></a><span class="fu">return</span>(summ_by_expt)</span>
<span id="cb71-70"><a href="#cb71-70" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a>summary_datagrp_all <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">summ =</span> <span class="fu">list</span>(</span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a>    <span class="fu">fit_summary_bydatagrp</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a>                                             <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a>                                             <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a>                                             <span class="at">this_time_scale =</span> time_scale)</span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a>    )</span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb72-10"><a href="#cb72-10" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(summ))</span>
<span id="cb72-11"><a href="#cb72-11" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" tabindex="-1"></a>summary_expt_all <span class="ot">&lt;-</span> fitopts <span class="sc">%&gt;%</span></span>
<span id="cb72-13"><a href="#cb72-13" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-14"><a href="#cb72-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">summ_expt =</span> <span class="fu">list</span>(</span>
<span id="cb72-15"><a href="#cb72-15" tabindex="-1"></a>    <span class="fu">fit_summary_byexpt</span>(<span class="at">this_error_model =</span> error_model,</span>
<span id="cb72-16"><a href="#cb72-16" tabindex="-1"></a>                                             <span class="at">this_dose_norm =</span> dose_norm,</span>
<span id="cb72-17"><a href="#cb72-17" tabindex="-1"></a>                                             <span class="at">this_log10_trans =</span> log10_trans,</span>
<span id="cb72-18"><a href="#cb72-18" tabindex="-1"></a>                                             <span class="at">this_time_scale =</span> time_scale)</span>
<span id="cb72-19"><a href="#cb72-19" tabindex="-1"></a>    )</span>
<span id="cb72-20"><a href="#cb72-20" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb72-21"><a href="#cb72-21" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(summ_expt))</span>
<span id="cb72-22"><a href="#cb72-22" tabindex="-1"></a></span>
<span id="cb72-23"><a href="#cb72-23" tabindex="-1"></a>writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="fu">list</span>(<span class="st">&quot;Summary by data grp&quot;</span> <span class="ot">=</span> summary_datagrp_all,</span>
<span id="cb72-24"><a href="#cb72-24" tabindex="-1"></a>                         <span class="st">&quot;Summary by expt&quot;</span> <span class="ot">=</span> summary_expt_all),</span>
<span id="cb72-25"><a href="#cb72-25" tabindex="-1"></a>                    <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb72-26"><a href="#cb72-26" tabindex="-1"></a>              <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb72-27"><a href="#cb72-27" tabindex="-1"></a>              today,</span>
<span id="cb72-28"><a href="#cb72-28" tabindex="-1"></a>              <span class="st">&quot;_Supp_Table4.xlsx&quot;</span>))</span></code></pre></div>
</div>
<div id="individual-study-level-analysis" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Individual study level
analysis</h1>
<p>While there is no convenient external data set for evaluation, one
way of evaluating the generalizability of the model fits is to compare
the pooled fits to fits done on an individual-study basis, where a
“study” is defined as a unique combination of Chemical, Species, and
Reference.</p>
<p>This means setting the <code>data_group</code> to
<code>vars(Chemical, Species, Reference)</code> and also setting the
<code>error_group</code> to
<code>vars(Chemical, Species, Reference)</code>.</p>
<p>For comparison purposes, we will use the same “best set” of options
that was used for the pooled analysis: dose-normalization,
log10-transformation, no time transformation, and the “bobyqa”
optimization algorithm.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="co">#set up pk analysis for single-study</span></span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>pk_study <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>  <span class="fu">facet_data</span>(</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a>    <span class="at">facets =</span> <span class="fu">vars</span>(Chemical, Species, Reference)</span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(</span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a>    <span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)</span>
<span id="cb73-8"><a href="#cb73-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb73-10"><a href="#cb73-10" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb73-11"><a href="#cb73-11" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-12"><a href="#cb73-12" tabindex="-1"></a>             <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb73-13"><a href="#cb73-13" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-14"><a href="#cb73-14" tabindex="-1"></a>  <span class="fu">stat_model</span>(<span class="at">model =</span> <span class="fu">c</span>(<span class="st">&quot;model_flat&quot;</span>,</span>
<span id="cb73-15"><a href="#cb73-15" tabindex="-1"></a>                       <span class="st">&quot;model_1comp&quot;</span>,</span>
<span id="cb73-16"><a href="#cb73-16" tabindex="-1"></a>                       <span class="st">&quot;model_2comp&quot;</span>))</span>
<span id="cb73-17"><a href="#cb73-17" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" tabindex="-1"></a><span class="co">#do pk analysis</span></span>
<span id="cb73-19"><a href="#cb73-19" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb73-20"><a href="#cb73-20" tabindex="-1"></a>  pk_study <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(pk_study,</span>
<span id="cb73-21"><a href="#cb73-21" tabindex="-1"></a>                     <span class="at">n_cores =</span> <span class="dv">11</span>)</span>
<span id="cb73-22"><a href="#cb73-22" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="fu">saveRDS</span>(pk_study,</span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a>               today,</span>
<span id="cb74-4"><a href="#cb74-4" tabindex="-1"></a>               <span class="st">&quot;studylevel_pk_fit_110p.Rds&quot;</span>))</span></code></pre></div>
<p>Get TK statistics for the winning models. Do them dose-normalized so
that they won’t vary by dose. Keep only halflife and Vss, which
shouldn’t vary by Route and Media.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a>tkstats_study <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(pk_study,</span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a>                              <span class="at">finite_only =</span> <span class="cn">FALSE</span>,</span>
<span id="cb75-3"><a href="#cb75-3" tabindex="-1"></a>                              <span class="at">dose_norm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb75-4"><a href="#cb75-4" tabindex="-1"></a>                              <span class="at">model =</span> <span class="st">&quot;winning&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="#cb75-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical,</span>
<span id="cb75-6"><a href="#cb75-6" tabindex="-1"></a>                Species, </span>
<span id="cb75-7"><a href="#cb75-7" tabindex="-1"></a>                Reference,</span>
<span id="cb75-8"><a href="#cb75-8" tabindex="-1"></a>                method,</span>
<span id="cb75-9"><a href="#cb75-9" tabindex="-1"></a>                model,</span>
<span id="cb75-10"><a href="#cb75-10" tabindex="-1"></a>                halflife.tkstats,</span>
<span id="cb75-11"><a href="#cb75-11" tabindex="-1"></a>                Vss.tkstats,</span>
<span id="cb75-12"><a href="#cb75-12" tabindex="-1"></a>                <span class="st">`</span><span class="at">Vss/Fgutabs.tkstats</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-13"><a href="#cb75-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">halflife =</span> halflife.tkstats,</span>
<span id="cb75-14"><a href="#cb75-14" tabindex="-1"></a>                <span class="at">Vss =</span> Vss.tkstats,</span>
<span id="cb75-15"><a href="#cb75-15" tabindex="-1"></a>                <span class="st">`</span><span class="at">Vss/Fgutabs</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Vss/Fgutabs.tkstats</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-16"><a href="#cb75-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb75-17"><a href="#cb75-17" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" tabindex="-1"></a><span class="co">#Also: get coefficients and try to pull Fgutabs (if it was optimized)</span></span>
<span id="cb75-19"><a href="#cb75-19" tabindex="-1"></a>coef_study <span class="ot">&lt;-</span> <span class="fu">coef_sd</span>(pk_study,</span>
<span id="cb75-20"><a href="#cb75-20" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb75-21"><a href="#cb75-21" tabindex="-1"></a>                       <span class="at">include_type =</span> <span class="st">&quot;optimize&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-22"><a href="#cb75-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(param_name <span class="sc">%in%</span> <span class="st">&quot;Fgutabs&quot;</span>) <span class="sc">%&gt;%</span>  dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical,</span>
<span id="cb75-23"><a href="#cb75-23" tabindex="-1"></a>                Species, </span>
<span id="cb75-24"><a href="#cb75-24" tabindex="-1"></a>                Reference,</span>
<span id="cb75-25"><a href="#cb75-25" tabindex="-1"></a>                method,</span>
<span id="cb75-26"><a href="#cb75-26" tabindex="-1"></a>                model,</span>
<span id="cb75-27"><a href="#cb75-27" tabindex="-1"></a>                param_name,</span>
<span id="cb75-28"><a href="#cb75-28" tabindex="-1"></a>                param_value) <span class="sc">%&gt;%</span></span>
<span id="cb75-29"><a href="#cb75-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb75-30"><a href="#cb75-30" tabindex="-1"></a></span>
<span id="cb75-31"><a href="#cb75-31" tabindex="-1"></a><span class="co">#keep only winning model coefs</span></span>
<span id="cb75-32"><a href="#cb75-32" tabindex="-1"></a>win_study <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(pk_study) <span class="sc">%&gt;%</span></span>
<span id="cb75-33"><a href="#cb75-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>near_flat, <span class="sc">-</span>preds_below_loq)</span>
<span id="cb75-34"><a href="#cb75-34" tabindex="-1"></a></span>
<span id="cb75-35"><a href="#cb75-35" tabindex="-1"></a>coef_study <span class="ot">&lt;-</span> coef_study <span class="sc">%&gt;%</span></span>
<span id="cb75-36"><a href="#cb75-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">semi_join</span>(win_study)</span>
<span id="cb75-37"><a href="#cb75-37" tabindex="-1"></a></span>
<span id="cb75-38"><a href="#cb75-38" tabindex="-1"></a>fgutabs_study <span class="ot">&lt;-</span> coef_study <span class="sc">%&gt;%</span></span>
<span id="cb75-39"><a href="#cb75-39" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>param_name) <span class="sc">%&gt;%</span></span>
<span id="cb75-40"><a href="#cb75-40" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Fgutabs =</span> param_value)</span>
<span id="cb75-41"><a href="#cb75-41" tabindex="-1"></a></span>
<span id="cb75-42"><a href="#cb75-42" tabindex="-1"></a>tkstats_study2 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(tkstats_study,</span>
<span id="cb75-43"><a href="#cb75-43" tabindex="-1"></a>                            fgutabs_study)</span></code></pre></div>
<p>For comparison, read in the saved data from the best options with
pooled data. Get those TK statistics and winning model as well, for the
“bobyqa” method.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a>  file_str <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>                     read_date_pk,</span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>                     <span class="st">&quot;mypk_fit_110p.Rds&quot;</span>)</span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a>  pk_pooled <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> file_str)</span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a>  </span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a> tkstats_pooled <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(pk_pooled,</span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a>                              <span class="at">finite_only =</span> <span class="cn">FALSE</span>,</span>
<span id="cb76-8"><a href="#cb76-8" tabindex="-1"></a>                              <span class="at">dose_norm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb76-9"><a href="#cb76-9" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb76-10"><a href="#cb76-10" tabindex="-1"></a>                              <span class="at">model =</span> <span class="st">&quot;winning&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-11"><a href="#cb76-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical,</span>
<span id="cb76-12"><a href="#cb76-12" tabindex="-1"></a>                Species, </span>
<span id="cb76-13"><a href="#cb76-13" tabindex="-1"></a>                Reference,</span>
<span id="cb76-14"><a href="#cb76-14" tabindex="-1"></a>                method,</span>
<span id="cb76-15"><a href="#cb76-15" tabindex="-1"></a>                model,</span>
<span id="cb76-16"><a href="#cb76-16" tabindex="-1"></a>                halflife.tkstats,</span>
<span id="cb76-17"><a href="#cb76-17" tabindex="-1"></a>                Vss.tkstats,</span>
<span id="cb76-18"><a href="#cb76-18" tabindex="-1"></a>                <span class="st">`</span><span class="at">Vss/Fgutabs.tkstats</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-19"><a href="#cb76-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">halflife =</span> halflife.tkstats,</span>
<span id="cb76-20"><a href="#cb76-20" tabindex="-1"></a>                <span class="at">Vss =</span> Vss.tkstats,</span>
<span id="cb76-21"><a href="#cb76-21" tabindex="-1"></a>                <span class="st">`</span><span class="at">Vss/Fgutabs</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Vss/Fgutabs.tkstats</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-22"><a href="#cb76-22" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">group_by</span>(Chemical,</span>
<span id="cb76-23"><a href="#cb76-23" tabindex="-1"></a>                   Species,</span>
<span id="cb76-24"><a href="#cb76-24" tabindex="-1"></a>                   method,</span>
<span id="cb76-25"><a href="#cb76-25" tabindex="-1"></a>                   model,</span>
<span id="cb76-26"><a href="#cb76-26" tabindex="-1"></a>                   halflife,</span>
<span id="cb76-27"><a href="#cb76-27" tabindex="-1"></a>                   Vss,</span>
<span id="cb76-28"><a href="#cb76-28" tabindex="-1"></a>                   <span class="st">`</span><span class="at">Vss/Fgutabs</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-29"><a href="#cb76-29" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n_ref =</span> <span class="fu">n_distinct</span>(Reference)) <span class="sc">%&gt;%</span></span>
<span id="cb76-30"><a href="#cb76-30" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb76-31"><a href="#cb76-31" tabindex="-1"></a></span>
<span id="cb76-32"><a href="#cb76-32" tabindex="-1"></a> <span class="co">#Also: get coefficients and try to pull Fgutabs</span></span>
<span id="cb76-33"><a href="#cb76-33" tabindex="-1"></a>coef_pooled <span class="ot">&lt;-</span> <span class="fu">coef_sd</span>(pk_pooled,</span>
<span id="cb76-34"><a href="#cb76-34" tabindex="-1"></a>                       <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb76-35"><a href="#cb76-35" tabindex="-1"></a>                       <span class="at">include_type =</span> <span class="st">&quot;optimize&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-36"><a href="#cb76-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(param_name <span class="sc">%in%</span> <span class="st">&quot;Fgutabs&quot;</span>) <span class="sc">%&gt;%</span>  dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical,</span>
<span id="cb76-37"><a href="#cb76-37" tabindex="-1"></a>                Species, </span>
<span id="cb76-38"><a href="#cb76-38" tabindex="-1"></a>                method,</span>
<span id="cb76-39"><a href="#cb76-39" tabindex="-1"></a>                model,</span>
<span id="cb76-40"><a href="#cb76-40" tabindex="-1"></a>                param_name,</span>
<span id="cb76-41"><a href="#cb76-41" tabindex="-1"></a>                param_value) <span class="sc">%&gt;%</span></span>
<span id="cb76-42"><a href="#cb76-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb76-43"><a href="#cb76-43" tabindex="-1"></a></span>
<span id="cb76-44"><a href="#cb76-44" tabindex="-1"></a><span class="co">#keep only winning model coefs</span></span>
<span id="cb76-45"><a href="#cb76-45" tabindex="-1"></a>win_pooled <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(pk_pooled,</span>
<span id="cb76-46"><a href="#cb76-46" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-47"><a href="#cb76-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>near_flat, <span class="sc">-</span>preds_below_loq)</span>
<span id="cb76-48"><a href="#cb76-48" tabindex="-1"></a></span>
<span id="cb76-49"><a href="#cb76-49" tabindex="-1"></a>coef_pooled <span class="ot">&lt;-</span> coef_pooled <span class="sc">%&gt;%</span></span>
<span id="cb76-50"><a href="#cb76-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">semi_join</span>(win_pooled)</span>
<span id="cb76-51"><a href="#cb76-51" tabindex="-1"></a></span>
<span id="cb76-52"><a href="#cb76-52" tabindex="-1"></a>fgutabs_pooled <span class="ot">&lt;-</span> coef_pooled <span class="sc">%&gt;%</span></span>
<span id="cb76-53"><a href="#cb76-53" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>param_name) <span class="sc">%&gt;%</span></span>
<span id="cb76-54"><a href="#cb76-54" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Fgutabs =</span> param_value)</span>
<span id="cb76-55"><a href="#cb76-55" tabindex="-1"></a></span>
<span id="cb76-56"><a href="#cb76-56" tabindex="-1"></a>tkstats_pooled2 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(tkstats_pooled,</span>
<span id="cb76-57"><a href="#cb76-57" tabindex="-1"></a>                            fgutabs_pooled)</span></code></pre></div>
<p>For plotting: Pivot the TK stats tables longer, add an identifier
column for single-study vs. pooled, and merge.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a>tkstats_study3 <span class="ot">&lt;-</span> tkstats_study2 <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">model_study =</span> model) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(halflife,</span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a>                        Vss,</span>
<span id="cb77-5"><a href="#cb77-5" tabindex="-1"></a>                        <span class="st">`</span><span class="at">Vss/Fgutabs</span><span class="st">`</span>,</span>
<span id="cb77-6"><a href="#cb77-6" tabindex="-1"></a>                        Fgutabs),</span>
<span id="cb77-7"><a href="#cb77-7" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb77-8"><a href="#cb77-8" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;value_study&quot;</span>) </span>
<span id="cb77-9"><a href="#cb77-9" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" tabindex="-1"></a>tkstats_pooled3 <span class="ot">&lt;-</span> tkstats_pooled2 <span class="sc">%&gt;%</span></span>
<span id="cb77-11"><a href="#cb77-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">model_pooled =</span> model,</span>
<span id="cb77-12"><a href="#cb77-12" tabindex="-1"></a>                <span class="at">n_ref_pooled =</span> n_ref) <span class="sc">%&gt;%</span></span>
<span id="cb77-13"><a href="#cb77-13" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(halflife,</span>
<span id="cb77-14"><a href="#cb77-14" tabindex="-1"></a>                        Vss,</span>
<span id="cb77-15"><a href="#cb77-15" tabindex="-1"></a>                        <span class="st">`</span><span class="at">Vss/Fgutabs</span><span class="st">`</span>,</span>
<span id="cb77-16"><a href="#cb77-16" tabindex="-1"></a>                        Fgutabs),</span>
<span id="cb77-17"><a href="#cb77-17" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb77-18"><a href="#cb77-18" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;value_pooled&quot;</span>) </span>
<span id="cb77-19"><a href="#cb77-19" tabindex="-1"></a></span>
<span id="cb77-20"><a href="#cb77-20" tabindex="-1"></a>tkstats_all <span class="ot">&lt;-</span> <span class="fu">full_join</span>(tkstats_study3,</span>
<span id="cb77-21"><a href="#cb77-21" tabindex="-1"></a>                         tkstats_pooled3)</span></code></pre></div>
<p>Exclude those for which the winning model was flat. (They will have
infinite half-life.)</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a>tkstats_all <span class="ot">&lt;-</span> tkstats_all <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(model_pooled <span class="sc">%in%</span> <span class="st">&quot;model_flat&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb78-3"><a href="#cb78-3" tabindex="-1"></a>           <span class="sc">!</span>(model_study <span class="sc">%in%</span> <span class="st">&quot;model_flat&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">ggplot</span>(tkstats_all <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a>         <span class="fu">filter</span>( <span class="sc">!</span><span class="fu">is.na</span>(value_study) <span class="sc">&amp;</span></span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(value_pooled))) <span class="sc">+</span></span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_pooled,</span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a>                 <span class="at">y =</span> value_study,</span>
<span id="cb79-6"><a href="#cb79-6" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">factor</span>(n_ref_pooled))) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name),</span>
<span id="cb79-8"><a href="#cb79-8" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">guide =</span> <span class="st">&quot;axis_logticks&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-10"><a href="#cb79-10" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">guide =</span> <span class="st">&quot;axis_logticks&quot;</span>) </span></code></pre></div>
<p>Plot only the ones with more than one reference.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="fu">ggplot</span>(tkstats_all <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" tabindex="-1"></a>         <span class="fu">filter</span>(n_ref_pooled <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb80-3"><a href="#cb80-3" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(value_study) <span class="sc">&amp;</span></span>
<span id="cb80-4"><a href="#cb80-4" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(value_pooled))) <span class="sc">+</span></span>
<span id="cb80-5"><a href="#cb80-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_pooled,</span>
<span id="cb80-6"><a href="#cb80-6" tabindex="-1"></a>                 <span class="at">y =</span> value_study),</span>
<span id="cb80-7"><a href="#cb80-7" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>,</span>
<span id="cb80-8"><a href="#cb80-8" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-9"><a href="#cb80-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_pooled,</span>
<span id="cb80-10"><a href="#cb80-10" tabindex="-1"></a>                 <span class="at">y =</span> value_study,</span>
<span id="cb80-11"><a href="#cb80-11" tabindex="-1"></a>                 <span class="at">group =</span> <span class="fu">interaction</span>(Chemical, Species)),</span>
<span id="cb80-12"><a href="#cb80-12" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-13"><a href="#cb80-13" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name),</span>
<span id="cb80-14"><a href="#cb80-14" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-15"><a href="#cb80-15" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb80-16"><a href="#cb80-16" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-17"><a href="#cb80-17" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_pooled,</span>
<span id="cb80-18"><a href="#cb80-18" tabindex="-1"></a>                 <span class="at">y =</span> value_study),</span>
<span id="cb80-19"><a href="#cb80-19" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb80-20"><a href="#cb80-20" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb80-21"><a href="#cb80-21" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb80-22"><a href="#cb80-22" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb80-23"><a href="#cb80-23" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">guide =</span> <span class="st">&quot;axis_logticks&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-24"><a href="#cb80-24" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">guide =</span> <span class="st">&quot;axis_logticks&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-25"><a href="#cb80-25" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb80-26"><a href="#cb80-26" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>()) </span></code></pre></div>
<p>Get R-sq for each of these, including only those with more than one
reference:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>rsq_df <span class="ot">&lt;-</span> tkstats_all <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a>         <span class="fu">filter</span>(n_ref_pooled <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb81-3"><a href="#cb81-3" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(value_study) <span class="sc">&amp;</span></span>
<span id="cb81-4"><a href="#cb81-4" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(value_pooled)) <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="#cb81-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log10_value_pooled =</span> <span class="fu">log10</span>(value_pooled),</span>
<span id="cb81-6"><a href="#cb81-6" tabindex="-1"></a>         <span class="at">log10_value_study =</span> <span class="fu">log10</span>(value_study)) <span class="sc">%&gt;%</span></span>
<span id="cb81-7"><a href="#cb81-7" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb81-8"><a href="#cb81-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb81-9"><a href="#cb81-9" tabindex="-1"></a>            <span class="at">n_grp =</span> <span class="fu">n_distinct</span>(Chemical, Species),</span>
<span id="cb81-10"><a href="#cb81-10" tabindex="-1"></a>    <span class="at">rsq_log10 =</span> <span class="fu">summary</span>(</span>
<span id="cb81-11"><a href="#cb81-11" tabindex="-1"></a>      <span class="fu">lm</span>(</span>
<span id="cb81-12"><a href="#cb81-12" tabindex="-1"></a>        log10_value_study <span class="sc">~</span> log10_value_pooled,</span>
<span id="cb81-13"><a href="#cb81-13" tabindex="-1"></a>        <span class="at">na.action =</span> <span class="st">&quot;na.omit&quot;</span></span>
<span id="cb81-14"><a href="#cb81-14" tabindex="-1"></a>        )</span>
<span id="cb81-15"><a href="#cb81-15" tabindex="-1"></a>      )[[</span>
<span id="cb81-16"><a href="#cb81-16" tabindex="-1"></a>    <span class="st">&quot;r.squared&quot;</span></span>
<span id="cb81-17"><a href="#cb81-17" tabindex="-1"></a>  ]],</span>
<span id="cb81-18"><a href="#cb81-18" tabindex="-1"></a>  <span class="at">rsq =</span> <span class="fu">summary</span>(<span class="fu">lm</span>(value_study <span class="sc">~</span> value_pooled))[[</span>
<span id="cb81-19"><a href="#cb81-19" tabindex="-1"></a>    <span class="st">&quot;r.squared&quot;</span></span>
<span id="cb81-20"><a href="#cb81-20" tabindex="-1"></a>  ]]) <span class="sc">%&gt;%</span></span>
<span id="cb81-21"><a href="#cb81-21" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-22"><a href="#cb81-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;R^2 == %.3f&quot;</span>,</span>
<span id="cb81-23"><a href="#cb81-23" tabindex="-1"></a>                         rsq_log10))</span>
<span id="cb81-24"><a href="#cb81-24" tabindex="-1"></a></span>
<span id="cb81-25"><a href="#cb81-25" tabindex="-1"></a>rsq_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>label) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code></pre></div>
<p>Re-make plot with R-sq information as text annotation, and save.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a><span class="fu">ggplot</span>(tkstats_all <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a>         <span class="fu">filter</span>(n_ref_pooled <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(value_study) <span class="sc">&amp;</span></span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a>                  <span class="sc">!</span><span class="fu">is.na</span>(value_pooled))) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_pooled,</span>
<span id="cb82-6"><a href="#cb82-6" tabindex="-1"></a>                 <span class="at">y =</span> value_study),</span>
<span id="cb82-7"><a href="#cb82-7" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>,</span>
<span id="cb82-8"><a href="#cb82-8" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb82-9"><a href="#cb82-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_pooled,</span>
<span id="cb82-10"><a href="#cb82-10" tabindex="-1"></a>                 <span class="at">y =</span> value_study,</span>
<span id="cb82-11"><a href="#cb82-11" tabindex="-1"></a>                 <span class="at">group =</span> <span class="fu">interaction</span>(Chemical, Species)),</span>
<span id="cb82-12"><a href="#cb82-12" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-13"><a href="#cb82-13" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> rsq_df,</span>
<span id="cb82-14"><a href="#cb82-14" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb82-15"><a href="#cb82-15" tabindex="-1"></a>                <span class="at">y =</span> <span class="cn">Inf</span>,</span>
<span id="cb82-16"><a href="#cb82-16" tabindex="-1"></a>                <span class="at">label =</span> label),</span>
<span id="cb82-17"><a href="#cb82-17" tabindex="-1"></a>            <span class="at">parse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-18"><a href="#cb82-18" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.3</span>,</span>
<span id="cb82-19"><a href="#cb82-19" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb82-20"><a href="#cb82-20" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(name),</span>
<span id="cb82-21"><a href="#cb82-21" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-22"><a href="#cb82-22" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb82-23"><a href="#cb82-23" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-24"><a href="#cb82-24" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> value_pooled,</span>
<span id="cb82-25"><a href="#cb82-25" tabindex="-1"></a>                 <span class="at">y =</span> value_study),</span>
<span id="cb82-26"><a href="#cb82-26" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb82-27"><a href="#cb82-27" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb82-28"><a href="#cb82-28" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb82-29"><a href="#cb82-29" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-30"><a href="#cb82-30" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">guide =</span> <span class="st">&quot;axis_logticks&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-31"><a href="#cb82-31" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">guide =</span> <span class="st">&quot;axis_logticks&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-32"><a href="#cb82-32" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Pooled value&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-33"><a href="#cb82-33" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Single-study value&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-34"><a href="#cb82-34" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb82-35"><a href="#cb82-35" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-36"><a href="#cb82-36" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb82-37"><a href="#cb82-37" tabindex="-1"></a></span>
<span id="cb82-38"><a href="#cb82-38" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb82-39"><a href="#cb82-39" tabindex="-1"></a>              <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb82-40"><a href="#cb82-40" tabindex="-1"></a>              today,</span>
<span id="cb82-41"><a href="#cb82-41" tabindex="-1"></a>              <span class="st">&quot;_Fig8.png&quot;</span>),</span>
<span id="cb82-42"><a href="#cb82-42" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb82-43"><a href="#cb82-43" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>)</span>
<span id="cb82-44"><a href="#cb82-44" tabindex="-1"></a></span>
<span id="cb82-45"><a href="#cb82-45" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb82-46"><a href="#cb82-46" tabindex="-1"></a>              today,</span>
<span id="cb82-47"><a href="#cb82-47" tabindex="-1"></a>              <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb82-48"><a href="#cb82-48" tabindex="-1"></a>              <span class="st">&quot;_Fig8.pdf&quot;</span>),</span>
<span id="cb82-49"><a href="#cb82-49" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb82-50"><a href="#cb82-50" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>)</span></code></pre></div>
<p>Save the data as a supplemental table</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a>tkstats_all_wide <span class="ot">&lt;-</span> tkstats_all <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(Chemical, Species,</span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a>                          Reference, method,</span>
<span id="cb83-4"><a href="#cb83-4" tabindex="-1"></a>                          model_study,</span>
<span id="cb83-5"><a href="#cb83-5" tabindex="-1"></a>                          model_pooled,</span>
<span id="cb83-6"><a href="#cb83-6" tabindex="-1"></a>                          n_ref_pooled),</span>
<span id="cb83-7"><a href="#cb83-7" tabindex="-1"></a>              <span class="at">names_from =</span> name,</span>
<span id="cb83-8"><a href="#cb83-8" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(value_study, value_pooled))</span>
<span id="cb83-9"><a href="#cb83-9" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" tabindex="-1"></a>tkstats_all_wide <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_ref_pooled <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-11"><a href="#cb83-11" tabindex="-1"></a>  writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="at">path =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb83-12"><a href="#cb83-12" tabindex="-1"></a>                                    <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb83-13"><a href="#cb83-13" tabindex="-1"></a>                                    today,</span>
<span id="cb83-14"><a href="#cb83-14" tabindex="-1"></a>                                    <span class="st">&quot;Supp_Table5.xlsx&quot;</span>))</span></code></pre></div>
<p>Plot the case with a large Vdist:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a>plot_pooled <span class="ot">&lt;-</span> <span class="fu">plot</span>(pk_pooled,</span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a>                    <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>,</span>
<span id="cb84-4"><a href="#cb84-4" tabindex="-1"></a>                    <span class="at">best_fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-5"><a href="#cb84-5" tabindex="-1"></a>plot_pooled <span class="sc">%&gt;%</span></span>
<span id="cb84-6"><a href="#cb84-6" tabindex="-1"></a>  <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID2020139&quot;</span> <span class="sc">&amp;</span> Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-7"><a href="#cb84-7" tabindex="-1"></a>  <span class="fu">pull</span>(final_plot[[<span class="dv">1</span>]])</span></code></pre></div>
</div>
<div id="all-plots-for-best-set-of-fitting-options" class="section level1" number="11">
<h1><span class="header-section-number">11</span> All plots for best set
of fitting options</h1>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>plot_pooled <span class="ot">&lt;-</span> <span class="fu">plot</span>(pk_pooled,</span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">&quot;bobyqa&quot;</span>,</span>
<span id="cb85-3"><a href="#cb85-3" tabindex="-1"></a>                    <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>,</span>
<span id="cb85-4"><a href="#cb85-4" tabindex="-1"></a>                    <span class="at">print_out =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-5"><a href="#cb85-5" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb85-7"><a href="#cb85-7" tabindex="-1"></a>   <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb85-8"><a href="#cb85-8" tabindex="-1"></a>                     <span class="st">&quot;Manu_Files/&quot;</span>,</span>
<span id="cb85-9"><a href="#cb85-9" tabindex="-1"></a>                     today,</span>
<span id="cb85-10"><a href="#cb85-10" tabindex="-1"></a>                     <span class="st">&quot;_allplots.pdf&quot;</span>), </span>
<span id="cb85-11"><a href="#cb85-11" tabindex="-1"></a>   <span class="at">plot =</span> gridExtra<span class="sc">::</span><span class="fu">marrangeGrob</span>(plot_pooled, <span class="at">nrow=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">1</span>), </span>
<span id="cb85-12"><a href="#cb85-12" tabindex="-1"></a>   <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">9</span></span>
<span id="cb85-13"><a href="#cb85-13" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="print-sessioninfo" class="section level1" number="12">
<h1><span class="header-section-number">12</span> Print
sessionInfo()</h1>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
